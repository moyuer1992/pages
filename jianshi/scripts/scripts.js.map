{"version":3,"sources":["scripts.js"],"names":["_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","TypeError","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_classCallCheck","instance","Constructor","_argumentsToArray","args","concat","apply","Array","slice","radians","degrees","Math","PI","vec2","result","arguments","length","push","splice","vec3","vec4","mat2","v","m","matrix","mat3","mat4","equal","u","i","j","add","subtract","mult","sum","k","translate","x","y","z","isArray","rotate","angle","axis","normalize","c","cos","omc","s","sin","rotateX","theta","rx","rotateY","ry","rotateZ","rz","scalem","lookAt","eye","at","up","n","cross","negate","dot","ortho","left","right","bottom","top","near","far","w","h","d","perspective","fovy","aspect","f","tan","transpose","sqrt","excludeLastComponent","last","pop","len","isFinite","mix","scale","flatten","elemsAreArrays","floats","Float32Array","idx","printm","console","log","det2","det3","det4","m0","m1","m2","m3","det","inverse2","a","inverse3","a00","a01","a02","a10","a11","a12","a20","a21","a22","inverse4","a03","a13","a23","a30","a31","a32","a33","inverse","normalMatrix","flag","b","calTriangleArea","A","B","C","distance","p","p1","p2","makeTextData","text","size","options","pointsArray","normalsArray","colorsArray","compIdxArray","e","g","markMap","cnt","width","height","textCtx","canvas","ctx","clearRect","font","fillStyle","strokeStyle","lineWidth","textAlign","textBaseline","fillText","imageData","getImageData","data","grid","triangle","index","normal","colorStyle","area","color","pow","hasPixel","markPoint","isEdge","finalGraph","seperateGraph","sampledEdge","graphMap","thick","z2","forEach","graph","points","holes","triangles","earcut","holesMap","holeIndex","startAt","endAt","graphs","graphsEdge","markArr","fathers","markCollection","findFather","f1","f2","indexOf","shape","orderEdge","findOuterContourEntry","start","findInnerContourEntry","isInContours","gap","rs","entryRecord","next","end","mark","holeMark","process","tmp","map","convertEntry","arr","entryIndex","hasNext","innerEntry","convertCanvasToGl","convertCanvasToGl2D","parseArr","normals","colors","hslToRgb","l","r","hue2rgb","q","t","round","rgbToHsl","max","min","componentToHex","hex","toString","rgbToHex","hexToRgb","exec","parseInt","_get","get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","undefined","parent","getPrototypeOf","getter","_createClass","defineProperties","target","props","descriptor","defineProperty","key","protoProps","staticProps","sizeof","byteLength","$","fn","classes","callback","each","this","splitClassName","className","split","jQuery","initGlProgram","gl","shaders","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","window","error","getProgramInfoLog","initGlShader","shaderScript","shaderType","shader","createShader","shaderSource","compileShader","BgSprite","editor","style","animating","timeGap","duration","entryLength","canvasNode","bgCtx","bgGl","init","stop","TextSprite","textStyle","animationStyle","_t","clearArea","keys","startTime","Date","now","animationMap","label","useScissor","util","getSpriteEntity","entities","Klass","eval","getInitialState","name","config","state","fontMap","fontSizeMap","fontColorMap","textStyleMap","textAlignMap","backgroundMap","fontIndex","fontSizeIndex","fontColorIndex","textStyleIndex","textAlignIndex","backgroundIndex","animationIndex","bgColorIndex","document","createElement","getContext","GlTextSprite","_TextSprite","glcanvasNode","dataMap","initGl","_finish","getTextData","char","parseData","clear","renderGlText","pos","fontSize","lineHeight","fontColor","animation","finish","period","floor","drawStatic","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","modelViewMatrix","projectionMatrix","modelViewMatrixLoc","projectionMatrixLoc","normalMatrixLoc","colorArray","radius","phi","ytop","lightPosition","lightAmbient","lightDiffuse","lightSpecular","materialAmbient","materialDiffuse","materialSpecular","materialShininess","useProgram","enable","DEPTH_TEST","viewport","ambientProduct","diffuseProduct","specularProduct","nBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","vNormal","getAttribLocation","vertexAttribPointer","FLOAT","enableVertexAttribArray","vBuffer","vPosition","iBuffer","compIdx","getUniformLocation","uniform4fv","uniform1f","uniform1i","uniform3fv","uniformMatrix4fv","uniformMatrix3fv","drawArrays","TRIANGLES","SCISSOR_TEST","scissor","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","disable","PureBgSprite","_BgSprite","fillRect","TreeBgSprite","_BgSprite2","renderGlMoon","numTimesToSubdivide","renderGlTree","minH","iniH","dt","progress","vertexMoonShader","fragmentMoonShader","moonProgram","vertexTreeShader","fragmentTreeShader","treeProgram","branch","root","abs","LINES","divideTriangle","count","ab","ac","bc","tetrahedron","va","vb","vc","vd","Data","_content","_lines","addContent","_text","charAt","join","Editor","paddingLeft","paddingRight","paddingTop","paddingBottom","bottomBarHeight","onFocus","isToolBarShown","toolBarWidth","operations","createStyle","initData","selection","Selection","createElements","bindEvents","createMap","initSprites","windowWidth","windowHeight","$editor","editorNode","css","updateRelativeLocation","renderText","Style","hiddenCanvas","hiddenCtx","$bgCanvas","$bgGlcanvas","bgGlcanvasNode","bgCanvasNode","preserveDrawingBuffer","$canvas","$glcanvas","$input","inputNode","append","$cursor","cursorNode","rowIndex","colIndex","hideCursor","getSelEndPosition","cursorX","cursorY","on","onInputChange","bind","onInputFocus","onInputBlur","onKeyDown","onCompStart","onCompEnd","onInputChar","onTouchStart","onTouchEnd","onMouseDown","onMouseUp","onGlobalClick","resize","onScroll","col","row","charLength","keyCode","deleteText","getSelLength","clearInputNodeValue","update","updateCursor","action","getLength","deleteContent","padding","x2","y2","_convertWindowPosToCanvas","clientX","clientY","blur","inputStatus","that","setTimeout","input","touch","click","insertText","preventDefault","focus","touches","changedTouches","findPosfromMap","str","chars","code","charCodeAt","bgSprite","xCursor","yCursor","lines","getLines","lineMap","charGap","space","updateMap","textSprite","_fillText","animationInfo","textStop","bgStop","requestAnimationFrame","tick","advance","stopPlay","drawFrame","bottomBar","$dom","find","removeClass","drawImage","imgData","toDataURL","startColIndex","endColIndex","startRowIndex","endRowIndex","_convertIndexByMap","_convertMapByIndex","initDefaultStyle","changeTextStyle","changeBgStyle","getAnimationMap","lineHeightRatio","changeStyle","textWeight","background","selectModal","show","hasClass","play","addClass","toolBar","isShown","hide","resultModal","attr","toLowerCase","export","option","generateJpeg","generatePng","generateGif","then","onChange","re","test","RegExp","$1","updateBgColor","$el","changeBgColor","hideToolBar","showToolBar","nextIndex","clearCanvas","textStyleChange","backgroundChange","o","require","Error","exports","1","module","2","holeIndices","dim","hasHoles","outerLen","outerNode","linkedList","minX","minY","maxX","maxY","eliminateHoles","earcutLinked","clockwise","signedArea","insertNode","equals","removeNode","filterPoints","again","steiner","prev","ear","pass","indexCurve","isEarHashed","isEar","cureLocalIntersections","splitEarcut","pointInTriangle","minTX","minTY","maxTX","maxTY","minZ","zOrder","maxZ","nextZ","prevZ","intersects","locallyInside","isValidDiagonal","splitPolygon","list","queue","getLeftmost","sort","compareX","eliminateHole","hole","findHoleBridge","hx","hy","qx","Infinity","mx","my","tanMin","sortLinked","tail","numMerges","pSize","qSize","inSize","leftmost","ax","ay","bx","by","cx","cy","px","py","intersectsPolygon","middleInside","q1","q2","inside","a2","Node","b2","an","bp","deviation","polygonArea","trianglesArea","vertices","dimensions"],"mappings":"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","file":"scripts.js","sourcesContent":["//////////////////////////////////////////////////////////////////////////////\n//\n//  Angel.js\n//\n//////////////////////////////////////////////////////////////////////////////\n\n//----------------------------------------------------------------------------\n//\n//  Helper functions\n//\n\nfunction _argumentsToArray( args )\n{\n    return [].concat.apply( [], Array.prototype.slice.apply(args) );\n}\n\n//----------------------------------------------------------------------------\n\nfunction radians( degrees ) {\n    return degrees * Math.PI / 180.0;\n}\n\n//----------------------------------------------------------------------------\n//\n//  Vector Constructors\n//\n\nfunction vec2()\n{\n    var result = _argumentsToArray( arguments );\n\n    switch ( result.length ) {\n    case 0: result.push( 0.0 );\n    case 1: result.push( 0.0 );\n    }\n\n    return result.splice( 0, 2 );\n}\n\nfunction vec3()\n{\n    var result = _argumentsToArray( arguments );\n\n    switch ( result.length ) {\n    case 0: result.push( 0.0 );\n    case 1: result.push( 0.0 );\n    case 2: result.push( 0.0 );\n    }\n\n    return result.splice( 0, 3 );\n}\n\nfunction vec4()\n{\n    var result = _argumentsToArray( arguments );\n\n    switch ( result.length ) {\n    case 0: result.push( 0.0 );\n    case 1: result.push( 0.0 );\n    case 2: result.push( 0.0 );\n    case 3: result.push( 1.0 );\n    }\n\n    return result.splice( 0, 4 );\n}\n\n//----------------------------------------------------------------------------\n//\n//  Matrix Constructors\n//\n\nfunction mat2()\n{\n    var v = _argumentsToArray( arguments );\n\n    var m = [];\n    switch ( v.length ) {\n    case 0:\n        v[0] = 1;\n    case 1:\n        m = [\n            vec2( v[0],  0.0 ),\n            vec2(  0.0, v[0] )\n        ];\n        break;\n\n    default:\n        m.push( vec2(v) );  v.splice( 0, 2 );\n        m.push( vec2(v) );\n        break;\n    }\n\n    m.matrix = true;\n\n    return m;\n}\n\n//----------------------------------------------------------------------------\n\nfunction mat3()\n{\n    var v = _argumentsToArray( arguments );\n\n    var m = [];\n    switch ( v.length ) {\n    case 0:\n        v[0] = 1;\n    case 1:\n        m = [\n            vec3( v[0],  0.0,  0.0 ),\n            vec3(  0.0, v[0],  0.0 ),\n            vec3(  0.0,  0.0, v[0] )\n        ];\n        break;\n\n    default:\n        m.push( vec3(v) );  v.splice( 0, 3 );\n        m.push( vec3(v) );  v.splice( 0, 3 );\n        m.push( vec3(v) );\n        break;\n    }\n\n    m.matrix = true;\n\n    return m;\n}\n\n//----------------------------------------------------------------------------\n\nfunction mat4()\n{\n    var v = _argumentsToArray( arguments );\n\n    var m = [];\n    switch ( v.length ) {\n    case 0:\n        v[0] = 1;\n    case 1:\n        m = [\n            vec4( v[0], 0.0,  0.0,   0.0 ),\n            vec4( 0.0,  v[0], 0.0,   0.0 ),\n            vec4( 0.0,  0.0,  v[0],  0.0 ),\n            vec4( 0.0,  0.0,  0.0,  v[0] )\n        ];\n        break;\n\n    default:\n        m.push( vec4(v) );  v.splice( 0, 4 );\n        m.push( vec4(v) );  v.splice( 0, 4 );\n        m.push( vec4(v) );  v.splice( 0, 4 );\n        m.push( vec4(v) );\n        break;\n    }\n\n    m.matrix = true;\n\n    return m;\n}\n\n//----------------------------------------------------------------------------\n//\n//  Generic Mathematical Operations for Vectors and Matrices\n//\n\nfunction equal( u, v )\n{\n    if ( u.length != v.length ) { return false; }\n\n    if ( u.matrix && v.matrix ) {\n        for ( var i = 0; i < u.length; ++i ) {\n            if ( u[i].length != v[i].length ) { return false; }\n            for ( var j = 0; j < u[i].length; ++j ) {\n                if ( u[i][j] !== v[i][j] ) { return false; }\n            }\n        }\n    }\n    else if ( u.matrix && !v.matrix || !u.matrix && v.matrix ) {\n        return false;\n    }\n    else {\n        for ( var i = 0; i < u.length; ++i ) {\n            if ( u[i] !== v[i] ) { return false; }\n        }\n    }\n\n    return true;\n}\n\n//----------------------------------------------------------------------------\n\nfunction add( u, v )\n{\n    var result = [];\n\n    if ( u.matrix && v.matrix ) {\n        if ( u.length != v.length ) {\n            throw \"add(): trying to add matrices of different dimensions\";\n        }\n\n        for ( var i = 0; i < u.length; ++i ) {\n            if ( u[i].length != v[i].length ) {\n                throw \"add(): trying to add matrices of different dimensions\";\n            }\n            result.push( [] );\n            for ( var j = 0; j < u[i].length; ++j ) {\n                result[i].push( u[i][j] + v[i][j] );\n            }\n        }\n\n        result.matrix = true;\n\n        return result;\n    }\n    else if ( u.matrix && !v.matrix || !u.matrix && v.matrix ) {\n        throw \"add(): trying to add matrix and non-matrix variables\";\n    }\n    else {\n        if ( u.length != v.length ) {\n            throw \"add(): vectors are not the same dimension\";\n        }\n\n        for ( var i = 0; i < u.length; ++i ) {\n            result.push( u[i] + v[i] );\n        }\n\n        return result;\n    }\n}\n\n//----------------------------------------------------------------------------\n\nfunction subtract( u, v )\n{\n    var result = [];\n\n    if ( u.matrix && v.matrix ) {\n        if ( u.length != v.length ) {\n            throw \"subtract(): trying to subtract matrices\" +\n                \" of different dimensions\";\n        }\n\n        for ( var i = 0; i < u.length; ++i ) {\n            if ( u[i].length != v[i].length ) {\n                throw \"subtract(): trying to subtact matrices\" +\n                    \" of different dimensions\";\n            }\n            result.push( [] );\n            for ( var j = 0; j < u[i].length; ++j ) {\n                result[i].push( u[i][j] - v[i][j] );\n            }\n        }\n\n        result.matrix = true;\n\n        return result;\n    }\n    else if ( u.matrix && !v.matrix || !u.matrix && v.matrix ) {\n        throw \"subtact(): trying to subtact  matrix and non-matrix variables\";\n    }\n    else {\n        if ( u.length != v.length ) {\n            throw \"subtract(): vectors are not the same length\";\n        }\n\n        for ( var i = 0; i < u.length; ++i ) {\n            result.push( u[i] - v[i] );\n        }\n\n        return result;\n    }\n}\n\n//----------------------------------------------------------------------------\n\nfunction mult( u, v )\n{\n    var result = [];\n\n    if ( u.matrix && v.matrix ) {\n        if ( u.length != v.length ) {\n            throw \"mult(): trying to add matrices of different dimensions\";\n        }\n\n        for ( var i = 0; i < u.length; ++i ) {\n            if ( u[i].length != v[i].length ) {\n                throw \"mult(): trying to add matrices of different dimensions\";\n            }\n        }\n\n        for ( var i = 0; i < u.length; ++i ) {\n            result.push( [] );\n\n            for ( var j = 0; j < v.length; ++j ) {\n                var sum = 0.0;\n                for ( var k = 0; k < u.length; ++k ) {\n                    sum += u[i][k] * v[k][j];\n                }\n                result[i].push( sum );\n            }\n        }\n\n        result.matrix = true;\n\n        return result;\n    }\n\n      if(u.matrix&& (u.length == v.length)) {\n        for(var i = 0; i<v.length; i++) {\n          var sum = 0.0;\n          for(var j=0; j<v.length; j++) {\n            sum += u[i][j]*v[j];\n          }\n          result.push(sum);\n        }\n      return result;\n      }\n\n\n\n    else {\n        if ( u.length != v.length ) {\n            throw \"mult(): vectors are not the same dimension\";\n        }\n\n        for ( var i = 0; i < u.length; ++i ) {\n            result.push( u[i] * v[i] );\n        }\n\n        return result;\n    }\n}\n\n//----------------------------------------------------------------------------\n//\n//  Basic Transformation Matrix Generators\n//\n\nfunction translate( x, y, z )\n{\n    if ( Array.isArray(x) && x.length == 3 ) {\n        z = x[2];\n        y = x[1];\n        x = x[0];\n    }\n\n    var result = mat4();\n    result[0][3] = x;\n    result[1][3] = y;\n    result[2][3] = z;\n\n    return result;\n}\n\n//----------------------------------------------------------------------------\n\nfunction rotate( angle, axis )\n{\n    if ( !Array.isArray(axis) ) {\n        axis = [ arguments[1], arguments[2], arguments[3] ];\n    }\n\n    var v = normalize( axis );\n\n    var x = v[0];\n    var y = v[1];\n    var z = v[2];\n\n    var c = Math.cos( radians(angle) );\n    var omc = 1.0 - c;\n    var s = Math.sin( radians(angle) );\n\n    var result = mat4(\n        vec4( x*x*omc + c,   x*y*omc - z*s, x*z*omc + y*s, 0.0 ),\n        vec4( x*y*omc + z*s, y*y*omc + c,   y*z*omc - x*s, 0.0 ),\n        vec4( x*z*omc - y*s, y*z*omc + x*s, z*z*omc + c,   0.0 ),\n        vec4()\n    );\n\n    return result;\n}\n\nfunction rotateX(theta) {\n  var c = Math.cos( radians(theta) );\n  var s = Math.sin( radians(theta) );\n  var rx = mat4( 1.0,  0.0,  0.0, 0.0,\n      0.0,  c,  s, 0.0,\n      0.0, -s,  c, 0.0,\n      0.0,  0.0,  0.0, 1.0 );\n  return rx;\n}\nfunction rotateY(theta) {\n  var c = Math.cos( radians(theta) );\n  var s = Math.sin( radians(theta) );\n  var ry = mat4( c, 0.0, -s, 0.0,\n      0.0, 1.0,  0.0, 0.0,\n      s, 0.0,  c, 0.0,\n      0.0, 0.0,  0.0, 1.0 );\n  return ry;\n}\nfunction rotateZ(theta) {\n  var c = Math.cos( radians(theta) );\n  var s = Math.sin( radians(theta) );\n  var rz = mat4( c, s, 0.0, 0.0,\n      -s,  c, 0.0, 0.0,\n      0.0,  0.0, 1.0, 0.0,\n      0.0,  0.0, 0.0, 1.0 );\n  return rz;\n}\n\n\n//----------------------------------------------------------------------------\n\nfunction scalem( x, y, z )\n{\n    if ( Array.isArray(x) && x.length == 3 ) {\n        z = x[2];\n        y = x[1];\n        x = x[0];\n    }\n\n    var result = mat4();\n    result[0][0] = x;\n    result[1][1] = y;\n    result[2][2] = z;\n\n    return result;\n}\n\n//----------------------------------------------------------------------------\n//\n//  ModelView Matrix Generators\n//\n\nfunction lookAt( eye, at, up )\n{\n    if ( !Array.isArray(eye) || eye.length != 3) {\n        throw \"lookAt(): first parameter [eye] must be an a vec3\";\n    }\n\n    if ( !Array.isArray(at) || at.length != 3) {\n        throw \"lookAt(): first parameter [at] must be an a vec3\";\n    }\n\n    if ( !Array.isArray(up) || up.length != 3) {\n        throw \"lookAt(): first parameter [up] must be an a vec3\";\n    }\n\n    if ( equal(eye, at) ) {\n        return mat4();\n    }\n\n    var v = normalize( subtract(at, eye) );  // view direction vector\n    var n = normalize( cross(v, up) );       // perpendicular vector\n    var u = normalize( cross(n, v) );        // \"new\" up vector\n\n    v = negate( v );\n\n    var result = mat4(\n        vec4( n, -dot(n, eye) ),\n        vec4( u, -dot(u, eye) ),\n        vec4( v, -dot(v, eye) ),\n        vec4()\n    );\n\n    return result;\n}\n\n//----------------------------------------------------------------------------\n//\n//  Projection Matrix Generators\n//\n\nfunction ortho( left, right, bottom, top, near, far )\n{\n    if ( left == right ) { throw \"ortho(): left and right are equal\"; }\n    if ( bottom == top ) { throw \"ortho(): bottom and top are equal\"; }\n    if ( near == far )   { throw \"ortho(): near and far are equal\"; }\n\n    var w = right - left;\n    var h = top - bottom;\n    var d = far - near;\n\n    var result = mat4();\n    result[0][0] = 2.0 / w;\n    result[1][1] = 2.0 / h;\n    result[2][2] = -2.0 / d;\n    result[0][3] = -(left + right) / w;\n    result[1][3] = -(top + bottom) / h;\n    result[2][3] = -(near + far) / d;\n\n    return result;\n}\n\n//----------------------------------------------------------------------------\n\nfunction perspective( fovy, aspect, near, far )\n{\n    var f = 1.0 / Math.tan( radians(fovy) / 2 );\n    var d = far - near;\n\n    var result = mat4();\n    result[0][0] = f / aspect;\n    result[1][1] = f;\n    result[2][2] = -(near + far) / d;\n    result[2][3] = -2 * near * far / d;\n    result[3][2] = -1;\n    result[3][3] = 0.0;\n\n    return result;\n}\n\n//----------------------------------------------------------------------------\n//\n//  Matrix Functions\n//\n\nfunction transpose( m )\n{\n    if ( !m.matrix ) {\n        return \"transpose(): trying to transpose a non-matrix\";\n    }\n\n    var result = [];\n    for ( var i = 0; i < m.length; ++i ) {\n        result.push( [] );\n        for ( var j = 0; j < m[i].length; ++j ) {\n            result[i].push( m[j][i] );\n        }\n    }\n\n    result.matrix = true;\n\n    return result;\n}\n\n//----------------------------------------------------------------------------\n//\n//  Vector Functions\n//\n\nfunction dot( u, v )\n{\n    if ( u.length != v.length ) {\n        throw \"dot(): vectors are not the same dimension\";\n    }\n\n    var sum = 0.0;\n    for ( var i = 0; i < u.length; ++i ) {\n        sum += u[i] * v[i];\n    }\n\n    return sum;\n}\n\n//----------------------------------------------------------------------------\n\nfunction negate( u )\n{\n    var result = [];\n    for ( var i = 0; i < u.length; ++i ) {\n        result.push( -u[i] );\n    }\n\n    return result;\n}\n\n//----------------------------------------------------------------------------\n\nfunction cross( u, v )\n{\n    if ( !Array.isArray(u) || u.length < 3 ) {\n        throw \"cross(): first argument is not a vector of at least 3\";\n    }\n\n    if ( !Array.isArray(v) || v.length < 3 ) {\n        throw \"cross(): second argument is not a vector of at least 3\";\n    }\n\n    var result = [\n        u[1]*v[2] - u[2]*v[1],\n        u[2]*v[0] - u[0]*v[2],\n        u[0]*v[1] - u[1]*v[0]\n    ];\n\n    return result;\n}\n\n//----------------------------------------------------------------------------\n\nfunction length( u )\n{\n    return Math.sqrt( dot(u, u) );\n}\n\n//----------------------------------------------------------------------------\n\nfunction normalize( u, excludeLastComponent )\n{\n    if ( excludeLastComponent ) {\n        var last = u.pop();\n    }\n\n    var len = length( u );\n\n    if ( !isFinite(len) ) {\n        throw \"normalize: vector \" + u + \" has zero length\";\n    }\n\n    for ( var i = 0; i < u.length; ++i ) {\n        u[i] /= len;\n    }\n\n    if ( excludeLastComponent ) {\n        u.push( last );\n    }\n\n    return u;\n}\n\n//----------------------------------------------------------------------------\n\nfunction mix( u, v, s )\n{\n    if ( typeof s !== \"number\" ) {\n        throw \"mix: the last paramter \" + s + \" must be a number\";\n    }\n\n    if ( u.length != v.length ) {\n        throw \"vector dimension mismatch\";\n    }\n\n    var result = [];\n    for ( var i = 0; i < u.length; ++i ) {\n        result.push( (1.0 - s) * u[i] + s * v[i] );\n    }\n\n    return result;\n}\n\n//----------------------------------------------------------------------------\n//\n// Vector and Matrix functions\n//\n\nfunction scale( s, u )\n{\n    if ( !Array.isArray(u) ) {\n        throw \"scale: second parameter \" + u + \" is not a vector\";\n    }\n\n    var result = [];\n    for ( var i = 0; i < u.length; ++i ) {\n        result.push( s * u[i] );\n    }\n\n    return result;\n}\n\n//----------------------------------------------------------------------------\n//\n//\n//\n\nfunction flatten( v )\n{\n    if ( v.matrix === true ) {\n        v = transpose( v );\n    }\n\n    var n = v.length;\n    var elemsAreArrays = false;\n\n    if ( Array.isArray(v[0]) ) {\n        elemsAreArrays = true;\n        n *= v[0].length;\n    }\n\n    var floats = new Float32Array( n );\n\n    if ( elemsAreArrays ) {\n        var idx = 0;\n        for ( var i = 0; i < v.length; ++i ) {\n            for ( var j = 0; j < v[i].length; ++j ) {\n                floats[idx++] = v[i][j];\n            }\n        }\n    }\n    else {\n        for ( var i = 0; i < v.length; ++i ) {\n            floats[i] = v[i];\n        }\n    }\n\n    return floats;\n}\n\n//----------------------------------------------------------------------------\n\nvar sizeof = {\n    'vec2' : new Float32Array( flatten(vec2()) ).byteLength,\n    'vec3' : new Float32Array( flatten(vec3()) ).byteLength,\n    'vec4' : new Float32Array( flatten(vec4()) ).byteLength,\n    'mat2' : new Float32Array( flatten(mat2()) ).byteLength,\n    'mat3' : new Float32Array( flatten(mat3()) ).byteLength,\n    'mat4' : new Float32Array( flatten(mat4()) ).byteLength\n};\n\n// new functions 5/2/2015\n\n// printing\n\nfunction printm(m)\n{\n    if(m.length == 2)\n    for(var i=0; i<m.length; i++)\n       console.log(m[i][0], m[i][1]);\n    else if(m.length == 3)\n    for(var i=0; i<m.length; i++)\n       console.log(m[i][0], m[i][1], m[i][2]);\n    else if(m.length == 4)\n    for(var i=0; i<m.length; i++)\n       console.log(m[i][0], m[i][1], m[i][2], m[i][3]);\n}\n// determinants\n\nfunction det2(m)\n{\n\n     return m[0][0]*m[1][1]-m[0][1]*m[1][0];\n\n}\n\nfunction det3(m)\n{\n     var d = m[0][0]*m[1][1]*m[2][2]\n           + m[0][1]*m[1][2]*m[2][0]\n           + m[0][2]*m[2][1]*m[1][0]\n           - m[2][0]*m[1][1]*m[0][2]\n           - m[1][0]*m[0][1]*m[2][2]\n           - m[0][0]*m[1][2]*m[2][1]\n           ;\n     return d;\n}\n\nfunction det4(m)\n{\n     var m0 = [\n         vec3(m[1][1], m[1][2], m[1][3]),\n         vec3(m[2][1], m[2][2], m[2][3]),\n         vec3(m[3][1], m[3][2], m[3][3])\n     ];\n     var m1 = [\n         vec3(m[1][0], m[1][2], m[1][3]),\n         vec3(m[2][0], m[2][2], m[2][3]),\n         vec3(m[3][0], m[3][2], m[3][3])\n     ];\n     var m2 = [\n         vec3(m[1][0], m[1][1], m[1][3]),\n         vec3(m[2][0], m[2][1], m[2][3]),\n         vec3(m[3][0], m[3][1], m[3][3])\n     ];\n     var m3 = [\n         vec3(m[1][0], m[1][1], m[1][2]),\n         vec3(m[2][0], m[2][1], m[2][2]),\n         vec3(m[3][0], m[3][1], m[3][2])\n     ];\n     return m[0][0]*det3(m0) - m[0][1]*det3(m1)\n         + m[0][2]*det3(m2) - m[0][3]*det3(m3);\n\n}\n\nfunction det(m)\n{\n     if(m.matrix != true) console.log(\"not a matrix\");\n     if(m.length == 2) return det2(m);\n     if(m.length == 3) return det3(m);\n     if(m.length == 4) return det4(m);\n}\n\n//---------------------------------------------------------\n\n// inverses\n\nfunction inverse2(m)\n{\n     var a = mat2();\n     var d = det2(m);\n     a[0][0] = m[1][1]/d;\n     a[0][1] = -m[0][1]/d;\n     a[1][0] = -m[1][0]/d;\n     a[1][1] = m[0][0]/d;\n     a.matrix = true;\n     return a;\n}\n\nfunction inverse3(m)\n{\n    var a = mat3();\n    var d = det3(m);\n\n    var a00 = [\n       vec2(m[1][1], m[1][2]),\n       vec2(m[2][1], m[2][2])\n    ];\n    var a01 = [\n       vec2(m[1][0], m[1][2]),\n       vec2(m[2][0], m[2][2])\n    ];\n    var a02 = [\n       vec2(m[1][0], m[1][1]),\n       vec2(m[2][0], m[2][1])\n    ];\n    var a10 = [\n       vec2(m[0][1], m[0][2]),\n       vec2(m[2][1], m[2][2])\n    ];\n    var a11 = [\n       vec2(m[0][0], m[0][2]),\n       vec2(m[2][0], m[2][2])\n    ];\n    var a12 = [\n       vec2(m[0][0], m[0][1]),\n       vec2(m[2][0], m[2][1])\n    ];\n    var a20 = [\n       vec2(m[0][1], m[0][2]),\n       vec2(m[1][1], m[1][2])\n    ];\n    var a21 = [\n       vec2(m[0][0], m[0][2]),\n       vec2(m[1][0], m[1][2])\n    ];\n    var a22 = [\n       vec2(m[0][0], m[0][1]),\n       vec2(m[1][0], m[1][1])\n    ];\n\n   a[0][0] = det2(a00)/d;\n   a[0][1] = -det2(a10)/d;\n   a[0][2] = det2(a20)/d;\n   a[1][0] = -det2(a01)/d;\n   a[1][1] = det2(a11)/d;\n   a[1][2] = -det2(a21)/d;\n   a[2][0] = det2(a02)/d;\n   a[2][1] = -det2(a12)/d;\n   a[2][2] = det2(a22)/d;\n\n   return a;\n\n}\n\nfunction inverse4(m)\n{\n    var a = mat4();\n    var d = det4(m);\n\n    var a00 = [\n       vec3(m[1][1], m[1][2], m[1][3]),\n       vec3(m[2][1], m[2][2], m[2][3]),\n       vec3(m[3][1], m[3][2], m[3][3])\n    ];\n    var a01 = [\n       vec3(m[1][0], m[1][2], m[1][3]),\n       vec3(m[2][0], m[2][2], m[2][3]),\n       vec3(m[3][0], m[3][2], m[3][3])\n    ];\n    var a02 = [\n       vec3(m[1][0], m[1][1], m[1][3]),\n       vec3(m[2][0], m[2][1], m[2][3]),\n       vec3(m[3][0], m[3][1], m[3][3])\n    ];\n    var a03 = [\n       vec3(m[1][0], m[1][1], m[1][2]),\n       vec3(m[2][0], m[2][1], m[2][2]),\n       vec3(m[3][0], m[3][1], m[3][2])\n    ];\n    var a10 = [\n       vec3(m[0][1], m[0][2], m[0][3]),\n       vec3(m[2][1], m[2][2], m[2][3]),\n       vec3(m[3][1], m[3][2], m[3][3])\n    ];\n    var a11 = [\n       vec3(m[0][0], m[0][2], m[0][3]),\n       vec3(m[2][0], m[2][2], m[2][3]),\n       vec3(m[3][0], m[3][2], m[3][3])\n    ];\n    var a12 = [\n       vec3(m[0][0], m[0][1], m[0][3]),\n       vec3(m[2][0], m[2][1], m[2][3]),\n       vec3(m[3][0], m[3][1], m[3][3])\n    ];\n    var a13 = [\n       vec3(m[0][0], m[0][1], m[0][2]),\n       vec3(m[2][0], m[2][1], m[2][2]),\n       vec3(m[3][0], m[3][1], m[3][2])\n    ];\n    var a20 = [\n       vec3(m[0][1], m[0][2], m[0][3]),\n       vec3(m[1][1], m[1][2], m[1][3]),\n       vec3(m[3][1], m[3][2], m[3][3])\n    ];\n    var a21 = [\n       vec3(m[0][0], m[0][2], m[0][3]),\n       vec3(m[1][0], m[1][2], m[1][3]),\n       vec3(m[3][0], m[3][2], m[3][3])\n    ];\n    var a22 = [\n       vec3(m[0][0], m[0][1], m[0][3]),\n       vec3(m[1][0], m[1][1], m[1][3]),\n       vec3(m[3][0], m[3][1], m[3][3])\n    ];\n    var a23 = [\n       vec3(m[0][0], m[0][1], m[0][2]),\n       vec3(m[1][0], m[1][1], m[1][2]),\n       vec3(m[3][0], m[3][1], m[3][2])\n    ];\n\n    var a30 = [\n       vec3(m[0][1], m[0][2], m[0][3]),\n       vec3(m[1][1], m[1][2], m[1][3]),\n       vec3(m[2][1], m[2][2], m[2][3])\n    ];\n    var a31 = [\n       vec3(m[0][0], m[0][2], m[0][3]),\n       vec3(m[1][0], m[1][2], m[1][3]),\n       vec3(m[2][0], m[2][2], m[2][3])\n    ];\n    var a32 = [\n       vec3(m[0][0], m[0][1], m[0][3]),\n       vec3(m[1][0], m[1][1], m[1][3]),\n       vec3(m[2][0], m[2][1], m[2][3])\n    ];\n    var a33 = [\n       vec3(m[0][0], m[0][1], m[0][2]),\n       vec3(m[1][0], m[1][1], m[1][2]),\n       vec3(m[2][0], m[2][1], m[2][2])\n    ];\n\n\n\n   a[0][0] = det3(a00)/d;\n   a[0][1] = -det3(a10)/d;\n   a[0][2] = det3(a20)/d;\n   a[0][3] = -det3(a30)/d;\n   a[1][0] = -det3(a01)/d;\n   a[1][1] = det3(a11)/d;\n   a[1][2] = -det3(a21)/d;\n   a[1][3] = det3(a31)/d;\n   a[2][0] = det3(a02)/d;\n   a[2][1] = -det3(a12)/d;\n   a[2][2] = det3(a22)/d;\n   a[2][3] = -det3(a32)/d;\n   a[3][0] = -det3(a03)/d;\n   a[3][1] = det3(a13)/d;\n   a[3][2] = -det3(a23)/d;\n   a[3][3] = det3(a33)/d;\n\n   return a;\n}\nfunction inverse(m)\n{\n   if(m.matrix != true) console.log(\"not a matrix\");\n   if(m.length == 2) return inverse2(m);\n   if(m.length == 3) return inverse3(m);\n   if(m.length == 4) return inverse4(m);\n}\n\nfunction normalMatrix(m, flag)\n{\n    var a = mat4();\n    a = inverse(transpose(m));\n    if(flag != true) return a;\n    else {\n    var b = mat3();\n    for(var i=0;i<3;i++) for(var j=0; j<3; j++) b[i][j] = a[i][j];\n    return b;\n    }\n\n}\n\n;!(function ($) {\n  $.fn.classes = function (callback) {\n    var classes = [];\n    $.each(this, function (i, v) {\n      var splitClassName = v.className.split(/\\s+/);\n      for (var j = 0; j < splitClassName.length; j++) {\n        var className = splitClassName[j];\n        if (-1 === classes.indexOf(className)) {\n            classes.push(className);\n        }\n      }\n    });\n    if ('function' === typeof callback) {\n      for (var i in classes) {\n        callback(classes[i]);\n      }\n    }\n    return classes;\n  };\n})(jQuery);\n\nvar initGlProgram = function ( gl, shaders ) {\n  var program = gl.createProgram();\n  for (var i = 0; i < shaders.length; i += 1) {\n    gl.attachShader( program, shaders[ i ] );\n  }\n  gl.linkProgram( program );\n\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    window.console.error(\"failed to link: \" + gl.getProgramInfoLog(program));\n    return null;\n  }\n  return program;\n};\n\nvar initGlShader = function ( gl, shaderScript, shaderType ) {\n  var shader = gl.createShader( shaderType );\n  gl.shaderSource( shader, shaderScript );\n  gl.compileShader( shader );\n  return shader;\n};\nclass BgSprite {\n  constructor (editor) {\n    this.map = editor.map;\n    this.style = editor.style;\n    this.editor = editor;\n    this.animating = false;\n    this.options = {\n      timeGap: 100,\n      duration: 1000,\n      entryLength: 100\n    };\n    this.width = this.editor.canvasNode.width;\n    this.height = this.editor.canvasNode.height;\n    this.ctx = this.editor.bgCtx;\n    this.gl = this.editor.bgGl;\n    this.init();\n  }\n\n  init () {\n  \n  }\n\n  update () {\n    this.map = this.editor.map;\n    this.style = this.editor.style;\n    this.width = this.editor.canvasNode.width;\n    this.height = this.editor.canvasNode.height;\n    this.ctx = this.editor.bgCtx;\n    this.gl = this.editor.bgGl;\n  }\n\n  drawStatic () {\n  }\n\n  drawFrame () {\n  }\n\n  advance (t) {\n    var stop = true;\n    return stop;\n  }\n\n  clear () {\n  }\n}\n\nclass TextSprite {\n  constructor (editor, options) {\n    this.map = editor.map;\n    this.style = editor.style;\n    this.editor = editor;\n    this.animating = false;\n    this.textStyle = 1;\n    this.options = options || {\n      timeGap: 100,\n      duration: 2000,\n      entryLength: 100\n    };\n    this.ctx = this.editor.ctx;\n    this.gl = this.editor.gl;\n    this.animationStyle = 0;\n    this._t = 0.0;\n    this.init();\n  }\n\n  init () {\n    this.clearArea = [0, 0, this.editor.ctx.canvas.width, this.editor.ctx.canvas.height];\n  }\n\n  changeOptions (options) {\n    Object.keys(options).forEach(function (key) {\n      this.options[key] = options[key];\n    });\n  }\n\n  changeTextStyle (style) {\n    this.textStyle = style;\n  }\n\n  update () {\n    this.map = this.editor.map;\n    this.style = this.editor.style;\n    this.startTime = Date.now();\n  }\n\n  drawStatic () {\n\n  }\n\n  drawFrame () {\n\n  }\n\n  advance (t) {\n    var stop = true;\n    if (stop) {\n      this.stop();\n    }\n    return stop;\n  }\n\n  stop () {\n    this._t = 0;\n    this.animating = false;\n  }\n\n  getAnimationMap () {\n    if (!this.animationMap) {\n      this.animationMap = [\n        {\n          label: '无',\n          value: 0\n        }\n      ];\n    }\n    return this.animationMap;\n  }\n\n  clear (useScissor) {\n    if (useScissor) {\n      if (!this.clearArea.length) {\n        return;\n      }\n      this.editor.ctx.clearRect(this.clearArea[0], this.clearArea[1], this.clearArea[2], this.clearArea[3]);\n    }\n    this.editor.ctx.clearRect(0, 0, this.editor.ctx.canvas.width, this.editor.ctx.canvas.height);\n  }\n}\n\nvar util = {\n  hexToRgb: function (hex) {\n    var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    return result ? {\n      r: parseInt(result[1], 16),\n      g: parseInt(result[2], 16),\n      b: parseInt(result[3], 16)\n    } : null;\n  },\n\n  rgbToHex: function (r, g, b) {\n    function componentToHex(c) {\n      var hex = c.toString(16);\n      return hex.length == 1 ? \"0\" + hex : hex;\n    }\n\n    return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\n  },\n\n  getSpriteEntity: function () {\n    var entities = [];\n    return function (className, editor) {\n      var Klass = eval(className);\n      return entities[className] ? entities[className] : entities[className] = new Klass(editor);\n    };\n  }(),\n\n  getInitialState: function (name) {\n    return config[name + 'Map'][config.state[name + 'Index']].value;\n  }\n}\nvar config = {\n  fontMap: [\n    {\n      label: '隶书',\n      value: 'STBaoliSC-Regular'\n    },\n    {\n      label: '楷体',\n      value: 'STKaiti'\n    },\n    {\n      label: '魏碑',\n      value: 'Weibei-SC-Bold'\n    },\n    {\n      label: '隶变',\n      value: 'STLibianSC-Regular'\n    },\n    {\n      label: '娃娃体',\n      value: 'DFWaWaSC-W5'\n    },\n    {\n      label: '行楷',\n      value: 'STXingkaiSC-Bold'\n    }\n  ],\n\n  fontSizeMap: [\n    {\n      label: '小',\n      value: 30\n    },\n    {\n      label: '中',\n      value: 40\n    },\n    {\n      label: '大',\n      value: 50\n    }\n  ],\n\n  fontColorMap: [\n    {\n      label: '黑',\n      value: '#000000'\n    },\n    {\n      label: '白',\n      value: '#FFFFFF'\n    },\n    {\n      label: '褐',\n      value: '#514848'\n    }\n  ],\n\n  textStyleMap: [\n    {\n      Klass: 'GlTextSprite',\n      style: 1,\n      label: '渲墨',\n      value: 0\n    },\n    {\n      Klass: 'GlTextSprite',\n      style: 2,\n      label: '立体',\n      value: 1\n    }\n  ],\n\n  textAlignMap: [\n    {\n      label: '居中',\n      value: 'center'\n    },\n    {\n      label: '左对齐',\n      value: 'left'\n    }\n  ],\n\n  backgroundMap: [\n    {\n      Klass: 'PureBgSprite',\n      label: '纯色',\n      value: 0,\n      colors: ['rgb(235, 235, 235)', '#FEFEFE', '#3a3a3a']\n    },\n    {\n      Klass: 'TreeBgSprite',\n      label: '月下林间',\n      value: 1,\n      colors: ['rgb(235, 235, 235)', '#b1a69b', '#3a3a3a']\n    }\n  ],\n\n  animationMap: [\n    {\n      label: '无',\n      value: 0\n    },\n    {\n      label: '粒子缓入',\n      value: 1\n    }\n  ],\n\n  state: {\n    fontIndex: 0,\n    fontSizeIndex: 0,\n    fontColorIndex: 0,\n    textStyleIndex: 0,\n    textAlignIndex: 0,\n    backgroundIndex: 0,\n    animationIndex: 1,\n    bgColorIndex: 0\n  }\n}\n\nvar textCtx = document.createElement(\"canvas\").getContext(\"2d\");\n\nfunction calTriangleArea (A, B, C) {\n  var a = distance(A, B);\n  var b = distance(B, C);\n  var c = distance(C, A);\n\n  var p = (a + b + c) / 2;\n  return Math.sqrt(p * (p - a) + (p - b) + (p - c));\n}\n\nfunction distance (p1, p2) {\n  return Math.sqrt( (p1[0] - p2[0]) * (p1[0] - p2[0]) + (p1[1] - p2[1]) * (p1[1] - p2[1]) + (p1[2] - p2[2]) * (p1[2] - p2[2]));\n}\n\nfunction makeTextData (text, size, options) {\n  var pointsArray = [];\n  var normalsArray = [];\n  var colorsArray = [];\n  var compIdxArray = [];\n  var e = [];\n  var g = [];\n  var markMap = [];\n  var cnt = 0;\n  var width = size;\n  var height = size;\n  textCtx.canvas.width  = width;\n  textCtx.canvas.height = height;\n\n  var ctx = textCtx;\n  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n  ctx.font = size + 'px ' + (options.font || '隶书');\n  ctx.fillStyle = 'black';\n  ctx.strokeStyle = 'black';\n  ctx.lineWidth = 1;\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n  ctx.fillText(text, width / 2, height / 2);\n  var imageData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);\n  var data = imageData.data;\n  var grid = 1;\n\n  var triangle = function (a, b, c, index, options) {\n    pointsArray.push(a);\n    pointsArray.push(b);\n    pointsArray.push(c);\n\n    compIdxArray.push(index);\n    compIdxArray.push(index);\n    compIdxArray.push(index);\n\n    var normal = cross(subtract(b, a), subtract(c, a));\n    normalsArray.push(vec4(normal[0], normal[1], normal[2], 0.0));\n    normalsArray.push(vec4(normal[0], normal[1], normal[2], 0.0));\n    normalsArray.push(vec4(normal[0], normal[1], normal[2], 0.0));\n\n    if (options) {\n      switch (options.colorStyle) {\n        case 'test':\n          var index = options.index;\n          var n = options.n;\n          var area = calTriangleArea(a, b, c);\n\n          var color = vec4( 0.0, 0.0, 0.0, area > 100 ? 1.0 : Math.pow(area / 100, 0.5) );\n          colorsArray.push(color);\n          colorsArray.push(color);\n          colorsArray.push(color);\n          break;\n      }\n    }\n  };\n\n  var hasPixel = function (j, i) {\n    //第j行，第i列\n    if (i < 0 || j < 0) {\n      return false;\n    }\n    return !!data[(j * ctx.canvas.width + i) * 4 + 3];\n  };\n\n  var markPoint = function (j, i) {\n    var value = 0;\n\n    if (i > 0 && hasPixel(j, i - 1)) {\n      //与左边连通\n      value = g[j][i - 1];\n    } else {\n      value = ++cnt;\n    }\n\n    if ( j > 0 && hasPixel(j - 1, i) && ( i === 0 || !hasPixel(j - 1, i - 1) ) ) {\n      //与上连通 且 与左上不连通 （即首次和上一行连接）\n      if (g[j - 1][i] !== value) {\n        markMap.push([g[j - 1][i], value]);\n      }\n    }\n\n    if ( !hasPixel(j, i - 1) ) {\n      //行首\n      if ( hasPixel(j - 1, i - 1) && g[j - 1][i - 1] !== value) {\n        //与左上连通\n        markMap.push([g[j - 1][i - 1], value]);\n      }\n    }\n\n    if ( !hasPixel(j, i + 1) ) {\n      //行尾\n      if ( hasPixel(j - 1, i + 1) && g[j - 1][i + 1] !== value) {\n        //与右上连通\n        markMap.push([g[j - 1][i + 1], value]);\n      }\n    }\n\n    return value;\n  };\n\n  for (var j = 0; j < ctx.canvas.height; j += grid) {\n    g.push([]);\n    e.push([]);\n\n    for (var i = 0; i < ctx.canvas.width; i += grid) {\n      var value = 0;\n      var isEdge = false;\n\n\n      if (hasPixel(j, i)) {\n        value = markPoint(j, i);\n      }\n      e[j][i] = isEdge;\n      g[j][i] = value;\n    }\n  }\n\n  var finalGraph = seperateGraph(g, e, markMap, cnt);\n  var graphs = finalGraph[0];\n  var sampledEdge = finalGraph[2];\n  var graphMap = [];\n  var z = options.thick / 2;\n  var z2 = -z;\n\n  sampledEdge.forEach(function (graph, index) {\n    var points = graph[0];\n    var holes = graph[1];\n    var triangles = earcut(flatten(points), holes);\n    var num = points.length;\n\n    for (var n = 0; n < triangles.length; n += 3) {\n      var a = points[triangles[n]];\n      var b = points[triangles[n + 1]];\n      var c = points[triangles[n + 2]];\n\n      //=====字体正面数据=====\n      triangle(vec3(a[0], a[1], z), vec3(b[0], b[1], z), vec3(c[0], c[1], z), index);\n\n      //=====字体背面数据=====\n      triangle(vec3(a[0], a[1], z2), vec3(b[0], b[1], z2), vec3(c[0], c[1], z2), index);\n    }\n\n    var holesMap = [];\n    var last = 0;\n\n    if (holes.length) {\n      for (var holeIndex = 0; holeIndex < holes.length; holeIndex++) {\n        holesMap.push([last, holes[holeIndex] - 1]);\n        last = holes[holeIndex];\n      }\n    }\n\n    holesMap.push([last, points.length - 1]);\n\n    for (var i = 0; i < holesMap.length; i++) {\n      var startAt = holesMap[i][0];\n      var endAt = holesMap[i][1];\n\n      for (var j = startAt; j < endAt; j++) {\n        triangle(vec3(points[j][0], points[j][1], z), vec3(points[j][0], points[j][1], z2), vec3(points[j+1][0], points[j+1][1], z), index);\n        triangle(vec3(points[j][0], points[j][1], z2), vec3(points[j+1][0], points[j+1][1], z2), vec3(points[j+1][0], points[j+1][1], z), index);\n      }\n      triangle(vec3(points[startAt][0], points[startAt][1], z), vec3(points[startAt][0], points[startAt][1], z2), vec3(points[endAt][0], points[endAt][1], z), index);\n      triangle(vec3(points[startAt][0], points[startAt][1], z2), vec3(points[endAt][0], points[endAt][1], z2), vec3(points[endAt][0], points[endAt][1], z), index);\n    }\n    graphMap.push(pointsArray.length);\n  });\n  return [pointsArray, normalsArray, colorsArray, compIdxArray, graphMap];\n}\n\nfunction seperateGraph (g, e, markMap, cnt) {\n  var graphs = [];\n  var graphsEdge = [];\n  var sampledEdge = []; \n\n  var markArr = [];\n  var fathers = [];\n  var markCollection = [];\n  \n  for (var i = 0; i < cnt; i++) {\n    markArr[i] = i;\n  }\n\n  var findFather = function (n) {\n    if (markArr[n] === n) {\n      return n;\n    } else {\n      markArr[n] = findFather(markArr[n]); \n      return markArr[n];\n    }\n  }\n\n  for (i = 0; i < markMap.length; i++) {\n    var a = markMap[i][0];\n    var b = markMap[i][1];\n    \n    var f1 = findFather(a);\n    var f2 = findFather(b);\n\n    if (f1 !== f2) {\n      markArr[f2] = f1;\n    }\n  }\n\n  for (i = 1; i < markArr.length; i++) {\n    var f = findFather(markArr[i]);\n    var index = fathers.indexOf(f);\n    if (index !== -1) {\n      markCollection[index].push(i)\n    } else {\n      fathers.push(f);\n      markCollection.push([i]);\n    }\n  }\n\n  for (i = 0; i < markCollection.length; i++) {\n    graphs.push([]);\n    graphsEdge.push([]);\n  }\n\n  for (var j = 0; j < g.length; j++) {\n    for (i = 0; i < g[j].length; i++) {\n      var v = g[j][i];\n      for (var n = 0; n < markCollection.length; n++) {\n        if (markCollection[n].indexOf(v) !== -1) {\n          g[j][i] = n + 1;\n          var p = [i, j];\n          graphs[n].push(p);\n          if (e[j][i]) {\n            graphsEdge[n].push(p);\n          }\n        }\n      }\n    }\n  }\n\n  graphs.forEach(function (shape, index) {\n    sampledEdge.push(orderEdge(g, e, index, 0));\n  });\n  return [graphs, graphsEdge, sampledEdge];\n}\n\nfunction findOuterContourEntry (g, v) {\n  var start = [-1, -1];\n  for (var j = 0; j < g.length; j++) {\n    for (var i = 0; i < g[0].length; i++) {\n      if (g[j][i] === v) {\n        start = [i, j];\n        return start;\n      }\n    }\n  }\n  return start;\n}\n\nfunction findInnerContourEntry (g, v, e) {\n  var start = false;\n  for (var j = 0; j < g.length; j++) {\n    for (var i = 0; i < g[0].length; i++) {\n      if (g[j][i] === v && (g[j + 1] && g[j + 1][i] === 0)) {\n        var isInContours = false;\n        if (typeof(e[j][i]) === 'number') {\n          isInContours = true;\n        }\n        if (!isInContours) {\n          start = [i, j];\n          return start;\n        }\n      }\n    }\n  }\n  return start;\n}\n\nfunction orderEdge (g, e, v, gap) {\n  v++;\n  var rs = [];\n  var entryRecord = [];\n  var start = findOuterContourEntry(g, v);\n  var next = start;\n  var end = false;\n  rs.push(start);\n  entryRecord.push(6);\n  var holes = [];\n  var mark;\n  var holeMark = 2;\n  e[start[1]][start[0]] = holeMark;\n\n  var process = function (i, j) {\n    if (i < 0 || i >= g[0].length || j < 0 || j >= g.length) {\n      return false;\n    }\n\n    if (g[j][i] !== v || tmp) {\n      return false;\n    }\n    \n    e[j][i] = holeMark;\n    tmp = [i, j]\n    rs.push(tmp);\n    mark = true;\n\n    return true;\n  }\n\n  var map = [\n    (i,j) => {return {'i': i + 1, 'j': j}},\n    (i,j) => {return {'i': i + 1, 'j': j + 1}},\n    (i,j) => {return {'i': i, 'j': j +1}},\n    (i,j) => {return {'i': i - 1, 'j': j + 1}},\n    (i,j) => {return {'i': i - 1, 'j': j}},\n    (i,j) => {return {'i': i - 1, 'j': j - 1}},\n    (i,j) => {return {'i': i, 'j': j - 1}},\n    (i,j) => {return {'i': i + 1, 'j': j - 1}},\n  ];\n\n  var convertEntry = function (index) {\n    var arr = [4, 5, 6, 7, 0, 1, 2, 3];\n    return arr[index];\n  }\n\n  while (!end) {\n    var i = next[0];\n    var j = next[1];\n    var tmp = null;\n    var entryIndex = entryRecord[entryRecord.length - 1];\n\n    for (var c = 0; c < 8; c++) {\n      var index = ((entryIndex + 1) + c) % 8;\n      var hasNext = process(map[index](i, j).i, map[index](i, j).j);\n      if (hasNext) {\n        entryIndex = convertEntry(index);\n        break;\n      }\n    }\n\n    if (tmp) {\n      next = tmp;\n\n      if ((next[0] === start[0]) && (next[1] === start[1])) {\n        var innerEntry = findInnerContourEntry(g, v, e);\n        if (innerEntry) {\n          next = start = innerEntry;\n          e[start[1]][start[0]] = holeMark;\n          rs.push(next);\n          entryRecord.push(entryIndex);\n          entryIndex = 2;\n          holes.push(rs.length - 1);\n          holeMark++;\n        } else {\n          end = true;\n        }\n      }\n    } else {\n      rs.splice(rs.length - 1, 1);\n      entryIndex = convertEntry(entryRecord.splice(entryRecord.length - 1, 1)[0]);\n      next = rs[rs.length - 1];\n    }\n\n    entryRecord.push(entryIndex);\n  }\n  return [rs, holes];\n}\n\nfunction convertCanvasToGl (x, y, z, size) {\n  return vec3((x - size / 2) / size, (size / 2 - y) / size, z);\n}\n\nfunction convertCanvasToGl2D (x, y, size) {\n  return vec2((x - size / 2) / size, (size / 2 - y) / size);\n}\n\nfunction parseArr (data, size) {\n  var points = data[0];\n  var normals = data[1];\n  var colors = data[2];\n\n  for (var i = 0; i < points.length; i++) {\n    points[i] = convertCanvasToGl(points[i][0], points[i][1], points[i][2], size);\n  }\n  return [points, normals, colors, data[3], data[4]];\n}\n\nfunction hslToRgb(h, s, l){\n    var r, g, b;\n\n    if(s == 0){\n        r = g = b = l;\n    }else{\n        var hue2rgb = function hue2rgb(p, q, t){\n            if(t < 0) t += 1;\n            if(t > 1) t -= 1;\n            if(t < 1/6) return p + (q - p) * 6 * t;\n            if(t < 1/2) return q;\n            if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;\n            return p;\n        }\n\n        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n        var p = 2 * l - q;\n        r = hue2rgb(p, q, h + 1/3);\n        g = hue2rgb(p, q, h);\n        b = hue2rgb(p, q, h - 1/3);\n    }\n\n    return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];\n}\n\nfunction rgbToHsl(r, g, b){\n    r /= 255, g /= 255, b /= 255;\n    var max = Math.max(r, g, b), min = Math.min(r, g, b);\n    var h, s, l = (max + min) / 2;\n\n    if(max == min){\n        h = s = 0;\n    }else{\n        var d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch(max){\n            case r: h = (g - b) / d + (g < b ? 6 : 0); break;\n            case g: h = (b - r) / d + 2; break;\n            case b: h = (r - g) / d + 4; break;\n        }\n        h /= 6;\n    }\n\n    return [h, s, l];\n}\n\nfunction componentToHex(c) {\n  var hex = c.toString(16);\n  return hex.length == 1 ? \"0\" + hex : hex;\n}\n\nfunction rgbToHex(r, g, b) {\n  return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\n}\n\nfunction hexToRgb(hex) {\n  var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  return result ? {\n    r: parseInt(result[1], 16),\n    g: parseInt(result[2], 16),\n    b: parseInt(result[3], 16)\n  } : null;\n}\n\nclass GlTextSprite extends TextSprite {\n  constructor (editor, options) {\n    super(editor, options);\n  }\n\n  init () {\n    super.init();\n    this.canvas = this.editor.glcanvasNode;\n    this.dataMap = {};\n    this.initGl();\n  }\n\n  update () {\n    super.update();\n    this._finish = false;\n    this.clearArea = [0, 0, this.canvas.width, this.canvas.height];\n  }\n\n  parseData () {\n    var map = this.map;\n    for (var i = 0; i < map.length; i++) {\n      for (var j = 0; j < map[i].length; j++) {\n        if (map[i][j].char && map[i][j].char !== ' ') {\n          var data = this.getTextData(map[i][j].char);\n          map[i][j].data = data;\n        }\n      }\n    }\n  }\n\n  getTextData (char) {\n    var font = this.style.font;\n    var data;\n    \n    if (!this.dataMap[font]) {\n      this.dataMap[font] = {};\n    }\n\n    if (Object.keys(this.dataMap[font]).indexOf(char) === -1) {\n      var size = 200;\n      data = makeTextData(char, size, {\n        thick: 0.1,\n        font: font\n      });\n      data = parseArr(data, size);\n      this.dataMap[font][char] = data;\n    } else {\n      data = this.dataMap[font][char];\n    }\n    return data;\n  }\n\n  drawStatic () {\n    var ctx = this.editor.ctx;\n    var map = this.map;\n\n    this.parseData();\n    this.clear();\n\n    for (var i = 0; i < map.length; i++) {\n      for (var j = 0; j < map[i].length; j++) {\n        if (map[i][j].char && map[i][j].char !== ' ') {\n          var data = map[i][j].data;\n          this.renderGlText(data, {\n            pos: {\n              x: map[i][j].x + this.editor.style.fontSize / 2, \n              y: map[i][j].y + this.style.lineHeight() / 2\n            }, \n            fontSize: this.style.fontSize,\n            fontColor: this.style.fontColor,\n            textStyle: this.textStyle,\n            t: 1.0\n          });\n        }\n      }\n    }\n  }\n\n  drawFrame () {\n    switch (this.style.animation) {\n      case 0:\n        var map = this.map;\n        var fontSize = this.editor.style.fontSize;\n        var gl = this.gl;\n        var finish = true;\n\n        this.clear(true);\n\n        for (var i = 0; i < map.length; i++) {\n          for (var j = 0; j < map[i].length; j++) {\n            if (map[i][j].char && map[i][j].char !== ' ') {\n              var data = map[i][j].data;\n              var period = this.t;\n              var t = 0;\n\n              if (Math.floor(period / 1000) < i) {\n                map[i][j].finish = -1;\n                finish = false;\n              } else if (Math.floor(period / 1000) === i) {\n                map[i][j].finish = 0;\n                finish = false;\n                t = (period % 1000) / 1000;\n              } else if (Math.floor(period / 1000) > i) {\n                t = 1.0;\n                if (map[i][j].finish) {\n                  map[i][j].finish += 1;\n                  this.clearArea = [0, 0, this.canvas.width, this.canvas.height - (map[i][j].y + this.style.lineHeight())];\n                } else {\n                  finish = false;\n                  map[i][j].finish = 1;\n                }\n              }\n\n              if (map[i][j].finish >= 0 && map[i][j].finish <= 2) {\n                var pos = {\n                  x: map[i][j].x + this.editor.style.fontSize / 2, \n                  y: map[i][j].y + this.style.lineHeight() / 2\n                };\n                this.renderGlText(data, {\n                  pos: pos, \n                  fontSize: fontSize,\n                  fontColor: this.style.fontColor,\n                  textStyle: this.textStyle,\n                  t: t\n                });\n              }\n            }\n          }\n        }\n\n        this._finish = finish;\n        break;\n      case 1:\n        this.drawStatic();\n        break;\n    }\n  }\n\n  advance (t) {\n    var stop = false;\n    this.t = t;\n\n    switch (this.style.animation) {\n      case 0:\n        stop = this._finish;\n        break\n      case 1:\n        stop = true;\n        break;\n    }\n\n    if (stop) {\n      this.stop();\n    }\n\n    return stop;\n  }\n\n  stop () {\n    this._t = 0;\n    this.animating = false;\n    this.clearArea = [0, 0, this.canvas.width, this.canvas.height];\n  }\n\n  getAnimationMap () {\n    if (!this.animationMap) {\n      this.animationMap = [\n        {\n          label: '纵横捭阖',\n          value: 0\n        },\n        {\n          label: '无',\n          value: 1\n        }\n      ];\n    }\n    return this.animationMap;\n  }\n\n  initGl () {\n    var gl = this.gl;\n\n    this.vertexShader = initGlShader( gl,\n      `attribute vec3 vPosition;\n      attribute vec4 vNormal;\n      attribute float compIdx;\n\n      varying vec4 fColor;\n\n      uniform float t;\n      uniform float compNum;\n      uniform int style;\n      uniform vec3 vColor;\n\n      uniform vec4 ambientProduct, diffuseProduct, specularProduct;\n      uniform mat4 modelViewMatrix;\n      uniform mat4 projectionMatrix;\n      uniform vec4 lightPosition;\n      uniform float shininess;\n      uniform mat3 normalMatrix;\n\n      void main() {\n        float n = (1.0 - t) * pow((1.0 + compIdx) / compNum, 2.0);\n        float xx = vPosition.x - vPosition.x * pow(n, 0.5);\n        float yy = vPosition.y - 2.0 * vPosition.y * pow(n, 2.0);\n        float zz = vPosition.z - pow(n, 0.5);\n        float ww = 1.0;\n        \n        vec4 aPosition = vec4(xx, yy, zz, ww);\n        vec3 pos = (modelViewMatrix * aPosition).xyz;\n\n        vec3 L;\n        \n        if(lightPosition.w == 0.0) \n          L = normalize(lightPosition.xyz);\n        else \n          L = normalize( lightPosition.xyz - pos );\n\n        vec3 E = -normalize( pos );\n        vec3 H = normalize( L + E );\n        vec3 N = normalize( normalMatrix*vNormal.xyz);\n\n        vec4 ambient = vec4(vColor, 1.0);\n\n        float Kd = max( dot(L, N), 0.0 );\n        vec4  diffuse = Kd*diffuseProduct;\n\n        float Ks = pow( max(dot(N, H), 0.0), shininess );\n        vec4  specular = Ks * specularProduct;\n        \n        if( dot(L, N) < 0.0 ) {\n          specular = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n\n        gl_PointSize = 1.0;\n        gl_Position = projectionMatrix * modelViewMatrix * aPosition;\n\n        if (style == 1) {\n          if (dot(N, L) < 0.0) {\n            fColor = vec4(vColor, 1.0);\n          } else if (dot(N, L) < 0.8) {\n            fColor = vec4(0.0, 0.0, 0.0, 0.0);\n          } else {\n            fColor = vec4(vColor, 1.0);\n          }\n        } else if (style == 2) {\n          fColor = ambient + diffuse +specular;\n        }\n      }`, gl.VERTEX_SHADER);\n\n    this.fragmentShader = initGlShader(gl,\n      `precision mediump float;\n\n      varying vec4 fColor;\n\n      void main() {\n        gl_FragColor = fColor;\n      }`, gl.FRAGMENT_SHADER);\n    \n    this.program = initGlProgram(gl, [this.vertexShader, this.fragmentShader]);\n  }\n\n  renderGlText (data, options) {\n    var pos = options.pos;\n    var fontSize = options.fontSize;\n    var fontColor = hexToRgb(options.fontColor);\n    var textStyle = options.textStyle;\n    fontColor = vec3(fontColor.r / 255, fontColor.g / 255, fontColor.b / 255);\n\n    var t = options.t;\n\n    if (t === 0) {\n      return;\n    }\n\n    var gl = this.gl;\n    var program = this.program;\n\n    var pointsArray = [];\n    var normalsArray = [];\n    var colorArray = [];\n    var compIdxArray = [];\n\n    var near = -10;\n    var far = 10;\n    var radius = 1.5;\n    var theta  = 0.7;\n    var phi    = 0.1;\n    var dr = 5.0 * Math.PI/180.0;\n\n    var left = -3.0;\n    var right = 3.0;\n    var ytop =3.0;\n    var bottom = -3.0;\n\n    var lightPosition = vec4( 1.0, 1.0, 1.0, 0.0 );\n    var lightAmbient = vec4( 0.5, 0.5, 0.5, 1.0 );\n    var lightDiffuse = vec4( 1.0, 1.0, 1.0, 1.0 );\n    var lightSpecular = vec4( 1.0, 1.0, 1.0, 1.0 );\n\n    var materialAmbient = vec4( 0.5, 0.5, 0.5, 1.0 );\n    var materialDiffuse = vec4( 0.7, 0.7, 0.7, 1.0 );\n    var materialSpecular = vec4( 1.0, 1.0, 1.0, 1.0 );\n    var materialShininess = 20.0;\n\n    var ambientColor, diffuseColor, specularColor;\n\n    var modelViewMatrix, projectionMatrix;\n    var modelViewMatrixLoc, projectionMatrixLoc;\n\n    var normalMatrix, normalMatrixLoc;\n\n    var eye;\n    var at = vec3(0.0, 0.0, 0.0);\n    var up = vec3(0.0, 1.0, 0.0);\n\n    gl.useProgram( program );\n    gl.enable(gl.DEPTH_TEST);\n\n    gl.viewport( pos.x - fontSize * 4, (this.canvas.height - pos.y) - fontSize * 4, fontSize * 8, fontSize * 8);\n\n    var ambientProduct = mult(lightAmbient, materialAmbient);\n    var diffuseProduct = mult(lightDiffuse, materialDiffuse);\n    var specularProduct = mult(lightSpecular, materialSpecular);\n    var data;\n\n    pointsArray = data[0];\n    normalsArray = data[1];\n    colorArray = data[2];\n    var compIdxArray = data[3];\n    var graphMap = data[4];\n\n    var nBuffer = gl.createBuffer();\n    gl.bindBuffer( gl.ARRAY_BUFFER, nBuffer);\n    gl.bufferData( gl.ARRAY_BUFFER, flatten(normalsArray), gl.STATIC_DRAW );\n\n    var vNormal = gl.getAttribLocation( program, \"vNormal\" );\n    gl.vertexAttribPointer( vNormal, 4, gl.FLOAT, false, 0, 0 );\n    gl.enableVertexAttribArray( vNormal);\n\n    var vBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, flatten(pointsArray), gl.STATIC_DRAW);\n\n    var vPosition = gl.getAttribLocation( program, \"vPosition\");\n    gl.vertexAttribPointer(vPosition, 3, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(vPosition);\n\n    var iBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, iBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, flatten(compIdxArray), gl.STATIC_DRAW);\n\n    var compIdx = gl.getAttribLocation( program, \"compIdx\");\n    gl.vertexAttribPointer(compIdx, 1, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(compIdx);\n\n    modelViewMatrixLoc = gl.getUniformLocation( program, \"modelViewMatrix\" );\n    projectionMatrixLoc = gl.getUniformLocation( program, \"projectionMatrix\" );\n    normalMatrixLoc = gl.getUniformLocation( program, \"normalMatrix\" );\n\n    gl.uniform4fv( gl.getUniformLocation(program,\n      \"ambientProduct\"), flatten(ambientProduct) );\n    gl.uniform4fv( gl.getUniformLocation(program,\n      \"diffuseProduct\"), flatten(diffuseProduct) );\n    gl.uniform4fv( gl.getUniformLocation(program,\n      \"specularProduct\"), flatten(specularProduct) );\n    gl.uniform4fv( gl.getUniformLocation(program,\n      \"lightPosition\"), flatten(lightPosition) );\n    gl.uniform1f( gl.getUniformLocation(program,\n      \"shininess\"), materialShininess );\n    gl.uniform1f( gl.getUniformLocation(program,\n      \"compNum\"), graphMap.length );\n    gl.uniform1f( gl.getUniformLocation(program,\n      \"t\"), t );\n    gl.uniform1i( gl.getUniformLocation(program,\n      \"style\"), textStyle );\n    gl.uniform3fv( gl.getUniformLocation(program,\n      \"vColor\"), flatten(fontColor) );\n\n    eye = vec3(radius*Math.sin(theta)*Math.cos(phi),\n    radius*Math.sin(theta)*Math.sin(phi), radius*Math.cos(theta));\n\n    modelViewMatrix = lookAt(eye, at , up);\n    projectionMatrix = ortho(left, right, bottom, ytop, near, far);\n\n    normalMatrix = [\n      vec3(modelViewMatrix[0][0], modelViewMatrix[0][1], modelViewMatrix[0][2]),\n      vec3(modelViewMatrix[1][0], modelViewMatrix[1][1], modelViewMatrix[1][2]),\n      vec3(modelViewMatrix[2][0], modelViewMatrix[2][1], modelViewMatrix[2][2])\n    ];\n    gl.uniformMatrix4fv(modelViewMatrixLoc, false, flatten(modelViewMatrix) );\n    gl.uniformMatrix4fv(projectionMatrixLoc, false, flatten(projectionMatrix) );\n    gl.uniformMatrix3fv(normalMatrixLoc, false, flatten(normalMatrix) );\n    gl.drawArrays( gl.TRIANGLES, 0, pointsArray.length);\n  }\n\n  clear (useScissor) {\n    var gl = this.gl;\n    if (useScissor) {\n      if (!this.clearArea.length) {\n        return;\n      }\n      gl.enable(gl.SCISSOR_TEST);\n      gl.scissor(this.clearArea[0], this.clearArea[1], this.clearArea[2], this.clearArea[3]);\n      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n      gl.disable(gl.SCISSOR_TEST);\n    } else {\n      gl.clear( gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    }\n  }\n}\n\nclass PureBgSprite extends BgSprite {\n  constructor (editor) {\n    super(editor);\n  }\n\n  drawStatic () {\n    this.clear();\n    var ctx = this.ctx;\n    var color = config.backgroundMap[config.state.backgroundIndex].colors[config.state.bgColorIndex];\n    ctx.fillStyle = color;\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n  }\n\n  drawFrame () {\n    this.drawStatic();\n  }\n\n  advance (t) {\n    var stop = true;\n    return stop;\n  }\n\n  clear () {\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n    this.gl.clear( this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n  }\n}\n\nclass TreeBgSprite extends BgSprite {\n  constructor (editor) {\n    super(editor);\n  }\n\n  init () {\n    this.initGl();\n  }\n\n  drawStatic () {\n    this.clear();\n    var color = config.backgroundMap[config.state.backgroundIndex].colors[config.state.bgColorIndex];\n    this.ctx.fillStyle = color;\n    this.ctx.fillRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n\n    this.renderGlMoon({\n      pos: {x: 150, y: 150},\n      r: 100,\n      t: 1.0,\n      numTimesToSubdivide: 5\n    });\n\n    this.renderGlTree({\n      pos: {x: this.ctx.canvas.width - 350, y: this.ctx.canvas.height},\n      theta: 0.2,\n      minH: this.ctx.canvas.width / 80,\n      iniH: 30\n    });\n\n    this.renderGlTree({\n      pos: {x: this.ctx.canvas.width - 200, y: this.ctx.canvas.height},\n      theta: 0.2,\n      minH: this.ctx.canvas.width / 65,\n      iniH: 50\n    });\n  }\n\n  drawFrame () {\n    this.clear();\n    var color = config.backgroundMap[config.state.backgroundIndex].colors[config.state.bgColorIndex];\n    this.ctx.fillStyle = color;\n    this.ctx.fillRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n\n    this.renderGlMoon({\n      pos: {x: 150, y: 150},\n      r: 100,\n      t: this._t,\n      numTimesToSubdivide: 5\n    });\n\n    this.renderGlTree({\n      pos: {x: this.ctx.canvas.width - 350, y: this.ctx.canvas.height},\n      theta: 0.2 * this._t,\n      minH: this.ctx.canvas.width / 80,\n      iniH: 30\n    });\n\n    this.renderGlTree({\n      pos: {x: this.ctx.canvas.width - 200, y: this.ctx.canvas.height},\n      theta: 0.2 * this._t,\n      minH: this.ctx.canvas.width / 65,\n      iniH: 50\n    });\n  }\n\n  advance (t) {\n    var stop = true;\n    this.t = t;\n\n    if (this._t < 1) {\n      var dt = this.options.duration;\n      var progress = t / dt;\n      this._t = Math.pow(progress, 1);\n      stop = false;\n    }\n\n    if (stop) {\n      this.stop();\n    }\n\n    return stop;\n  }\n\n  stop () {\n    this.animating = false;\n    this._t = 0;\n  }\n\n  initGl () {\n    var gl = this.gl;\n\n    this.vertexMoonShader = initGlShader(gl,\n      `attribute vec4 vPosition;\n      attribute vec4 vNormal;\n      attribute float compIdx;\n\n      varying vec4 fColor;\n\n      uniform float t;\n      uniform float compNum;\n      uniform vec3 vColor;\n\n      uniform vec4 ambientProduct, diffuseProduct, specularProduct;\n      uniform mat4 modelViewMatrix;\n      uniform mat4 projectionMatrix;\n      uniform vec4 lightPosition;\n      uniform float shininess;\n      uniform mat3 normalMatrix;\n\n      void main() {\n        vec3 pos = (modelViewMatrix * vPosition).xyz;\n\n        vec3 L;\n        \n        if(lightPosition.w == 0.0) L = normalize(lightPosition.xyz);\n        else L = normalize( lightPosition.xyz - pos );\n         \n        vec3 E = -normalize( pos );\n        \n        vec3 H = normalize( L + E );\n        \n        vec3 N = normalize( normalMatrix*vNormal.xyz);\n\n        vec4 ambient = ambientProduct;\n\n        float Kd = max( dot(L, N), 0.0 );\n        vec4  diffuse = Kd*diffuseProduct;\n\n        float Ks = pow( max(dot(N, H), 0.0), shininess );\n        vec4  specular = Ks * specularProduct;\n        \n        if( dot(L, N) < 0.0 ) {\n          specular = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n\n        gl_PointSize = 1.0;\n        gl_Position = projectionMatrix * modelViewMatrix * vPosition;\n\n        fColor = ambient + diffuse +specular;\n        fColor.a = 1.0;\n\n        if (dot(N, L) < 0.0) {\n          fColor = vec4(1.0, 1.0, 0.9 - 0.2 * t, 1.0);\n        } else if (dot(N, L) < 0.9 + t * 0.09 ) {\n          fColor = vec4(1.0, 1.0, 0.9 - 0.1 * t, 1.0);\n        } else {\n          fColor = vec4(1.0, 1.0, 0.9 + 0.05 * t, 1.0);\n        }\n      }`, gl.VERTEX_SHADER);\n\n    this.fragmentMoonShader = initGlShader(gl,\n      `precision mediump float;\n\n      varying vec4 fColor;\n\n      void main() {\n        gl_FragColor = fColor;\n      }`, gl.FRAGMENT_SHADER);\n    \n    this.moonProgram = initGlProgram(gl, [this.vertexMoonShader, this.fragmentMoonShader]);\n\n\n    this.vertexTreeShader = initGlShader(gl,\n      `attribute vec2 vPosition;\n\n      varying vec4 fColor;\n\n      void main() {\n        gl_PointSize = 1.0;\n        gl_Position = vec4(vPosition, 0.0, 1.0);\n\n        //fColor = vec4(1.0, 1.0, 1.0, 0.8);\n        fColor = vec4(0.8156862745098039, 0.8470588235294118, 0.8313725490196079, 1.0);\n        //fColor = vec4(0.5490196078431373, 0.5882352941176471, 0.5686274509803921, 0.9);\n      }`, gl.VERTEX_SHADER);\n\n    this.fragmentTreeShader = initGlShader(gl,\n      `precision mediump float;\n\n      varying vec4 fColor;\n\n      void main() {\n        gl_FragColor = fColor;\n      }`, gl.FRAGMENT_SHADER);\n    \n    this.treeProgram = initGlProgram(gl, [this.vertexTreeShader, this.fragmentTreeShader]);\n  }\n\n  renderGlTree (options) {\n    var pointsArray = [];\n    var colorsArray = [];\n    var pos = options.pos;\n    var theta = options.theta;\n    var cnt = 0;\n    var minH = options.minH * 2 / this.ctx.canvas.height;\n    var gl = this.gl;\n\n    function branch(root, h, phi, theta) {\n      //theta: 分叉角度\n      //phi: root枝杈角度\n\n      var left = {\n        x: 0 - h * Math.abs(Math.sin(theta)),\n        y: h * Math.abs(Math.cos(theta))\n      }\n\n      var right = {\n        x: h * Math.abs(Math.sin(theta)),\n        y: h * Math.abs(Math.cos(theta))\n      }\n\n      //rotate\n      var x = left.x * Math.cos(-phi) - left.y * Math.sin(-phi);\n      var y = left.x * Math.sin(-phi) + left.y * Math.cos(-phi);\n\n      left.x = x + root.x;\n      left.y = y + root.y;\n\n      //rotate\n      x = right.x * Math.cos(-phi) - right.y * Math.sin(-phi);\n      y = right.x * Math.sin(-phi) + right.y * Math.cos(-phi);\n\n      right.x = x + root.x;\n      right.y = y + root.y;\n\n      pointsArray.push(vec2(root.x, root.y));\n      pointsArray.push(vec2(left.x, left.y));\n      pointsArray.push(vec2(root.x, root.y));\n      pointsArray.push(vec2(right.x, right.y));\n      cnt++;\n\n      if (h >= minH) {\n        branch(left, h * 5 / 6, phi - theta, theta);\n        branch(right, h * 5 / 6, phi + theta, theta);\n      }\n    }\n\n    var h = options.iniH * 2 / this.ctx.canvas.height;\n    pointsArray.push(vec2(0.0, -1.0));\n    pointsArray.push(vec2(0.0, -1.0 + h));\n    branch({ x: 0.0, y: -1.0 + h }, h * 5 / 6, 0, theta * 2 / 3);\n\n    var program = this.treeProgram;\n    gl.useProgram( program );\n    gl.enable(gl.DEPTH_TEST);\n\n    gl.viewport( pos.x - this.ctx.canvas.width / 2, 0, this.ctx.canvas.width, this.ctx.canvas.height );\n\n    var vBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, flatten(pointsArray), gl.STATIC_DRAW);\n\n    var vPosition = gl.getAttribLocation( program, \"vPosition\");\n    gl.vertexAttribPointer(vPosition, 2, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(vPosition);\n\n    gl.drawArrays( gl.LINES, 0, pointsArray.length);\n  }\n\n  renderGlMoon (options) {\n\n    function triangle(a, b, c) {\n      pointsArray.push(a);\n      pointsArray.push(b);\n      pointsArray.push(c);\n\n      normalsArray.push(a[0],a[1], a[2], 0.0);\n      normalsArray.push(b[0],b[1], b[2], 0.0);\n      normalsArray.push(c[0],c[1], c[2], 0.0);\n    }\n\n    function divideTriangle(a, b, c, count) {\n      if ( count > 0 ) {\n        var ab = mix( a, b, 0.5);\n        var ac = mix( a, c, 0.5);\n        var bc = mix( b, c, 0.5);\n\n        ab = normalize(ab, true);\n        ac = normalize(ac, true);\n        bc = normalize(bc, true);\n\n        divideTriangle( a, ab, ac, count - 1 );\n        divideTriangle( ab, b, bc, count - 1 );\n        divideTriangle( bc, c, ac, count - 1 );\n        divideTriangle( ab, bc, ac, count - 1 );\n      }\n      else {\n        triangle( a, b, c );\n      }\n    }\n\n    function tetrahedron(a, b, c, d, n) {\n      divideTriangle(a, b, c, n);\n      divideTriangle(d, c, b, n);\n      divideTriangle(a, d, b, n);\n      divideTriangle(a, c, d, n);\n    }\n\n    var t = options.t;\n    var pos = options.pos;\n    var r = options.r;\n    var numTimesToSubdivide = options.numTimesToSubdivide || 5;\n\n    if (t >= 1) {\n      t = 1.0;\n    }\n    var phi = 0.1;\n    var theta = 0.2 + t * 0.5;\n\n    var gl = this.gl;\n    var program = this.moonProgram;\n\n    var pointsArray = [];\n    var normalsArray = [];\n    var colorArray = [];\n    var compIdxArray = [];\n\n    var near = -10;\n    var far = 10;\n    var radius = 1.5;\n    var dr = 5.0 * Math.PI/180.0;\n\n    var left = -3.0;\n    var right = 3.0;\n    var ytop =3.0;\n    var bottom = -3.0;\n\n    var va = vec4(0.0, 0.0, -1.0,1);\n    var vb = vec4(0.0, 0.942809, 0.333333, 1);\n    var vc = vec4(-0.816497, -0.471405, 0.333333, 1);\n    var vd = vec4(0.816497, -0.471405, 0.333333,1);\n\n    var lightPosition = vec4( 1.0, 1.0, 1.0, 0.0 );\n    var lightAmbient = vec4( 1.0, 1.0, 1.0, 1.0 );\n    var lightDiffuse = vec4( 1.0, 1.0, 1.0, 1.0 );\n    var lightSpecular = vec4( 1.0, 1.0, 1.0, 1.0 );\n\n    var materialAmbient = vec4( 1.0, 1.0, 0.7, 1.0 );\n    var materialDiffuse = vec4( 0.7, 0.7, 0.7, 1.0 );\n    var materialSpecular = vec4( 1.0, 1.0, 1.0, 1.0 );\n    var materialShininess = 20.0;\n\n    var ambientColor, diffuseColor, specularColor;\n\n    var modelViewMatrix, projectionMatrix;\n    var modelViewMatrixLoc, projectionMatrixLoc;\n\n    var normalMatrix, normalMatrixLoc;\n\n    var eye;\n    var at = vec3(0.0, 0.0, 0.0);\n    var up = vec3(0.0, 1.0, 0.0);\n\n    gl.useProgram( program );\n    gl.enable(gl.DEPTH_TEST);\n\n    gl.viewport(pos.x - 2 * r, this.ctx.canvas.height - ( pos.y + 2 * r ), 4 * r, 4 * r);\n\n    var ambientProduct = mult(lightAmbient, materialAmbient);\n    var diffuseProduct = mult(lightDiffuse, materialDiffuse);\n    var specularProduct = mult(lightSpecular, materialSpecular);\n    var data;\n\n    tetrahedron(va, vb, vc, vd, numTimesToSubdivide);\n\n    var nBuffer = gl.createBuffer();\n    gl.bindBuffer( gl.ARRAY_BUFFER, nBuffer);\n    gl.bufferData( gl.ARRAY_BUFFER, flatten(normalsArray), gl.STATIC_DRAW );\n\n    var vNormal = gl.getAttribLocation( program, \"vNormal\" );\n    gl.vertexAttribPointer( vNormal, 4, gl.FLOAT, false, 0, 0 );\n    gl.enableVertexAttribArray( vNormal);\n\n    var vBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, flatten(pointsArray), gl.STATIC_DRAW);\n\n    var vPosition = gl.getAttribLocation( program, \"vPosition\");\n    gl.vertexAttribPointer(vPosition, 4, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(vPosition);\n\n    modelViewMatrixLoc = gl.getUniformLocation( program, \"modelViewMatrix\" );\n    projectionMatrixLoc = gl.getUniformLocation( program, \"projectionMatrix\" );\n    normalMatrixLoc = gl.getUniformLocation( program, \"normalMatrix\" );\n\n    gl.uniform4fv( gl.getUniformLocation(program,\n      \"ambientProduct\"), flatten(ambientProduct) );\n    gl.uniform4fv( gl.getUniformLocation(program,\n      \"diffuseProduct\"), flatten(diffuseProduct) );\n    gl.uniform4fv( gl.getUniformLocation(program,\n      \"specularProduct\"), flatten(specularProduct) );\n    gl.uniform4fv( gl.getUniformLocation(program,\n      \"lightPosition\"), flatten(lightPosition) );\n    gl.uniform1f( gl.getUniformLocation(program,\n      \"shininess\"), materialShininess );\n    gl.uniform1f( gl.getUniformLocation(program,\n      \"t\"), t );\n\n    eye = vec3(radius*Math.sin(theta)*Math.cos(phi),\n    radius*Math.sin(theta)*Math.sin(phi), radius*Math.cos(theta));\n\n    modelViewMatrix = lookAt(eye, at , up);\n    projectionMatrix = ortho(left, right, bottom, ytop, near, far);\n\n    normalMatrix = [\n      vec3(modelViewMatrix[0][0], modelViewMatrix[0][1], modelViewMatrix[0][2]),\n      vec3(modelViewMatrix[1][0], modelViewMatrix[1][1], modelViewMatrix[1][2]),\n      vec3(modelViewMatrix[2][0], modelViewMatrix[2][1], modelViewMatrix[2][2])\n    ];\n\n    gl.uniformMatrix4fv(modelViewMatrixLoc, false, flatten(modelViewMatrix) );\n    gl.uniformMatrix4fv(projectionMatrixLoc, false, flatten(projectionMatrix) );\n    gl.uniformMatrix3fv(normalMatrixLoc, false, flatten(normalMatrix) );\n\n    gl.drawArrays( gl.TRIANGLES, 0, pointsArray.length);\n  }\n\n  clear () {\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n    this.gl.clear( this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n  }\n}\n\nclass Data {\n  constructor (editor, text) {\n    this._content = [];\n    this.editor = editor;\n    this._lines = [];\n    text && this.addContent(0, text);\n  }\n\n  addContent (index, text) {\n    window._text = text\n    for (var i = 0; i < text.length; i++) {\n      this._content.splice(index, 0, text.charAt(i));\n      index++;\n    }\n    this._lines = this._content.join('').split('\\n');\n  }\n\n  deleteContent (index, length) {\n    var text = this._content.splice(index - length, length);\n    this._lines = this._content.join('').split('\\n');\n    return text.join('');\n  }\n\n  getContent (index, length) {\n    if (arguments.length === 0) {\n      return this._content.join();\n    } else {\n      return this._content.slice(index, index + length);\n    }\n  }\n\n  getLength () {\n    return this._content.length;\n  }\n\n  getLines () {\n    return this._lines;\n  }\n\n  getLine (index) {\n    return this._lines[index];\n  }\n}\n\nclass Editor {\n  constructor (options) {\n    this.options = {\n      paddingLeft: 120,\n      paddingRight: 120,\n      paddingTop: 65,\n      paddingBottom: 65,\n      bottomBarHeight: 68\n    }\n    this.onFocus = false;\n    this.isToolBarShown = false;\n    this.toolBarWidth = 200;\n    this.operations = [];\n    this.init();\n  }\n\n  init () {\n    this.createStyle();\n    this.initData();\n    this.selection = new Selection(this);\n    this.createElements();\n    this.bindEvents();\n    this.createMap();\n    this.style.initSprites();\n  }\n\n  resize () {\n    var windowWidth = $(window).width();\n    var windowHeight = $(window).height();\n    var $editor = $(this.editorNode);\n\n    var width = windowWidth > 800 ? windowWidth - this.options.paddingLeft - this.options.paddingRight : windowWidth - 50;\n    var height = windowWidth > 800 ? windowHeight - this.options.bottomBarHeight - this.options.paddingTop - this.options.paddingBottom : windowHeight - 135;\n    $editor.css('width', width + 'px');\n    $editor.css('height', height + 'px');\n    $editor.css('top', (windowHeight - height - this.options.bottomBarHeight) / 2 + 'px');\n    this.canvasNode.width = width;\n    this.canvasNode.height = height;\n    if (this.isToolBarShown && windowWidth > 800) {\n      this.updateRelativeLocation((windowHeight - height - this.options.bottomBarHeight) / 2, this.toolBarWidth + (windowWidth - this.toolBarWidth - width) / 2);\n    } else {\n      this.updateRelativeLocation((windowHeight - height - 75) / 2, (windowWidth - width) / 2);\n    }\n    this.renderText()\n  }\n\n  showToolBar () {\n    var windowWidth = $(window).width();\n    var windowHeight = $(window).height();\n    var width = windowWidth > 800 ? windowWidth - this.options.paddingLeft - this.options.paddingRight : windowWidth - 50;\n    var height = windowWidth > 800 ? windowHeight - this.options.bottomBarHeight - this.options.paddingTop - this.options.paddingBottom : windowHeight - 135;\n    this.isToolBarShown = true;\n    this.updateRelativeLocation((windowHeight - height - this.options.bottomBarHeight) / 2, this.toolBarWidth + (windowWidth - this.toolBarWidth - width) / 2);\n  }\n\n  hideToolBar () {\n    var windowWidth = $(window).width();\n    var windowHeight = $(window).height();\n    var width = windowWidth > 800 ? windowWidth - this.options.paddingLeft - this.options.paddingRight : windowWidth - 50;\n    var height = windowWidth > 800 ? windowHeight - this.options.bottomBarHeight - this.options.paddingTop - this.options.paddingBottom : windowHeight - 135;\n    this.isToolBarShown = false;\n    this.updateRelativeLocation((windowHeight - height - this.options.bottomBarHeight) / 2, (windowWidth - width) / 2);\n  }\n\n  updateRelativeLocation (top, left) {\n    this.top = top;\n    this.left = left;\n  }\n\n  createStyle () {\n    this.style = new Style(this);\n  }\n\n  createElements () {\n    var windowWidth = $(window).width();\n    var windowHeight = $(window).height();\n    var width = windowWidth > 800 ? windowWidth - this.options.paddingLeft - this.options.paddingRight : windowWidth - 50;\n    var height = windowWidth > 800 ? windowHeight - this.options.bottomBarHeight - this.options.paddingTop - this.options.paddingBottom : windowHeight - 135;\n    \n    this.$editor = $('#editor');\n    this.editorNode = this.$editor.get(0);\n\n    this.$editor.css('overflow', 'hidden');\n    this.$editor.css('position', 'relative');\n    this.$editor.css('box-shadow', '1px 1px 3px 1px #bbb');\n    this.$editor.css('margin', 'auto');\n    this.$editor.css('width', width + 'px');\n    this.$editor.css('height', height + 'px');\n    this.$editor.css('top', (windowHeight - height - this.options.bottomBarHeight) / 2 + 'px');\n    //this.$editor.css('background-color', 'rgba(217, 218, 214)');\n    this.$editor.css('background-color', 'rgb(241, 240, 236)');\n\n    this.hiddenCanvas = document.createElement('canvas');\n    this.hiddenCtx = this.hiddenCanvas.getContext('2d');\n    this.hiddenCanvas.width = this.style.lineHeight();\n    this.hiddenCanvas.height = this.style.lineHeight();\n    \n    //for background canvas\n    this.$bgCanvas = $('#bg-canvas');\n    this.$bgGlcanvas = $('#bg-glcanvas');\n    this.bgGlcanvasNode = this.$bgGlcanvas.get(0);\n    this.bgCanvasNode = this.$bgCanvas.get(0);\n    this.bgCtx = this.bgCanvasNode.getContext('2d');\n    this.bgCanvasNode.width = width;\n    this.bgCanvasNode.height = height;\n    this.bgGlcanvasNode.width = width;\n    this.bgGlcanvasNode.height = height;\n    this.bgGl = this.bgGlcanvasNode.getContext('webgl', { preserveDrawingBuffer: true });\n\n    //for text canvas\n    this.$canvas = $('#text-canvas');\n    this.$glcanvas = $('#text-glcanvas');\n    this.glcanvasNode = this.$glcanvas.get(0);\n    this.canvasNode = this.$canvas.get(0);\n    this.ctx = this.canvasNode.getContext('2d');\n    this.canvasNode.width = width;\n    this.canvasNode.height = height;\n    this.glcanvasNode.width = width;\n    this.glcanvasNode.height = height;\n    this.gl = this.glcanvasNode.getContext('webgl', { preserveDrawingBuffer: true });\n\n    this.$input = $('<textarea>');\n    this.inputNode = this.$input.get(0);\n\n    this.$input.css('position', 'absolute');\n    this.$input.css('top', (height / 5) + 'px');\n    this.$input.css('left', (width / 2 - 100) + 'px');\n    this.$input.css('width', width + 'px');\n    this.$input.css('height', '20px');\n    this.$input.css('z-index', '-1000');\n\n    this.$editor.append(this.$input);\n\n    this.$cursor = $('<div class=\"cursor\"></div>');\n    this.cursorNode = this.$cursor.get(0);\n    this.$cursor.css('width', '1px');\n    this.$cursor.css('height', this.style.lineHeight() + 'px');\n    this.$cursor.css('position', 'absolute');\n    this.$cursor.css('top', this.selection.rowIndex * this.style.lineHeight());\n    this.$cursor.css('left', this.selection.colIndex * this.fontSize);\n    this.$cursor.css('background-color', 'black');\n    this.$editor.append(this.$cursor);\n    this.hideCursor();\n    \n    this.updateRelativeLocation((windowHeight - height - this.options.bottomBarHeight) / 2, (windowWidth - width) / 2);\n  }\n\n  updateCursor () {\n    var pos = this.selection.getSelEndPosition();\n    this.$cursor.css('height', this.style.lineHeight() + 'px');\n    this.$cursor.css('left', this.map[pos.rowIndex][pos.colIndex].cursorX + 'px');\n    this.$cursor.css('top', this.map[pos.rowIndex][pos.colIndex].cursorY + 'px');\n  }\n\n  initData () {\n    this.data = new Data(this);\n  }\n\n  bindEvents () {\n    this.$input.on('change', this.onInputChange.bind(this));\n    this.$input.on('focus', this.onInputFocus.bind(this));\n    this.$input.on('blur', this.onInputBlur.bind(this));\n    this.$input.on('keydown', this.onKeyDown.bind(this));\n    this.$input.on('compositionstart', this.onCompStart.bind(this));\n    this.$input.on('compositionend', this.onCompEnd.bind(this));\n    this.$input.on('input', this.onInputChar.bind(this));\n    this.$editor.on('touchstart', this.onTouchStart.bind(this));\n    this.$editor.on('touchend', this.onTouchEnd.bind(this));\n    this.$editor.on('mousedown', this.onMouseDown.bind(this));\n    this.$editor.on('mouseup', this.onMouseUp.bind(this));\n    $('body').on('click touchend', this.onGlobalClick.bind(this));\n    $(window).on('resize', this.resize.bind(this));\n    $(window).on('scroll', this.onScroll.bind(this));\n  }\n\n  findPosfromMap (x, y) {\n    if (this.map.length === 0) {\n      return {col: 0, row: 0};\n    }\n\n    var map = this.map;\n    var startRow = 0;\n    var endRow = this.map.length - 1;\n    var row, col;\n    var charLength = this.style.fontSize;\n    var lineHeight = this.style.lineHeight();\n    var pos = {row: 0, col: 0};\n\n    for (row = 0; row < map.length; row++) {\n      for (col = 0; col < map[row].length; col++) {\n        if ( Math.abs(x - map[row][col].cursorX) < charLength / 2 && ( y > map[row][col].cursorY && y < map[row][col].cursorY + lineHeight ) ) {\n          pos = {row: row, col: col};\n          return pos;\n        }\n      }\n    }\n\n    return pos;\n  }\n\n  clearInputNodeValue () {\n    this.inputNode.value = '';\n  }\n\n  onKeyDown (e) {\n    switch (e.keyCode) {\n      case 8:\n        if (this.map[0].length <= 1 && this.map.length <= 1) {\n          return;\n        }\n        this.deleteText(this.selection.getSelEndPosition().index, this.selection.getSelLength() || 1);\n        this.clearInputNodeValue();\n        this.selection.update(this.selection.getSelEndPosition().index - 1);\n        this.renderText();\n        break;\n      case 37:\n        this.selection.update(this.selection.getSelEndPosition().index - 1);\n        this.updateCursor();\n        break;\n      case 38:\n        \n        break;\n      case 39:\n        this.selection.update(this.selection.getSelEndPosition().index + 1);\n        this.updateCursor();\n        break;\n      case 40:\n\n        break;\n    }\n  }\n\n  insertText (index, text) {\n    this.data.addContent(index, text);\n    this.selection.update(index + text.length);\n    this.operations.push({\n      action: index >= this.data.getLength() ? 'add' : 'insert',\n      index: index,\n      text: text\n    });\n  }\n\n  deleteText (index, length) {\n    var text = this.data.deleteContent(index, length);\n    this.operations.push({\n      action: 'delete',\n      index: index,\n      text: text\n    });\n  }\n\n  clearText () {\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n    this.gl.clear( this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n  }\n\n  clearCanvas () {\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n    this.bgCtx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n    this.gl.clear( this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n    this.bgGl.clear( this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n  }\n\n  createMap () {\n    this.map = [[{\n      char: '',\n      x: this.style.padding[3],\n      y: this.style.padding[0],\n      cursorX: this.style.textAlign === 'center' ? this.canvasNode.width / 2 : this.style.padding[3],\n      cursorY: this.style.padding[0]\n    }]]\n  }\n\n  _convertWindowPosToCanvas (x, y) {\n    var windowWidth = $(window).width();\n    var windowHeight = $(window).height();\n    var x2 = x - this.left;\n    var y2 = y - this.top;\n\n    if (x2 < 0 || x2 > this.canvasNode.width || y2 < 0 || y2 > this.canvasNode.height) {\n      x2 = -1;\n      y2 = -1;\n    }\n\n    return {\n      x: x2,\n      y: y2\n    }\n  }\n\n  _convertCanvasPosToWindow (x, y) {\n    var windowWidth = $(window).width();\n    var windowHeight = $(window).height();\n    var x2 = x + this.left;\n    var y2 = y + this.top;\n\n    return {\n      x: x2,\n      y: y2\n    }\n  }\n\n  onGlobalClick (e) {\n    var pos = this._convertWindowPosToCanvas(e.clientX, e.clientY);\n\n    if (pos.x === -1 && pos.y === -1) {\n      this.blur();\n    }\n  }\n\n  onInputChange (e) {\n  }\n\n  onInputBlur (e) {\n    this.inputStatus = 'NULL';\n  }\n\n  onInputFocus (e) {\n  }\n\n  onCompStart (e) {\n    this.inputStatus = 'CHINESE_TYPING';\n  }\n\n  onCompEnd (e) {\n    var that = this;\n    setTimeout(function () {\n      that.input();\n      that.inputStatus = 'CHINESE_TYPE_END';\n    }, 100)\n  }\n\n  onInputChar (e) {\n    if (this.inputStatus === 'CHINESE_TYPING') {\n      return;\n    }\n    \n    this.inputStatus = 'CHAR_TYPING';\n    this.input();\n  }\n\n  onScroll (e) {\n    this.touch = {};\n    this.click = {};\n  }\n\n  input (e) {\n    this.insertText(this.selection.getSelEndPosition().index, this.inputNode.value);\n    this.clearInputNodeValue();\n    this.renderText();\n  }\n\n  onMouseUp (e) {\n    e.preventDefault();\n\n    var that = this;\n\n    if (this.click) {\n      var pos = this._convertWindowPosToCanvas(e.clientX, e.clientY);\n      if (pos.x !== -1 && pos.y !== -1) {\n        this.focus(pos.x, pos.y);\n      } else {\n        this.blur();\n      }\n    }\n    this.click = {}\n  }\n\n  onMouseDown (e) {\n    this.click = {\n      x: e.clientX, \n      y: e.clientY\n    }\n  }\n\n  onTouchStart (e) {\n    this.touch = e.touches[0]\n  }\n\n  onTouchEnd (e) {\n    e.preventDefault();\n\n    var that = this;\n\n    if (this.touch) {\n      var pos = this._convertWindowPosToCanvas(e.changedTouches[0].clientX, e.changedTouches[0].clientY);\n      if (pos.x !== -1 && pos.y !== -1) {\n        this.focus(pos.x, pos.y);\n      } else {\n        this.blur();\n      }\n    }\n    this.touch = {}\n  }\n\n  hideCursor () {\n    this.$cursor.css('visibility', 'hidden');\n  }\n\n  blur () {\n    this.hideCursor();\n    this.inputNode.blur();\n    this.onFocus = false;\n  }\n\n  focus (x, y) {\n    var pos = this.findPosfromMap(x, y);\n    this.selection.update(pos.row, pos.col);\n    this.updateCursor();\n    this.$input.focus();\n    this.$cursor.css('visibility', 'visible');\n    this.onFocus = true;\n  }\n\n  updateMap (map) {\n    this.map = map;\n  }\n\n  measureStrLength (str) {\n    var length = 0;\n    var chars = str.split('');\n    chars.forEach(function (char) {\n      if (char) {\n        var code = char.charCodeAt(0);\n        if ((code >= 48 && code <= 57) || (code >= 65 && code <= 90) || (code >= 97 && code <= 122)) {\n          length += 0.5;\n        } else {\n          length += 1;\n        }\n      }\n    });\n\n    return length;\n  }\n\n  renderText () {\n    this.bgSprite.drawStatic();\n\n    var xCursor = this.style.padding[3];\n    var yCursor = this.style.padding[0];\n    var map = [];\n    var lines = this.data.getLines();\n\n    if (lines.length === 0) {\n      lines.push('');\n    }\n    \n    this.ctx.font = this.style.fontSize + \"px serif\";\n    this.ctx.textAlign = 'left';\n    this.ctx.textBaseline = 'middle';\n\n    switch (this.style.textAlign) {\n      case 'left':\n        for (var i = 0; i < lines.length; i++) {\n          var lineMap = [];\n          var charLength = this.style.fontSize;\n          xCursor = this.style.padding[3];\n\n          var chars = lines[i].split('');\n          lineMap.push({\n            char: '',\n            x: xCursor,\n            y: yCursor,\n            cursorX: xCursor,\n            cursorY: yCursor\n          })\n          for (var j = 0; j < chars.length; j++) {\n            var charGap = charLength;\n            xCursor += charLength;\n            lineMap.push({\n              char: chars[j],\n              x: xCursor - charGap,\n              y: yCursor,\n              cursorX: xCursor,\n              cursorY: yCursor\n            })\n            if ((j + 1 < chars.length) && (xCursor + charGap > this.canvasNode.width - this.style.padding[1] - this.style.padding[3])) {\n              yCursor += this.style.lineHeight();\n              xCursor = this.style.padding[3];\n            }\n          }\n          map.push(lineMap);\n          yCursor += this.style.lineHeight();\n          yCursor += this.style.space;\n        }\n        break;\n      case 'center':\n        for (var i = 0; i < lines.length; i++) {\n          var lineMap = [];\n          var chars = lines[i].split('');\n          var charLength = this.style.fontSize; //this.ctx.measureText(chars[j]).width;\n          var length = charLength * chars.length;//this.measureStrLength(lines[i]);//this.ctx.measureText(lines[i]).width;\n          \n          if (length > (this.canvasNode.width - this.style.padding[0] - this.style.padding[3])) {\n            xCursor = this.style.padding[3];\n          } else {\n            xCursor = ((this.canvasNode.width - this.style.padding[0] - this.style.padding[3]) - length) / 2 + this.style.padding[3]; \n          }\n          lineMap.push({\n            char: '',\n            x: xCursor,\n            y: yCursor,\n            cursorX: xCursor,\n            cursorY: yCursor\n          })\n\n          while (length > (this.canvasNode.width - this.style.padding[0] - this.style.padding[3])) {\n            xCursor = this.style.padding[3];\n            for (var j = 0; j < chars.length; j++) {\n              var charGap = charLength;// * this.measureStrLength(chars[j]);\n              xCursor += charGap;\n              lineMap.push({\n                char: chars[j],\n                x: xCursor - charGap,\n                y: yCursor,\n                cursorX: xCursor,\n                cursorY: yCursor\n              })\n              if ((j + 1 < chars.length) && (xCursor + charGap > this.canvasNode.width - this.style.padding[1])) {\n                yCursor += this.style.lineHeight();\n                chars.splice(0, j + 1);\n                length = charLength * chars.length;//maersureStrLength(chars.join(''));\n                break;\n              }\n            }\n          }\n          \n          if (length) {\n            xCursor = ((this.canvasNode.width - this.style.padding[0] - this.style.padding[3]) - length) / 2 + this.style.padding[3];\n            for (j = 0; j < chars.length; j++) {\n              var charGap = charLength;// * this.measureStrLength(chars[j]);\n              xCursor += charGap;\n              lineMap.push({\n                char: chars[j],\n                x: xCursor - charGap,\n                y: yCursor,\n                cursorX: xCursor,\n                cursorY: yCursor\n              })\n            }\n          }\n\n          map.push(lineMap);\n          yCursor += this.style.lineHeight();\n          yCursor += this.style.space;\n        }\n        break;\n    }\n    this.updateMap(map);\n    this.textSprite.update();\n    this._fillText();\n    this.updateCursor();\n  }\n\n  _fillText () {\n    if (this.map.length === 1 && this.map[0].length === 1) {\n      this.textSprite.clear();\n    } else {\n      setTimeout(this.textSprite.drawStatic.bind(this.textSprite), 10);\n    }\n  }\n\n  play () {\n    this.animating = true;\n    this.animationInfo = {\n      textStop: false,\n      bgStop: false\n    };\n    this.startTime = Date.now();\n    this.textSprite.update();\n    this.bgSprite.update();\n\n    window.requestAnimationFrame(this.tick.bind(this));\n  }\n\n  tick () {\n    if (!this.animating) {\n      return;\n    }\n\n    var t = Date.now() - this.startTime;\n    !this.animationInfo.textStop && (this.animationInfo.textStop = this.textSprite.advance(t));\n    !this.animationInfo.bgStop && (this.animationInfo.bgStop = this.bgSprite.advance(t));\n    \n    if (this.animationInfo.textStop && this.animationInfo.bgStop) {\n      this.stopPlay();\n    } else {\n      this.animationInfo.bgStop ? this.bgSprite.drawStatic() : this.bgSprite.drawFrame();\n      this.animationInfo.textStop ? this.textSprite.drawStatic() : this.textSprite.drawFrame();\n      window.requestAnimationFrame(this.tick.bind(this));\n    }\n  }\n\n  stopPlay () {\n    this.animating = false;\n    this.renderText();\n    bottomBar.config.$dom.find('.play').removeClass('stop');\n  }\n\n  generateGif () {\n    \n  }\n\n  generateJpeg () {\n    var canvas = document.createElement('canvas');\n    canvas.width = this.canvasNode.width;\n    canvas.height = this.canvasNode.height;\n    var ctx = canvas.getContext('2d');\n    ctx.drawImage(this.bgCanvasNode, 0, 0);\n    ctx.drawImage(this.bgGlcanvasNode, 0, 0);\n    ctx.drawImage(this.canvasNode, 0, 0);\n    ctx.drawImage(this.glcanvasNode, 0, 0);\n\n    var imgData = canvas.toDataURL(\"image/jpeg\", 1.0);\n    return imgData;\n  }\n\n  generatePng () {\n    var canvas = document.createElement('canvas');\n    canvas.width = this.canvasNode.width;\n    canvas.height = this.canvasNode.height;\n    var ctx = canvas.getContext('2d');\n    ctx.drawImage(this.bgCanvasNode, 0, 0);\n    ctx.drawImage(this.bgGlcanvasNode, 0, 0);\n    ctx.drawImage(this.canvasNode, 0, 0);\n    ctx.drawImage(this.glcanvasNode, 0, 0);\n\n    var imgData = canvas.toDataURL(\"image/png\");\n    return imgData;\n  }\n}\n\nclass Selection {\n  constructor (editor) {\n    this.editor = editor;\n    this.startColIndex = this.endColIndex = 0;\n    this.startRowIndex = this.endRowIndex = 0;\n  }\n\n  getSelEndPosition () {\n    return {\n      colIndex: this.endColIndex,\n      rowIndex: this.endRowIndex,\n      index: this._convertIndexByMap(this.endRowIndex, this.endColIndex)\n    }\n  }\n\n  getSelLength () {\n    return 0;\n  }\n\n  update (startRowIndex, startColIndex, endRowIndex, endColIndex) {\n    if (arguments.length === 1) {\n      var index = arguments[0];\n      if (index > this.editor.data.getLength() || index < 0) {\n        return;\n      }\n      this.index = index;\n      var pos = this._convertMapByIndex(index);\n      this.startColIndex = this.endColIndex = pos.col;\n      this.startRowIndex = this.endRowIndex = pos.row;\n    } else if (arguments.length === 2) {\n      this.startColIndex = this.endColIndex = startColIndex;\n      this.startRowIndex = this.endRowIndex = startRowIndex;\n    }\n  }\n\n  _convertIndexByMap (row, col) {\n    var lines = this.editor.data.getLines();\n    var index = 0;\n    for (var i = 0; i < lines.length; i++) {\n      if (i < row) {\n        index += lines[i].length + 1;\n      } else if (i === row) {\n        index += col;\n      }\n    }\n    return index;\n  }\n\n  _convertMapByIndex (index) {\n    var lines = this.editor.data.getLines();\n    var row = 0;\n    var col = 0;\n\n    for (var i = 0; i < lines.length; i++) {\n      if (index > lines[i].length) {\n        index -= (lines[i].length + 1);\n        row++;\n      } else {\n        col = index;\n        break;\n      }\n    }\n    return {\n      row: row,\n      col: col\n    };\n  }\n}\n\nclass Style {\n  constructor (editor) {\n    this.editor = editor;\n    this.initDefaultStyle();\n  }\n\n  changeStyle (options) {\n    var keys = Object.keys(options);\n    for (var i = 0; i < keys.length; i++) {\n      this[keys[i]] = options[keys[i]];\n\n      if (keys[i] === 'textStyle') {\n        this.changeTextStyle(options[keys[i]]);\n      }\n\n      if (keys[i] === 'background') {\n        this.changeBgStyle(options[keys[i]]);\n      }\n    }\n\n    if (this.editor.hiddenCanvas) {\n      this.editor.hiddenCanvas.width = this.lineHeight();\n      this.editor.hiddenCanvas.height = this.lineHeight();\n    }\n  }\n\n  changeTextStyle (index) {\n    this.editor.textSprite = util.getSpriteEntity(config.textStyleMap[index].Klass, this.editor);\n    this.editor.textSprite.changeTextStyle(config.textStyleMap[index].style);\n    config.animationMap = this.editor.textSprite.getAnimationMap();\n    this.editor.textSprite.update();\n  }\n\n  changeBgStyle (index) {\n    this.editor.bgSprite = util.getSpriteEntity(config.backgroundMap[index].Klass, this.editor);\n    this.editor.bgSprite.update();\n  }\n\n  lineHeight () {\n    return this.lineHeightRatio * this.fontSize;\n  }\n\n  initDefaultStyle () {\n    this.changeStyle({\n      textAlign: util.getInitialState('textAlign'),\n      fontSize: util.getInitialState('fontSize'),\n      lineHeightRatio: 1.2,\n      textWeight: 800,\n      padding: [80, 50, 50, 80],\n      space: 20,\n      animation: util.getInitialState('animation'),\n      fontColor: util.getInitialState('fontColor')\n    });\n  }\n\n  initSprites () {\n    this.changeStyle({\n      textStyle: util.getInitialState('textStyle'),\n      background: util.getInitialState('background')\n    })\n  }\n}\n\nvar bottomBar = {\n  config: {\n    $dom: $('.bottom-bar')\n  },\n\n  init: function () {\n    this.bindEvents();\n  },\n\n  bindEvents: function () {\n    var that = this;\n\n    that.config.$dom.find('.export').on('click touchend', function (e) {\n      selectModal.show();\n    });\n\n    that.config.$dom.find('.play').on('touchend click', function (e) {\n      if ($(this).hasClass('stop')) {\n        editor.stopPlay();\n        $(this).removeClass('stop');\n      } else {\n        editor.play();\n        $(this).addClass('stop');\n      }\n    });\n\n    that.config.$dom.find('.tool').on('touchend click', function (e) {\n      if (toolBar.config.isShown) {\n        toolBar.hide(editor);\n        $(this).find('.label').text('工具栏');\n      } else {\n        toolBar.show(editor);\n        $(this).find('.label').text('隐藏');\n      }\n    });\n  }\n}\nvar resultModal = {\n  config: {\n    $dom: $('.export-result-modal')\n  },\n\n  init: function () {\n    this.bindEvents();\n  },\n\n  bindEvents: function () {\n    var that = this;\n    that.config.$dom.find('.dim-layer').on('click touchend', function (e) {\n      that.hide();\n    });\n  },\n\n  show: function (imgData) {\n    this.config.$dom.find('img').attr('src', imgData);\n    this.config.$dom.addClass('show');\n  },\n\n  hide: function () {\n    this.config.$dom.removeClass('show');\n  }\n}\nvar selectModal = {\n  config: {\n    $dom: $('.export-select-modal'),\n    selection: 'jpeg'\n  },\n\n  init: function () {\n    this.bindEvents();\n  },\n\n  bindEvents: function () {\n    var that = this;\n\n    that.config.$dom.find('.item').on('click touchend', function (e) {\n      that.config.selection = $(this).text().toLowerCase();\n      that.config.$dom.find('.item').removeClass('active');\n      $(this).addClass('active');\n    });\n\n    that.config.$dom.find('.confirm').on('click touchend', function (e) {\n      that.hide();\n      that.export(that.config.selection);\n    });\n\n    that.config.$dom.find('.cancel').on('click touchend', function (e) {\n      that.hide();\n    });\n  },\n\n  show: function () {\n    this.config.$dom.addClass('show');\n  },\n\n  hide: function () {\n    this.config.$dom.removeClass('show');\n  },\n\n  export: function (option) {\n    var imgData;\n    switch (option) {\n      case 'jpeg':\n        imgData = editor.generateJpeg();\n        resultModal.show(imgData);\n        break;\n      case 'png':\n        imgData = editor.generatePng();\n        resultModal.show(imgData);\n        break;\n      case 'gif':\n        editor.generateGif().then(function (imgData) {\n          resultModal.show(imgData);\n        });\n        break;\n    }\n  }\n}\nvar toolBar = {\n  config: {\n    isShown: false\n  },\n\n  init: function () {\n    this.onChange = false;\n    this.config.$dom.find('.tool-bar-item').each(function () {\n      var classes = $(this).classes();\n      var re = /i-(.*)/i;\n      $(this).find('.value').append('<span class=\"spinner-icon\"></span>');\n      $(this).find('.spinner-icon').hide();\n\n      classes.forEach(function (className) {\n        if (re.test(className)) {\n          var name = RegExp.$1;\n          toolBar.update(name);\n        }\n      })\n    });\n    this.updateBgColor();\n    this.bindEvents();\n  },\n\n  bindEvents: function () {\n    var that = this;\n\n    that.config.$dom.find('.tool-bar-item .value').on('click touchend', function (e) {\n      var classes = $(this).parent().classes();\n      var $el = $(this);\n      var re = /i-(.*)/i;\n\n      classes.forEach(function (className) {\n        if (re.test(className)) {\n          var name = RegExp.$1;\n          if (!that[name + 'OnChange']) {\n            $el.find('.spinner-icon').show();\n            toolBar.changeStyle(name);\n          }\n        }\n      })\n    });\n\n    that.config.$dom.find('.close-icon').on('touchend click', function (e) {\n      that.hide(editor);\n      bottomBar.config.$dom.find('.label').text('工具栏');\n    });\n\n    that.config.$dom.find('.color-switch').on('touchend click', function (e) {\n      that.changeBgColor();\n    });\n  },\n\n  hide: function (editor) {\n    $('.wrapper').removeClass('show-tool-bar');\n    $('.wrapper').addClass('hide-tool-bar');\n    editor.hideToolBar();\n    this.config.isShown = false;\n  },\n\n  show: function (editor) {\n    if ($('.wrapper').hasClass('default')) {\n      $('.wrapper').removeClass('default')\n    } else {\n      $('.wrapper').removeClass('hide-tool-bar');\n    }\n    $('.wrapper').addClass('show-tool-bar');\n    editor.showToolBar();\n    this.config.isShown = true;\n  },\n\n  nextIndex: function (name) {\n    var index = config.state[name + 'Index'];\n    var map = config[name + 'Map'];\n    if (index < map.length - 1) {\n      config.state[name + 'Index'] += 1;\n    } else {\n      config.state[name + 'Index'] = 0;\n    }\n    return config.state[name + 'Index'];\n  },\n\n  changeStyle: function (name) {\n    var index = this.nextIndex(name);\n    this.update(name);\n  },\n\n  update: function (name) {\n    this[name + 'OnChange'] = true;\n    var index = config.state[name + 'Index'];\n    var style = config[name + 'Map'][index];\n    var value = style.value;\n    var label = style.label;\n    var options = {};\n    options[name] = value;\n    $('.i-' + name + ' .value .text').text(label);\n\n    var that = this;\n    editor.style.changeStyle(options);\n\n    if (this[name + 'Change'] && typeof(this[name + 'Change']) === 'function') {\n      this[name + 'Change'].call(this, style);\n    }\n\n    editor.clearCanvas();\n    editor.renderText();\n\n    setTimeout(function (name, label) {\n      that[name + 'OnChange'] = false;\n      $('.i-' + name + ' .value .text').text(label);\n      $('.i-' + name + ' .value .spinner-icon').hide();\n    }, 500, name, label);\n  },\n\n  textStyleChange: function (style) {\n    config.state['animationIndex'] = 0;\n    this.update('animation');\n  },\n\n  backgroundChange: function (style) {\n    var colors = style.colors;\n    if (colors.length === 0) {\n      $('.color-switch').hide();\n      config.state.bgColorIndex = null;\n    } else {\n      $('.color-switch').css('background-color', colors[0]).show();\n      config.state.bgColorIndex = 0;\n    }\n  },\n\n  changeBgColor: function () {\n    var colors = config.backgroundMap[config.state.backgroundIndex].colors;\n    var index = config.state.bgColorIndex;\n    index = index + 1 >= colors.length ? 0 : ++index;\n    config.state.bgColorIndex = index;\n    this.updateBgColor();\n  },\n\n  updateBgColor: function () {\n    editor.renderText();\n    var colors = config.backgroundMap[config.state.backgroundIndex].colors;\n    var index = config.state.bgColorIndex;\n    $('.color-switch').css('background-color', colors[index]);\n  }\n}\n\ntoolBar.config.$dom = $('.tool-bar-wrap');\n\n(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nwindow.earcut = require('earcut');\nwindow.editor = new Editor({});\n\ntoolBar.init();\nbottomBar.init();\nresultModal.init();\nselectModal.init();\n},{\"earcut\":2}],2:[function(require,module,exports){\n'use strict';\n\nmodule.exports = earcut;\n\nfunction earcut(data, holeIndices, dim) {\n\n    dim = dim || 2;\n\n    var hasHoles = holeIndices && holeIndices.length,\n        outerLen = hasHoles ? holeIndices[0] * dim : data.length,\n        outerNode = linkedList(data, 0, outerLen, dim, true),\n        triangles = [];\n\n    if (!outerNode) return triangles;\n\n    var minX, minY, maxX, maxY, x, y, size;\n\n    if (hasHoles) outerNode = eliminateHoles(data, holeIndices, outerNode, dim);\n\n    // if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox\n    if (data.length > 80 * dim) {\n        minX = maxX = data[0];\n        minY = maxY = data[1];\n\n        for (var i = dim; i < outerLen; i += dim) {\n            x = data[i];\n            y = data[i + 1];\n            if (x < minX) minX = x;\n            if (y < minY) minY = y;\n            if (x > maxX) maxX = x;\n            if (y > maxY) maxY = y;\n        }\n\n        // minX, minY and size are later used to transform coords into integers for z-order calculation\n        size = Math.max(maxX - minX, maxY - minY);\n    }\n\n    earcutLinked(outerNode, triangles, dim, minX, minY, size);\n\n    return triangles;\n}\n\n// create a circular doubly linked list from polygon points in the specified winding order\nfunction linkedList(data, start, end, dim, clockwise) {\n    var i, last;\n\n    if (clockwise === (signedArea(data, start, end, dim) > 0)) {\n        for (i = start; i < end; i += dim) last = insertNode(i, data[i], data[i + 1], last);\n    } else {\n        for (i = end - dim; i >= start; i -= dim) last = insertNode(i, data[i], data[i + 1], last);\n    }\n\n    if (last && equals(last, last.next)) {\n        removeNode(last);\n        last = last.next;\n    }\n\n    return last;\n}\n\n// eliminate colinear or duplicate points\nfunction filterPoints(start, end) {\n    if (!start) return start;\n    if (!end) end = start;\n\n    var p = start,\n        again;\n    do {\n        again = false;\n\n        if (!p.steiner && (equals(p, p.next) || area(p.prev, p, p.next) === 0)) {\n            removeNode(p);\n            p = end = p.prev;\n            if (p === p.next) return null;\n            again = true;\n\n        } else {\n            p = p.next;\n        }\n    } while (again || p !== end);\n\n    return end;\n}\n\n// main ear slicing loop which triangulates a polygon (given as a linked list)\nfunction earcutLinked(ear, triangles, dim, minX, minY, size, pass) {\n    if (!ear) return;\n\n    // interlink polygon nodes in z-order\n    if (!pass && size) indexCurve(ear, minX, minY, size);\n\n    var stop = ear,\n        prev, next;\n\n    // iterate through ears, slicing them one by one\n    while (ear.prev !== ear.next) {\n        prev = ear.prev;\n        next = ear.next;\n\n        if (size ? isEarHashed(ear, minX, minY, size) : isEar(ear)) {\n            // cut off the triangle\n            triangles.push(prev.i / dim);\n            triangles.push(ear.i / dim);\n            triangles.push(next.i / dim);\n\n            removeNode(ear);\n\n            // skipping the next vertice leads to less sliver triangles\n            ear = next.next;\n            stop = next.next;\n\n            continue;\n        }\n\n        ear = next;\n\n        // if we looped through the whole remaining polygon and can't find any more ears\n        if (ear === stop) {\n            // try filtering points and slicing again\n            if (!pass) {\n                earcutLinked(filterPoints(ear), triangles, dim, minX, minY, size, 1);\n\n            // if this didn't work, try curing all small self-intersections locally\n            } else if (pass === 1) {\n                ear = cureLocalIntersections(ear, triangles, dim);\n                earcutLinked(ear, triangles, dim, minX, minY, size, 2);\n\n            // as a last resort, try splitting the remaining polygon into two\n            } else if (pass === 2) {\n                splitEarcut(ear, triangles, dim, minX, minY, size);\n            }\n\n            break;\n        }\n    }\n}\n\n// check whether a polygon node forms a valid ear with adjacent nodes\nfunction isEar(ear) {\n    var a = ear.prev,\n        b = ear,\n        c = ear.next;\n\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\n\n    // now make sure we don't have other points inside the potential ear\n    var p = ear.next.next;\n\n    while (p !== ear.prev) {\n        if (pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0) return false;\n        p = p.next;\n    }\n\n    return true;\n}\n\nfunction isEarHashed(ear, minX, minY, size) {\n    var a = ear.prev,\n        b = ear,\n        c = ear.next;\n\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\n\n    // triangle bbox; min & max are calculated like this for speed\n    var minTX = a.x < b.x ? (a.x < c.x ? a.x : c.x) : (b.x < c.x ? b.x : c.x),\n        minTY = a.y < b.y ? (a.y < c.y ? a.y : c.y) : (b.y < c.y ? b.y : c.y),\n        maxTX = a.x > b.x ? (a.x > c.x ? a.x : c.x) : (b.x > c.x ? b.x : c.x),\n        maxTY = a.y > b.y ? (a.y > c.y ? a.y : c.y) : (b.y > c.y ? b.y : c.y);\n\n    // z-order range for the current triangle bbox;\n    var minZ = zOrder(minTX, minTY, minX, minY, size),\n        maxZ = zOrder(maxTX, maxTY, minX, minY, size);\n\n    // first look for points inside the triangle in increasing z-order\n    var p = ear.nextZ;\n\n    while (p && p.z <= maxZ) {\n        if (p !== ear.prev && p !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0) return false;\n        p = p.nextZ;\n    }\n\n    // then look for points in decreasing z-order\n    p = ear.prevZ;\n\n    while (p && p.z >= minZ) {\n        if (p !== ear.prev && p !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0) return false;\n        p = p.prevZ;\n    }\n\n    return true;\n}\n\n// go through all polygon nodes and cure small local self-intersections\nfunction cureLocalIntersections(start, triangles, dim) {\n    var p = start;\n    do {\n        var a = p.prev,\n            b = p.next.next;\n\n        if (!equals(a, b) && intersects(a, p, p.next, b) && locallyInside(a, b) && locallyInside(b, a)) {\n\n            triangles.push(a.i / dim);\n            triangles.push(p.i / dim);\n            triangles.push(b.i / dim);\n\n            // remove two nodes involved\n            removeNode(p);\n            removeNode(p.next);\n\n            p = start = b;\n        }\n        p = p.next;\n    } while (p !== start);\n\n    return p;\n}\n\n// try splitting polygon into two and triangulate them independently\nfunction splitEarcut(start, triangles, dim, minX, minY, size) {\n    // look for a valid diagonal that divides the polygon into two\n    var a = start;\n    do {\n        var b = a.next.next;\n        while (b !== a.prev) {\n            if (a.i !== b.i && isValidDiagonal(a, b)) {\n                // split the polygon in two by the diagonal\n                var c = splitPolygon(a, b);\n\n                // filter colinear points around the cuts\n                a = filterPoints(a, a.next);\n                c = filterPoints(c, c.next);\n\n                // run earcut on each half\n                earcutLinked(a, triangles, dim, minX, minY, size);\n                earcutLinked(c, triangles, dim, minX, minY, size);\n                return;\n            }\n            b = b.next;\n        }\n        a = a.next;\n    } while (a !== start);\n}\n\n// link every hole into the outer loop, producing a single-ring polygon without holes\nfunction eliminateHoles(data, holeIndices, outerNode, dim) {\n    var queue = [],\n        i, len, start, end, list;\n\n    for (i = 0, len = holeIndices.length; i < len; i++) {\n        start = holeIndices[i] * dim;\n        end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\n        list = linkedList(data, start, end, dim, false);\n        if (list === list.next) list.steiner = true;\n        queue.push(getLeftmost(list));\n    }\n\n    queue.sort(compareX);\n\n    // process holes from left to right\n    for (i = 0; i < queue.length; i++) {\n        eliminateHole(queue[i], outerNode);\n        outerNode = filterPoints(outerNode, outerNode.next);\n    }\n\n    return outerNode;\n}\n\nfunction compareX(a, b) {\n    return a.x - b.x;\n}\n\n// find a bridge between vertices that connects hole with an outer ring and and link it\nfunction eliminateHole(hole, outerNode) {\n    outerNode = findHoleBridge(hole, outerNode);\n    if (outerNode) {\n        var b = splitPolygon(outerNode, hole);\n        filterPoints(b, b.next);\n    }\n}\n\n// David Eberly's algorithm for finding a bridge between hole and outer polygon\nfunction findHoleBridge(hole, outerNode) {\n    var p = outerNode,\n        hx = hole.x,\n        hy = hole.y,\n        qx = -Infinity,\n        m;\n\n    // find a segment intersected by a ray from the hole's leftmost point to the left;\n    // segment's endpoint with lesser x will be potential connection point\n    do {\n        if (hy <= p.y && hy >= p.next.y) {\n            var x = p.x + (hy - p.y) * (p.next.x - p.x) / (p.next.y - p.y);\n            if (x <= hx && x > qx) {\n                qx = x;\n                if (x === hx) {\n                    if (hy === p.y) return p;\n                    if (hy === p.next.y) return p.next;\n                }\n                m = p.x < p.next.x ? p : p.next;\n            }\n        }\n        p = p.next;\n    } while (p !== outerNode);\n\n    if (!m) return null;\n\n    if (hx === qx) return m.prev; // hole touches outer segment; pick lower endpoint\n\n    // look for points inside the triangle of hole point, segment intersection and endpoint;\n    // if there are no points found, we have a valid connection;\n    // otherwise choose the point of the minimum angle with the ray as connection point\n\n    var stop = m,\n        mx = m.x,\n        my = m.y,\n        tanMin = Infinity,\n        tan;\n\n    p = m.next;\n\n    while (p !== stop) {\n        if (hx >= p.x && p.x >= mx &&\n                pointInTriangle(hy < my ? hx : qx, hy, mx, my, hy < my ? qx : hx, hy, p.x, p.y)) {\n\n            tan = Math.abs(hy - p.y) / (hx - p.x); // tangential\n\n            if ((tan < tanMin || (tan === tanMin && p.x > m.x)) && locallyInside(p, hole)) {\n                m = p;\n                tanMin = tan;\n            }\n        }\n\n        p = p.next;\n    }\n\n    return m;\n}\n\n// interlink polygon nodes in z-order\nfunction indexCurve(start, minX, minY, size) {\n    var p = start;\n    do {\n        if (p.z === null) p.z = zOrder(p.x, p.y, minX, minY, size);\n        p.prevZ = p.prev;\n        p.nextZ = p.next;\n        p = p.next;\n    } while (p !== start);\n\n    p.prevZ.nextZ = null;\n    p.prevZ = null;\n\n    sortLinked(p);\n}\n\n// Simon Tatham's linked list merge sort algorithm\n// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html\nfunction sortLinked(list) {\n    var i, p, q, e, tail, numMerges, pSize, qSize,\n        inSize = 1;\n\n    do {\n        p = list;\n        list = null;\n        tail = null;\n        numMerges = 0;\n\n        while (p) {\n            numMerges++;\n            q = p;\n            pSize = 0;\n            for (i = 0; i < inSize; i++) {\n                pSize++;\n                q = q.nextZ;\n                if (!q) break;\n            }\n\n            qSize = inSize;\n\n            while (pSize > 0 || (qSize > 0 && q)) {\n\n                if (pSize === 0) {\n                    e = q;\n                    q = q.nextZ;\n                    qSize--;\n                } else if (qSize === 0 || !q) {\n                    e = p;\n                    p = p.nextZ;\n                    pSize--;\n                } else if (p.z <= q.z) {\n                    e = p;\n                    p = p.nextZ;\n                    pSize--;\n                } else {\n                    e = q;\n                    q = q.nextZ;\n                    qSize--;\n                }\n\n                if (tail) tail.nextZ = e;\n                else list = e;\n\n                e.prevZ = tail;\n                tail = e;\n            }\n\n            p = q;\n        }\n\n        tail.nextZ = null;\n        inSize *= 2;\n\n    } while (numMerges > 1);\n\n    return list;\n}\n\n// z-order of a point given coords and size of the data bounding box\nfunction zOrder(x, y, minX, minY, size) {\n    // coords are transformed into non-negative 15-bit integer range\n    x = 32767 * (x - minX) / size;\n    y = 32767 * (y - minY) / size;\n\n    x = (x | (x << 8)) & 0x00FF00FF;\n    x = (x | (x << 4)) & 0x0F0F0F0F;\n    x = (x | (x << 2)) & 0x33333333;\n    x = (x | (x << 1)) & 0x55555555;\n\n    y = (y | (y << 8)) & 0x00FF00FF;\n    y = (y | (y << 4)) & 0x0F0F0F0F;\n    y = (y | (y << 2)) & 0x33333333;\n    y = (y | (y << 1)) & 0x55555555;\n\n    return x | (y << 1);\n}\n\n// find the leftmost node of a polygon ring\nfunction getLeftmost(start) {\n    var p = start,\n        leftmost = start;\n    do {\n        if (p.x < leftmost.x) leftmost = p;\n        p = p.next;\n    } while (p !== start);\n\n    return leftmost;\n}\n\n// check if a point lies within a convex triangle\nfunction pointInTriangle(ax, ay, bx, by, cx, cy, px, py) {\n    return (cx - px) * (ay - py) - (ax - px) * (cy - py) >= 0 &&\n           (ax - px) * (by - py) - (bx - px) * (ay - py) >= 0 &&\n           (bx - px) * (cy - py) - (cx - px) * (by - py) >= 0;\n}\n\n// check if a diagonal between two polygon nodes is valid (lies in polygon interior)\nfunction isValidDiagonal(a, b) {\n    return a.next.i !== b.i && a.prev.i !== b.i && !intersectsPolygon(a, b) &&\n           locallyInside(a, b) && locallyInside(b, a) && middleInside(a, b);\n}\n\n// signed area of a triangle\nfunction area(p, q, r) {\n    return (q.y - p.y) * (r.x - q.x) - (q.x - p.x) * (r.y - q.y);\n}\n\n// check if two points are equal\nfunction equals(p1, p2) {\n    return p1.x === p2.x && p1.y === p2.y;\n}\n\n// check if two segments intersect\nfunction intersects(p1, q1, p2, q2) {\n    if ((equals(p1, q1) && equals(p2, q2)) ||\n        (equals(p1, q2) && equals(p2, q1))) return true;\n    return area(p1, q1, p2) > 0 !== area(p1, q1, q2) > 0 &&\n           area(p2, q2, p1) > 0 !== area(p2, q2, q1) > 0;\n}\n\n// check if a polygon diagonal intersects any polygon segments\nfunction intersectsPolygon(a, b) {\n    var p = a;\n    do {\n        if (p.i !== a.i && p.next.i !== a.i && p.i !== b.i && p.next.i !== b.i &&\n                intersects(p, p.next, a, b)) return true;\n        p = p.next;\n    } while (p !== a);\n\n    return false;\n}\n\n// check if a polygon diagonal is locally inside the polygon\nfunction locallyInside(a, b) {\n    return area(a.prev, a, a.next) < 0 ?\n        area(a, b, a.next) >= 0 && area(a, a.prev, b) >= 0 :\n        area(a, b, a.prev) < 0 || area(a, a.next, b) < 0;\n}\n\n// check if the middle point of a polygon diagonal is inside the polygon\nfunction middleInside(a, b) {\n    var p = a,\n        inside = false,\n        px = (a.x + b.x) / 2,\n        py = (a.y + b.y) / 2;\n    do {\n        if (((p.y > py) !== (p.next.y > py)) && (px < (p.next.x - p.x) * (py - p.y) / (p.next.y - p.y) + p.x))\n            inside = !inside;\n        p = p.next;\n    } while (p !== a);\n\n    return inside;\n}\n\n// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;\n// if one belongs to the outer ring and another to a hole, it merges it into a single ring\nfunction splitPolygon(a, b) {\n    var a2 = new Node(a.i, a.x, a.y),\n        b2 = new Node(b.i, b.x, b.y),\n        an = a.next,\n        bp = b.prev;\n\n    a.next = b;\n    b.prev = a;\n\n    a2.next = an;\n    an.prev = a2;\n\n    b2.next = a2;\n    a2.prev = b2;\n\n    bp.next = b2;\n    b2.prev = bp;\n\n    return b2;\n}\n\n// create a node and optionally link it with previous one (in a circular doubly linked list)\nfunction insertNode(i, x, y, last) {\n    var p = new Node(i, x, y);\n\n    if (!last) {\n        p.prev = p;\n        p.next = p;\n\n    } else {\n        p.next = last.next;\n        p.prev = last;\n        last.next.prev = p;\n        last.next = p;\n    }\n    return p;\n}\n\nfunction removeNode(p) {\n    p.next.prev = p.prev;\n    p.prev.next = p.next;\n\n    if (p.prevZ) p.prevZ.nextZ = p.nextZ;\n    if (p.nextZ) p.nextZ.prevZ = p.prevZ;\n}\n\nfunction Node(i, x, y) {\n    // vertice index in coordinates array\n    this.i = i;\n\n    // vertex coordinates\n    this.x = x;\n    this.y = y;\n\n    // previous and next vertice nodes in a polygon ring\n    this.prev = null;\n    this.next = null;\n\n    // z-order curve value\n    this.z = null;\n\n    // previous and next nodes in z-order\n    this.prevZ = null;\n    this.nextZ = null;\n\n    // indicates whether this is a steiner point\n    this.steiner = false;\n}\n\n// return a percentage difference between the polygon area and its triangulation area;\n// used to verify correctness of triangulation\nearcut.deviation = function (data, holeIndices, dim, triangles) {\n    var hasHoles = holeIndices && holeIndices.length;\n    var outerLen = hasHoles ? holeIndices[0] * dim : data.length;\n\n    var polygonArea = Math.abs(signedArea(data, 0, outerLen, dim));\n    if (hasHoles) {\n        for (var i = 0, len = holeIndices.length; i < len; i++) {\n            var start = holeIndices[i] * dim;\n            var end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\n            polygonArea -= Math.abs(signedArea(data, start, end, dim));\n        }\n    }\n\n    var trianglesArea = 0;\n    for (i = 0; i < triangles.length; i += 3) {\n        var a = triangles[i] * dim;\n        var b = triangles[i + 1] * dim;\n        var c = triangles[i + 2] * dim;\n        trianglesArea += Math.abs(\n            (data[a] - data[c]) * (data[b + 1] - data[a + 1]) -\n            (data[a] - data[b]) * (data[c + 1] - data[a + 1]));\n    }\n\n    return polygonArea === 0 && trianglesArea === 0 ? 0 :\n        Math.abs((trianglesArea - polygonArea) / polygonArea);\n};\n\nfunction signedArea(data, start, end, dim) {\n    var sum = 0;\n    for (var i = start, j = end - dim; i < end; i += dim) {\n        sum += (data[j] - data[i]) * (data[i + 1] + data[j + 1]);\n        j = i;\n    }\n    return sum;\n}\n\n// turn a polygon in a multi-dimensional array form (e.g. as in GeoJSON) into a form Earcut accepts\nearcut.flatten = function (data) {\n    var dim = data[0][0].length,\n        result = {vertices: [], holes: [], dimensions: dim},\n        holeIndex = 0;\n\n    for (var i = 0; i < data.length; i++) {\n        for (var j = 0; j < data[i].length; j++) {\n            for (var d = 0; d < dim; d++) result.vertices.push(data[i][j][d]);\n        }\n        if (i > 0) {\n            holeIndex += data[i - 1].length;\n            result.holes.push(holeIndex);\n        }\n    }\n    return result;\n};\n\n},{}]},{},[1]);\n"]}