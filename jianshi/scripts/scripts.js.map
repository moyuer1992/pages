{"version":3,"sources":["scripts.js"],"names":["_argumentsToArray","args","concat","apply","Array","prototype","slice","radians","degrees","Math","PI","vec2","result","arguments","length","push","splice","vec3","vec4","mat2","v","m","matrix","mat3","mat4","equal","u","i","j","add","subtract","mult","sum","k","translate","x","y","z","isArray","rotate","angle","axis","normalize","c","cos","omc","s","sin","rotateX","theta","rx","rotateY","ry","rotateZ","rz","scalem","lookAt","eye","at","up","n","cross","negate","dot","ortho","left","right","bottom","top","near","far","w","h","d","perspective","fovy","aspect","f","tan","transpose","sqrt","excludeLastComponent","last","pop","len","isFinite","mix","scale","flatten","elemsAreArrays","floats","Float32Array","idx","sizeof","byteLength","printm","console","log","det2","det3","det4","m0","m1","m2","m3","det","inverse2","a","inverse3","a00","a01","a02","a10","a11","a12","a20","a21","a22","inverse4","a03","a13","a23","a30","a31","a32","a33","inverse","normalMatrix","flag","b","$","fn","classes","callback","each","splitClassName","className","split","indexOf","jQuery","initGlProgram","gl","shaders","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","window","error","getProgramInfoLog","initGlShader","shaderScript","shaderType","shader","createShader","shaderSource","compileShader","BgSprite","editor","map","style","animating","options","timeGap","duration","entryLength","width","canvasNode","height","ctx","bgCtx","bgGl","init","t","stop","TextSprite","textStyle","animationStyle","_t","clearArea","canvas","Object","keys","forEach","key","startTime","Date","now","animationMap","label","value","useScissor","clearRect","util","hexToRgb","hex","exec","r","parseInt","g","rgbToHex","componentToHex","toString","getSpriteEntity","entities","Klass","eval","getInitialState","name","config","state","fontMap","fontSizeMap","fontColorMap","textStyleMap","textAlignMap","backgroundMap","colors","fontIndex","fontSizeIndex","fontColorIndex","textStyleIndex","textAlignIndex","backgroundIndex","animationIndex","bgColorIndex","textCtx","document","createElement","getContext","calTriangleArea","A","B","C","distance","p","p1","p2","makeTextData","text","size","pointsArray","normalsArray","colorsArray","compIdxArray","e","markMap","cnt","font","fillStyle","strokeStyle","lineWidth","textAlign","textBaseline","fillText","imageData","getImageData","data","grid","triangle","index","normal","colorStyle","area","color","pow","hasPixel","markPoint","isEdge","finalGraph","seperateGraph","graphs","sampledEdge","graphMap","thick","z2","graph","points","holes","triangles","earcut","num","holesMap","holeIndex","startAt","endAt","graphsEdge","markArr","fathers","markCollection","findFather","f1","f2","shape","orderEdge","findOuterContourEntry","start","findInnerContourEntry","isInContours","gap","rs","entryRecord","next","end","mark","holeMark","process","tmp","convertEntry","arr","entryIndex","hasNext","innerEntry","convertCanvasToGl","convertCanvasToGl2D","parseArr","normals","hslToRgb","l","hue2rgb","q","round","rgbToHsl","max","min","GlTextSprite","glcanvasNode","dataMap","initGl","_finish","char","getTextData","removeClass","parseData","clear","renderGlText","pos","fontSize","lineHeight","fontColor","animation","finish","period","floor","drawStatic","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","colorArray","radius","phi","dr","ytop","lightPosition","lightAmbient","lightDiffuse","lightSpecular","materialAmbient","materialDiffuse","materialSpecular","materialShininess","ambientColor","diffuseColor","specularColor","modelViewMatrix","projectionMatrix","modelViewMatrixLoc","projectionMatrixLoc","normalMatrixLoc","useProgram","enable","DEPTH_TEST","viewport","ambientProduct","diffuseProduct","specularProduct","nBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","vNormal","getAttribLocation","vertexAttribPointer","FLOAT","enableVertexAttribArray","vBuffer","vPosition","iBuffer","compIdx","getUniformLocation","uniform4fv","uniform1f","uniform1i","uniform3fv","uniformMatrix4fv","uniformMatrix3fv","drawArrays","TRIANGLES","SCISSOR_TEST","scissor","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","disable","PureBgSprite","fillRect","TreeBgSprite","renderGlMoon","numTimesToSubdivide","renderGlTree","minH","iniH","dt","progress","vertexMoonShader","fragmentMoonShader","moonProgram","vertexTreeShader","fragmentTreeShader","treeProgram","branch","root","abs","LINES","divideTriangle","count","ab","ac","bc","tetrahedron","va","vb","vc","vd","Data","_content","_lines","addContent","_text","charAt","join","Editor","paddingLeft","paddingRight","paddingTop","paddingBottom","bottomBarHeight","onFocus","isToolBarShown","toolBarWidth","operations","createStyle","initData","selection","Selection","createElements","bindEvents","createMap","initSprites","windowWidth","windowHeight","$editor","editorNode","css","updateRelativeLocation","renderText","Style","get","hiddenCanvas","hiddenCtx","$bgCanvas","$bgGlcanvas","bgGlcanvasNode","bgCanvasNode","preserveDrawingBuffer","$canvas","$glcanvas","$input","inputNode","append","$cursor","cursorNode","rowIndex","colIndex","hideCursor","getSelEndPosition","cursorX","cursorY","on","onInputChange","bind","onInputFocus","onInputBlur","onKeyDown","onCompStart","onCompEnd","onInputChar","onTouchStart","onTouchEnd","onMouseDown","onMouseUp","onGlobalClick","resize","onScroll","col","row","startRow","endRow","charLength","keyCode","deleteText","getSelLength","clearInputNodeValue","update","updateCursor","action","getLength","deleteContent","padding","x2","y2","_convertWindowPosToCanvas","clientX","clientY","blur","inputStatus","that","setTimeout","input","touch","click","insertText","preventDefault","focus","touches","changedTouches","findPosfromMap","str","chars","code","charCodeAt","bgSprite","xCursor","yCursor","lines","getLines","lineMap","charGap","space","updateMap","textSprite","_fillText","addClass","animationInfo","textStop","bgStop","requestAnimationFrame","tick","advance","stopPlay","drawFrame","bottomBar","$dom","find","drawImage","imgData","toDataURL","startColIndex","endColIndex","startRowIndex","endRowIndex","_convertIndexByMap","_convertMapByIndex","initDefaultStyle","changeTextStyle","changeBgStyle","getAnimationMap","lineHeightRatio","changeStyle","textWeight","background","selectModal","show","hasClass","play","toolBar","isShown","hide","resultModal","attr","toLowerCase","export","option","generateJpeg","generatePng","generateGif","then","onChange","re","test","RegExp","$1","updateBgColor","parent","$el","changeBgColor","hideToolBar","showToolBar","nextIndex","call","clearCanvas","textStyleChange","backgroundChange","o","require","Error","exports","module","holeIndices","dim","hasHoles","outerLen","outerNode","linkedList","minX","minY","maxX","maxY","eliminateHoles","earcutLinked","clockwise","signedArea","insertNode","equals","removeNode","filterPoints","again","steiner","prev","ear","pass","indexCurve","isEarHashed","isEar","cureLocalIntersections","splitEarcut","pointInTriangle","minTX","minTY","maxTX","maxTY","minZ","zOrder","maxZ","nextZ","prevZ","intersects","locallyInside","isValidDiagonal","splitPolygon","queue","list","getLeftmost","sort","compareX","eliminateHole","hole","findHoleBridge","hx","hy","qx","Infinity","mx","my","tanMin","sortLinked","tail","numMerges","pSize","qSize","inSize","leftmost","ax","ay","bx","by","cx","cy","px","py","intersectsPolygon","middleInside","q1","q2","inside","a2","Node","b2","an","bp","deviation","polygonArea","trianglesArea","vertices","dimensions"],"mappings":"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","file":"scripts.js","sourcesContent":["//////////////////////////////////////////////////////////////////////////////\r\n//\r\n//  Angel.js\r\n//\r\n//////////////////////////////////////////////////////////////////////////////\r\n\r\n//----------------------------------------------------------------------------\r\n//\r\n//  Helper functions\r\n//\r\n\r\nfunction _argumentsToArray( args )\r\n{\r\n    return [].concat.apply( [], Array.prototype.slice.apply(args) );\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction radians( degrees ) {\r\n    return degrees * Math.PI / 180.0;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n//\r\n//  Vector Constructors\r\n//\r\n\r\nfunction vec2()\r\n{\r\n    var result = _argumentsToArray( arguments );\r\n\r\n    switch ( result.length ) {\r\n    case 0: result.push( 0.0 );\r\n    case 1: result.push( 0.0 );\r\n    }\r\n\r\n    return result.splice( 0, 2 );\r\n}\r\n\r\nfunction vec3()\r\n{\r\n    var result = _argumentsToArray( arguments );\r\n\r\n    switch ( result.length ) {\r\n    case 0: result.push( 0.0 );\r\n    case 1: result.push( 0.0 );\r\n    case 2: result.push( 0.0 );\r\n    }\r\n\r\n    return result.splice( 0, 3 );\r\n}\r\n\r\nfunction vec4()\r\n{\r\n    var result = _argumentsToArray( arguments );\r\n\r\n    switch ( result.length ) {\r\n    case 0: result.push( 0.0 );\r\n    case 1: result.push( 0.0 );\r\n    case 2: result.push( 0.0 );\r\n    case 3: result.push( 1.0 );\r\n    }\r\n\r\n    return result.splice( 0, 4 );\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n//\r\n//  Matrix Constructors\r\n//\r\n\r\nfunction mat2()\r\n{\r\n    var v = _argumentsToArray( arguments );\r\n\r\n    var m = [];\r\n    switch ( v.length ) {\r\n    case 0:\r\n        v[0] = 1;\r\n    case 1:\r\n        m = [\r\n            vec2( v[0],  0.0 ),\r\n            vec2(  0.0, v[0] )\r\n        ];\r\n        break;\r\n\r\n    default:\r\n        m.push( vec2(v) );  v.splice( 0, 2 );\r\n        m.push( vec2(v) );\r\n        break;\r\n    }\r\n\r\n    m.matrix = true;\r\n\r\n    return m;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction mat3()\r\n{\r\n    var v = _argumentsToArray( arguments );\r\n\r\n    var m = [];\r\n    switch ( v.length ) {\r\n    case 0:\r\n        v[0] = 1;\r\n    case 1:\r\n        m = [\r\n            vec3( v[0],  0.0,  0.0 ),\r\n            vec3(  0.0, v[0],  0.0 ),\r\n            vec3(  0.0,  0.0, v[0] )\r\n        ];\r\n        break;\r\n\r\n    default:\r\n        m.push( vec3(v) );  v.splice( 0, 3 );\r\n        m.push( vec3(v) );  v.splice( 0, 3 );\r\n        m.push( vec3(v) );\r\n        break;\r\n    }\r\n\r\n    m.matrix = true;\r\n\r\n    return m;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction mat4()\r\n{\r\n    var v = _argumentsToArray( arguments );\r\n\r\n    var m = [];\r\n    switch ( v.length ) {\r\n    case 0:\r\n        v[0] = 1;\r\n    case 1:\r\n        m = [\r\n            vec4( v[0], 0.0,  0.0,   0.0 ),\r\n            vec4( 0.0,  v[0], 0.0,   0.0 ),\r\n            vec4( 0.0,  0.0,  v[0],  0.0 ),\r\n            vec4( 0.0,  0.0,  0.0,  v[0] )\r\n        ];\r\n        break;\r\n\r\n    default:\r\n        m.push( vec4(v) );  v.splice( 0, 4 );\r\n        m.push( vec4(v) );  v.splice( 0, 4 );\r\n        m.push( vec4(v) );  v.splice( 0, 4 );\r\n        m.push( vec4(v) );\r\n        break;\r\n    }\r\n\r\n    m.matrix = true;\r\n\r\n    return m;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n//\r\n//  Generic Mathematical Operations for Vectors and Matrices\r\n//\r\n\r\nfunction equal( u, v )\r\n{\r\n    if ( u.length != v.length ) { return false; }\r\n\r\n    if ( u.matrix && v.matrix ) {\r\n        for ( var i = 0; i < u.length; ++i ) {\r\n            if ( u[i].length != v[i].length ) { return false; }\r\n            for ( var j = 0; j < u[i].length; ++j ) {\r\n                if ( u[i][j] !== v[i][j] ) { return false; }\r\n            }\r\n        }\r\n    }\r\n    else if ( u.matrix && !v.matrix || !u.matrix && v.matrix ) {\r\n        return false;\r\n    }\r\n    else {\r\n        for ( var i = 0; i < u.length; ++i ) {\r\n            if ( u[i] !== v[i] ) { return false; }\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction add( u, v )\r\n{\r\n    var result = [];\r\n\r\n    if ( u.matrix && v.matrix ) {\r\n        if ( u.length != v.length ) {\r\n            throw \"add(): trying to add matrices of different dimensions\";\r\n        }\r\n\r\n        for ( var i = 0; i < u.length; ++i ) {\r\n            if ( u[i].length != v[i].length ) {\r\n                throw \"add(): trying to add matrices of different dimensions\";\r\n            }\r\n            result.push( [] );\r\n            for ( var j = 0; j < u[i].length; ++j ) {\r\n                result[i].push( u[i][j] + v[i][j] );\r\n            }\r\n        }\r\n\r\n        result.matrix = true;\r\n\r\n        return result;\r\n    }\r\n    else if ( u.matrix && !v.matrix || !u.matrix && v.matrix ) {\r\n        throw \"add(): trying to add matrix and non-matrix variables\";\r\n    }\r\n    else {\r\n        if ( u.length != v.length ) {\r\n            throw \"add(): vectors are not the same dimension\";\r\n        }\r\n\r\n        for ( var i = 0; i < u.length; ++i ) {\r\n            result.push( u[i] + v[i] );\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction subtract( u, v )\r\n{\r\n    var result = [];\r\n\r\n    if ( u.matrix && v.matrix ) {\r\n        if ( u.length != v.length ) {\r\n            throw \"subtract(): trying to subtract matrices\" +\r\n                \" of different dimensions\";\r\n        }\r\n\r\n        for ( var i = 0; i < u.length; ++i ) {\r\n            if ( u[i].length != v[i].length ) {\r\n                throw \"subtract(): trying to subtact matrices\" +\r\n                    \" of different dimensions\";\r\n            }\r\n            result.push( [] );\r\n            for ( var j = 0; j < u[i].length; ++j ) {\r\n                result[i].push( u[i][j] - v[i][j] );\r\n            }\r\n        }\r\n\r\n        result.matrix = true;\r\n\r\n        return result;\r\n    }\r\n    else if ( u.matrix && !v.matrix || !u.matrix && v.matrix ) {\r\n        throw \"subtact(): trying to subtact  matrix and non-matrix variables\";\r\n    }\r\n    else {\r\n        if ( u.length != v.length ) {\r\n            throw \"subtract(): vectors are not the same length\";\r\n        }\r\n\r\n        for ( var i = 0; i < u.length; ++i ) {\r\n            result.push( u[i] - v[i] );\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction mult( u, v )\r\n{\r\n    var result = [];\r\n\r\n    if ( u.matrix && v.matrix ) {\r\n        if ( u.length != v.length ) {\r\n            throw \"mult(): trying to add matrices of different dimensions\";\r\n        }\r\n\r\n        for ( var i = 0; i < u.length; ++i ) {\r\n            if ( u[i].length != v[i].length ) {\r\n                throw \"mult(): trying to add matrices of different dimensions\";\r\n            }\r\n        }\r\n\r\n        for ( var i = 0; i < u.length; ++i ) {\r\n            result.push( [] );\r\n\r\n            for ( var j = 0; j < v.length; ++j ) {\r\n                var sum = 0.0;\r\n                for ( var k = 0; k < u.length; ++k ) {\r\n                    sum += u[i][k] * v[k][j];\r\n                }\r\n                result[i].push( sum );\r\n            }\r\n        }\r\n\r\n        result.matrix = true;\r\n\r\n        return result;\r\n    }\r\n\r\n      if(u.matrix&& (u.length == v.length)) {\r\n        for(var i = 0; i<v.length; i++) {\r\n          var sum = 0.0;\r\n          for(var j=0; j<v.length; j++) {\r\n            sum += u[i][j]*v[j];\r\n          }\r\n          result.push(sum);\r\n        }\r\n      return result;\r\n      }\r\n\r\n\r\n\r\n    else {\r\n        if ( u.length != v.length ) {\r\n            throw \"mult(): vectors are not the same dimension\";\r\n        }\r\n\r\n        for ( var i = 0; i < u.length; ++i ) {\r\n            result.push( u[i] * v[i] );\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n//\r\n//  Basic Transformation Matrix Generators\r\n//\r\n\r\nfunction translate( x, y, z )\r\n{\r\n    if ( Array.isArray(x) && x.length == 3 ) {\r\n        z = x[2];\r\n        y = x[1];\r\n        x = x[0];\r\n    }\r\n\r\n    var result = mat4();\r\n    result[0][3] = x;\r\n    result[1][3] = y;\r\n    result[2][3] = z;\r\n\r\n    return result;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction rotate( angle, axis )\r\n{\r\n    if ( !Array.isArray(axis) ) {\r\n        axis = [ arguments[1], arguments[2], arguments[3] ];\r\n    }\r\n\r\n    var v = normalize( axis );\r\n\r\n    var x = v[0];\r\n    var y = v[1];\r\n    var z = v[2];\r\n\r\n    var c = Math.cos( radians(angle) );\r\n    var omc = 1.0 - c;\r\n    var s = Math.sin( radians(angle) );\r\n\r\n    var result = mat4(\r\n        vec4( x*x*omc + c,   x*y*omc - z*s, x*z*omc + y*s, 0.0 ),\r\n        vec4( x*y*omc + z*s, y*y*omc + c,   y*z*omc - x*s, 0.0 ),\r\n        vec4( x*z*omc - y*s, y*z*omc + x*s, z*z*omc + c,   0.0 ),\r\n        vec4()\r\n    );\r\n\r\n    return result;\r\n}\r\n\r\nfunction rotateX(theta) {\r\n  var c = Math.cos( radians(theta) );\r\n  var s = Math.sin( radians(theta) );\r\n  var rx = mat4( 1.0,  0.0,  0.0, 0.0,\r\n      0.0,  c,  s, 0.0,\r\n      0.0, -s,  c, 0.0,\r\n      0.0,  0.0,  0.0, 1.0 );\r\n  return rx;\r\n}\r\nfunction rotateY(theta) {\r\n  var c = Math.cos( radians(theta) );\r\n  var s = Math.sin( radians(theta) );\r\n  var ry = mat4( c, 0.0, -s, 0.0,\r\n      0.0, 1.0,  0.0, 0.0,\r\n      s, 0.0,  c, 0.0,\r\n      0.0, 0.0,  0.0, 1.0 );\r\n  return ry;\r\n}\r\nfunction rotateZ(theta) {\r\n  var c = Math.cos( radians(theta) );\r\n  var s = Math.sin( radians(theta) );\r\n  var rz = mat4( c, s, 0.0, 0.0,\r\n      -s,  c, 0.0, 0.0,\r\n      0.0,  0.0, 1.0, 0.0,\r\n      0.0,  0.0, 0.0, 1.0 );\r\n  return rz;\r\n}\r\n\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction scalem( x, y, z )\r\n{\r\n    if ( Array.isArray(x) && x.length == 3 ) {\r\n        z = x[2];\r\n        y = x[1];\r\n        x = x[0];\r\n    }\r\n\r\n    var result = mat4();\r\n    result[0][0] = x;\r\n    result[1][1] = y;\r\n    result[2][2] = z;\r\n\r\n    return result;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n//\r\n//  ModelView Matrix Generators\r\n//\r\n\r\nfunction lookAt( eye, at, up )\r\n{\r\n    if ( !Array.isArray(eye) || eye.length != 3) {\r\n        throw \"lookAt(): first parameter [eye] must be an a vec3\";\r\n    }\r\n\r\n    if ( !Array.isArray(at) || at.length != 3) {\r\n        throw \"lookAt(): first parameter [at] must be an a vec3\";\r\n    }\r\n\r\n    if ( !Array.isArray(up) || up.length != 3) {\r\n        throw \"lookAt(): first parameter [up] must be an a vec3\";\r\n    }\r\n\r\n    if ( equal(eye, at) ) {\r\n        return mat4();\r\n    }\r\n\r\n    var v = normalize( subtract(at, eye) );  // view direction vector\r\n    var n = normalize( cross(v, up) );       // perpendicular vector\r\n    var u = normalize( cross(n, v) );        // \"new\" up vector\r\n\r\n    v = negate( v );\r\n\r\n    var result = mat4(\r\n        vec4( n, -dot(n, eye) ),\r\n        vec4( u, -dot(u, eye) ),\r\n        vec4( v, -dot(v, eye) ),\r\n        vec4()\r\n    );\r\n\r\n    return result;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n//\r\n//  Projection Matrix Generators\r\n//\r\n\r\nfunction ortho( left, right, bottom, top, near, far )\r\n{\r\n    if ( left == right ) { throw \"ortho(): left and right are equal\"; }\r\n    if ( bottom == top ) { throw \"ortho(): bottom and top are equal\"; }\r\n    if ( near == far )   { throw \"ortho(): near and far are equal\"; }\r\n\r\n    var w = right - left;\r\n    var h = top - bottom;\r\n    var d = far - near;\r\n\r\n    var result = mat4();\r\n    result[0][0] = 2.0 / w;\r\n    result[1][1] = 2.0 / h;\r\n    result[2][2] = -2.0 / d;\r\n    result[0][3] = -(left + right) / w;\r\n    result[1][3] = -(top + bottom) / h;\r\n    result[2][3] = -(near + far) / d;\r\n\r\n    return result;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction perspective( fovy, aspect, near, far )\r\n{\r\n    var f = 1.0 / Math.tan( radians(fovy) / 2 );\r\n    var d = far - near;\r\n\r\n    var result = mat4();\r\n    result[0][0] = f / aspect;\r\n    result[1][1] = f;\r\n    result[2][2] = -(near + far) / d;\r\n    result[2][3] = -2 * near * far / d;\r\n    result[3][2] = -1;\r\n    result[3][3] = 0.0;\r\n\r\n    return result;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n//\r\n//  Matrix Functions\r\n//\r\n\r\nfunction transpose( m )\r\n{\r\n    if ( !m.matrix ) {\r\n        return \"transpose(): trying to transpose a non-matrix\";\r\n    }\r\n\r\n    var result = [];\r\n    for ( var i = 0; i < m.length; ++i ) {\r\n        result.push( [] );\r\n        for ( var j = 0; j < m[i].length; ++j ) {\r\n            result[i].push( m[j][i] );\r\n        }\r\n    }\r\n\r\n    result.matrix = true;\r\n\r\n    return result;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n//\r\n//  Vector Functions\r\n//\r\n\r\nfunction dot( u, v )\r\n{\r\n    if ( u.length != v.length ) {\r\n        throw \"dot(): vectors are not the same dimension\";\r\n    }\r\n\r\n    var sum = 0.0;\r\n    for ( var i = 0; i < u.length; ++i ) {\r\n        sum += u[i] * v[i];\r\n    }\r\n\r\n    return sum;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction negate( u )\r\n{\r\n    var result = [];\r\n    for ( var i = 0; i < u.length; ++i ) {\r\n        result.push( -u[i] );\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction cross( u, v )\r\n{\r\n    if ( !Array.isArray(u) || u.length < 3 ) {\r\n        throw \"cross(): first argument is not a vector of at least 3\";\r\n    }\r\n\r\n    if ( !Array.isArray(v) || v.length < 3 ) {\r\n        throw \"cross(): second argument is not a vector of at least 3\";\r\n    }\r\n\r\n    var result = [\r\n        u[1]*v[2] - u[2]*v[1],\r\n        u[2]*v[0] - u[0]*v[2],\r\n        u[0]*v[1] - u[1]*v[0]\r\n    ];\r\n\r\n    return result;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction length( u )\r\n{\r\n    return Math.sqrt( dot(u, u) );\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction normalize( u, excludeLastComponent )\r\n{\r\n    if ( excludeLastComponent ) {\r\n        var last = u.pop();\r\n    }\r\n\r\n    var len = length( u );\r\n\r\n    if ( !isFinite(len) ) {\r\n        throw \"normalize: vector \" + u + \" has zero length\";\r\n    }\r\n\r\n    for ( var i = 0; i < u.length; ++i ) {\r\n        u[i] /= len;\r\n    }\r\n\r\n    if ( excludeLastComponent ) {\r\n        u.push( last );\r\n    }\r\n\r\n    return u;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nfunction mix( u, v, s )\r\n{\r\n    if ( typeof s !== \"number\" ) {\r\n        throw \"mix: the last paramter \" + s + \" must be a number\";\r\n    }\r\n\r\n    if ( u.length != v.length ) {\r\n        throw \"vector dimension mismatch\";\r\n    }\r\n\r\n    var result = [];\r\n    for ( var i = 0; i < u.length; ++i ) {\r\n        result.push( (1.0 - s) * u[i] + s * v[i] );\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n//\r\n// Vector and Matrix functions\r\n//\r\n\r\nfunction scale( s, u )\r\n{\r\n    if ( !Array.isArray(u) ) {\r\n        throw \"scale: second parameter \" + u + \" is not a vector\";\r\n    }\r\n\r\n    var result = [];\r\n    for ( var i = 0; i < u.length; ++i ) {\r\n        result.push( s * u[i] );\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n//\r\n//\r\n//\r\n\r\nfunction flatten( v )\r\n{\r\n    if ( v.matrix === true ) {\r\n        v = transpose( v );\r\n    }\r\n\r\n    var n = v.length;\r\n    var elemsAreArrays = false;\r\n\r\n    if ( Array.isArray(v[0]) ) {\r\n        elemsAreArrays = true;\r\n        n *= v[0].length;\r\n    }\r\n\r\n    var floats = new Float32Array( n );\r\n\r\n    if ( elemsAreArrays ) {\r\n        var idx = 0;\r\n        for ( var i = 0; i < v.length; ++i ) {\r\n            for ( var j = 0; j < v[i].length; ++j ) {\r\n                floats[idx++] = v[i][j];\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        for ( var i = 0; i < v.length; ++i ) {\r\n            floats[i] = v[i];\r\n        }\r\n    }\r\n\r\n    return floats;\r\n}\r\n\r\n//----------------------------------------------------------------------------\r\n\r\nvar sizeof = {\r\n    'vec2' : new Float32Array( flatten(vec2()) ).byteLength,\r\n    'vec3' : new Float32Array( flatten(vec3()) ).byteLength,\r\n    'vec4' : new Float32Array( flatten(vec4()) ).byteLength,\r\n    'mat2' : new Float32Array( flatten(mat2()) ).byteLength,\r\n    'mat3' : new Float32Array( flatten(mat3()) ).byteLength,\r\n    'mat4' : new Float32Array( flatten(mat4()) ).byteLength\r\n};\r\n\r\n// new functions 5/2/2015\r\n\r\n// printing\r\n\r\nfunction printm(m)\r\n{\r\n    if(m.length == 2)\r\n    for(var i=0; i<m.length; i++)\r\n       console.log(m[i][0], m[i][1]);\r\n    else if(m.length == 3)\r\n    for(var i=0; i<m.length; i++)\r\n       console.log(m[i][0], m[i][1], m[i][2]);\r\n    else if(m.length == 4)\r\n    for(var i=0; i<m.length; i++)\r\n       console.log(m[i][0], m[i][1], m[i][2], m[i][3]);\r\n}\r\n// determinants\r\n\r\nfunction det2(m)\r\n{\r\n\r\n     return m[0][0]*m[1][1]-m[0][1]*m[1][0];\r\n\r\n}\r\n\r\nfunction det3(m)\r\n{\r\n     var d = m[0][0]*m[1][1]*m[2][2]\r\n           + m[0][1]*m[1][2]*m[2][0]\r\n           + m[0][2]*m[2][1]*m[1][0]\r\n           - m[2][0]*m[1][1]*m[0][2]\r\n           - m[1][0]*m[0][1]*m[2][2]\r\n           - m[0][0]*m[1][2]*m[2][1]\r\n           ;\r\n     return d;\r\n}\r\n\r\nfunction det4(m)\r\n{\r\n     var m0 = [\r\n         vec3(m[1][1], m[1][2], m[1][3]),\r\n         vec3(m[2][1], m[2][2], m[2][3]),\r\n         vec3(m[3][1], m[3][2], m[3][3])\r\n     ];\r\n     var m1 = [\r\n         vec3(m[1][0], m[1][2], m[1][3]),\r\n         vec3(m[2][0], m[2][2], m[2][3]),\r\n         vec3(m[3][0], m[3][2], m[3][3])\r\n     ];\r\n     var m2 = [\r\n         vec3(m[1][0], m[1][1], m[1][3]),\r\n         vec3(m[2][0], m[2][1], m[2][3]),\r\n         vec3(m[3][0], m[3][1], m[3][3])\r\n     ];\r\n     var m3 = [\r\n         vec3(m[1][0], m[1][1], m[1][2]),\r\n         vec3(m[2][0], m[2][1], m[2][2]),\r\n         vec3(m[3][0], m[3][1], m[3][2])\r\n     ];\r\n     return m[0][0]*det3(m0) - m[0][1]*det3(m1)\r\n         + m[0][2]*det3(m2) - m[0][3]*det3(m3);\r\n\r\n}\r\n\r\nfunction det(m)\r\n{\r\n     if(m.matrix != true) console.log(\"not a matrix\");\r\n     if(m.length == 2) return det2(m);\r\n     if(m.length == 3) return det3(m);\r\n     if(m.length == 4) return det4(m);\r\n}\r\n\r\n//---------------------------------------------------------\r\n\r\n// inverses\r\n\r\nfunction inverse2(m)\r\n{\r\n     var a = mat2();\r\n     var d = det2(m);\r\n     a[0][0] = m[1][1]/d;\r\n     a[0][1] = -m[0][1]/d;\r\n     a[1][0] = -m[1][0]/d;\r\n     a[1][1] = m[0][0]/d;\r\n     a.matrix = true;\r\n     return a;\r\n}\r\n\r\nfunction inverse3(m)\r\n{\r\n    var a = mat3();\r\n    var d = det3(m);\r\n\r\n    var a00 = [\r\n       vec2(m[1][1], m[1][2]),\r\n       vec2(m[2][1], m[2][2])\r\n    ];\r\n    var a01 = [\r\n       vec2(m[1][0], m[1][2]),\r\n       vec2(m[2][0], m[2][2])\r\n    ];\r\n    var a02 = [\r\n       vec2(m[1][0], m[1][1]),\r\n       vec2(m[2][0], m[2][1])\r\n    ];\r\n    var a10 = [\r\n       vec2(m[0][1], m[0][2]),\r\n       vec2(m[2][1], m[2][2])\r\n    ];\r\n    var a11 = [\r\n       vec2(m[0][0], m[0][2]),\r\n       vec2(m[2][0], m[2][2])\r\n    ];\r\n    var a12 = [\r\n       vec2(m[0][0], m[0][1]),\r\n       vec2(m[2][0], m[2][1])\r\n    ];\r\n    var a20 = [\r\n       vec2(m[0][1], m[0][2]),\r\n       vec2(m[1][1], m[1][2])\r\n    ];\r\n    var a21 = [\r\n       vec2(m[0][0], m[0][2]),\r\n       vec2(m[1][0], m[1][2])\r\n    ];\r\n    var a22 = [\r\n       vec2(m[0][0], m[0][1]),\r\n       vec2(m[1][0], m[1][1])\r\n    ];\r\n\r\n   a[0][0] = det2(a00)/d;\r\n   a[0][1] = -det2(a10)/d;\r\n   a[0][2] = det2(a20)/d;\r\n   a[1][0] = -det2(a01)/d;\r\n   a[1][1] = det2(a11)/d;\r\n   a[1][2] = -det2(a21)/d;\r\n   a[2][0] = det2(a02)/d;\r\n   a[2][1] = -det2(a12)/d;\r\n   a[2][2] = det2(a22)/d;\r\n\r\n   return a;\r\n\r\n}\r\n\r\nfunction inverse4(m)\r\n{\r\n    var a = mat4();\r\n    var d = det4(m);\r\n\r\n    var a00 = [\r\n       vec3(m[1][1], m[1][2], m[1][3]),\r\n       vec3(m[2][1], m[2][2], m[2][3]),\r\n       vec3(m[3][1], m[3][2], m[3][3])\r\n    ];\r\n    var a01 = [\r\n       vec3(m[1][0], m[1][2], m[1][3]),\r\n       vec3(m[2][0], m[2][2], m[2][3]),\r\n       vec3(m[3][0], m[3][2], m[3][3])\r\n    ];\r\n    var a02 = [\r\n       vec3(m[1][0], m[1][1], m[1][3]),\r\n       vec3(m[2][0], m[2][1], m[2][3]),\r\n       vec3(m[3][0], m[3][1], m[3][3])\r\n    ];\r\n    var a03 = [\r\n       vec3(m[1][0], m[1][1], m[1][2]),\r\n       vec3(m[2][0], m[2][1], m[2][2]),\r\n       vec3(m[3][0], m[3][1], m[3][2])\r\n    ];\r\n    var a10 = [\r\n       vec3(m[0][1], m[0][2], m[0][3]),\r\n       vec3(m[2][1], m[2][2], m[2][3]),\r\n       vec3(m[3][1], m[3][2], m[3][3])\r\n    ];\r\n    var a11 = [\r\n       vec3(m[0][0], m[0][2], m[0][3]),\r\n       vec3(m[2][0], m[2][2], m[2][3]),\r\n       vec3(m[3][0], m[3][2], m[3][3])\r\n    ];\r\n    var a12 = [\r\n       vec3(m[0][0], m[0][1], m[0][3]),\r\n       vec3(m[2][0], m[2][1], m[2][3]),\r\n       vec3(m[3][0], m[3][1], m[3][3])\r\n    ];\r\n    var a13 = [\r\n       vec3(m[0][0], m[0][1], m[0][2]),\r\n       vec3(m[2][0], m[2][1], m[2][2]),\r\n       vec3(m[3][0], m[3][1], m[3][2])\r\n    ];\r\n    var a20 = [\r\n       vec3(m[0][1], m[0][2], m[0][3]),\r\n       vec3(m[1][1], m[1][2], m[1][3]),\r\n       vec3(m[3][1], m[3][2], m[3][3])\r\n    ];\r\n    var a21 = [\r\n       vec3(m[0][0], m[0][2], m[0][3]),\r\n       vec3(m[1][0], m[1][2], m[1][3]),\r\n       vec3(m[3][0], m[3][2], m[3][3])\r\n    ];\r\n    var a22 = [\r\n       vec3(m[0][0], m[0][1], m[0][3]),\r\n       vec3(m[1][0], m[1][1], m[1][3]),\r\n       vec3(m[3][0], m[3][1], m[3][3])\r\n    ];\r\n    var a23 = [\r\n       vec3(m[0][0], m[0][1], m[0][2]),\r\n       vec3(m[1][0], m[1][1], m[1][2]),\r\n       vec3(m[3][0], m[3][1], m[3][2])\r\n    ];\r\n\r\n    var a30 = [\r\n       vec3(m[0][1], m[0][2], m[0][3]),\r\n       vec3(m[1][1], m[1][2], m[1][3]),\r\n       vec3(m[2][1], m[2][2], m[2][3])\r\n    ];\r\n    var a31 = [\r\n       vec3(m[0][0], m[0][2], m[0][3]),\r\n       vec3(m[1][0], m[1][2], m[1][3]),\r\n       vec3(m[2][0], m[2][2], m[2][3])\r\n    ];\r\n    var a32 = [\r\n       vec3(m[0][0], m[0][1], m[0][3]),\r\n       vec3(m[1][0], m[1][1], m[1][3]),\r\n       vec3(m[2][0], m[2][1], m[2][3])\r\n    ];\r\n    var a33 = [\r\n       vec3(m[0][0], m[0][1], m[0][2]),\r\n       vec3(m[1][0], m[1][1], m[1][2]),\r\n       vec3(m[2][0], m[2][1], m[2][2])\r\n    ];\r\n\r\n\r\n\r\n   a[0][0] = det3(a00)/d;\r\n   a[0][1] = -det3(a10)/d;\r\n   a[0][2] = det3(a20)/d;\r\n   a[0][3] = -det3(a30)/d;\r\n   a[1][0] = -det3(a01)/d;\r\n   a[1][1] = det3(a11)/d;\r\n   a[1][2] = -det3(a21)/d;\r\n   a[1][3] = det3(a31)/d;\r\n   a[2][0] = det3(a02)/d;\r\n   a[2][1] = -det3(a12)/d;\r\n   a[2][2] = det3(a22)/d;\r\n   a[2][3] = -det3(a32)/d;\r\n   a[3][0] = -det3(a03)/d;\r\n   a[3][1] = det3(a13)/d;\r\n   a[3][2] = -det3(a23)/d;\r\n   a[3][3] = det3(a33)/d;\r\n\r\n   return a;\r\n}\r\nfunction inverse(m)\r\n{\r\n   if(m.matrix != true) console.log(\"not a matrix\");\r\n   if(m.length == 2) return inverse2(m);\r\n   if(m.length == 3) return inverse3(m);\r\n   if(m.length == 4) return inverse4(m);\r\n}\r\n\r\nfunction normalMatrix(m, flag)\r\n{\r\n    var a = mat4();\r\n    a = inverse(transpose(m));\r\n    if(flag != true) return a;\r\n    else {\r\n    var b = mat3();\r\n    for(var i=0;i<3;i++) for(var j=0; j<3; j++) b[i][j] = a[i][j];\r\n    return b;\r\n    }\r\n\r\n}\r\n\n;!(function ($) {\r\n  $.fn.classes = function (callback) {\r\n    var classes = [];\r\n    $.each(this, function (i, v) {\r\n      var splitClassName = v.className.split(/\\s+/);\r\n      for (var j = 0; j < splitClassName.length; j++) {\r\n        var className = splitClassName[j];\r\n        if (-1 === classes.indexOf(className)) {\r\n            classes.push(className);\r\n        }\r\n      }\r\n    });\r\n    if ('function' === typeof callback) {\r\n      for (var i in classes) {\r\n        callback(classes[i]);\r\n      }\r\n    }\r\n    return classes;\r\n  };\r\n})(jQuery);\r\n\nvar initGlProgram = function ( gl, shaders ) {\r\n  var program = gl.createProgram();\r\n  for (var i = 0; i < shaders.length; i += 1) {\r\n    gl.attachShader( program, shaders[ i ] );\r\n  }\r\n  gl.linkProgram( program );\r\n\r\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n    window.console.error(\"failed to link: \" + gl.getProgramInfoLog(program));\r\n    return null;\r\n  }\r\n  return program;\r\n};\r\n\r\nvar initGlShader = function ( gl, shaderScript, shaderType ) {\r\n  var shader = gl.createShader( shaderType );\r\n  gl.shaderSource( shader, shaderScript );\r\n  gl.compileShader( shader );\r\n  return shader;\r\n};\nclass BgSprite {\r\n  constructor (editor) {\r\n    this.map = editor.map;\r\n    this.style = editor.style;\r\n    this.editor = editor;\r\n    this.animating = false;\r\n    this.options = {\r\n      timeGap: 100,\r\n      duration: 1000,\r\n      entryLength: 100\r\n    };\r\n    this.width = this.editor.canvasNode.width;\r\n    this.height = this.editor.canvasNode.height;\r\n    this.ctx = this.editor.bgCtx;\r\n    this.gl = this.editor.bgGl;\r\n    this.init();\r\n  }\r\n\r\n  init () {\r\n  \r\n  }\r\n\r\n  update () {\r\n    this.map = this.editor.map;\r\n    this.style = this.editor.style;\r\n    this.width = this.editor.canvasNode.width;\r\n    this.height = this.editor.canvasNode.height;\r\n    this.ctx = this.editor.bgCtx;\r\n    this.gl = this.editor.bgGl;\r\n  }\r\n\r\n  drawStatic () {\r\n  }\r\n\r\n  drawFrame () {\r\n  }\r\n\r\n  advance (t) {\r\n    var stop = true;\r\n    return stop;\r\n  }\r\n\r\n  clear () {\r\n  }\r\n}\r\n\nclass TextSprite {\r\n  constructor (editor, options) {\r\n    this.map = editor.map;\r\n    this.style = editor.style;\r\n    this.editor = editor;\r\n    this.animating = false;\r\n    this.textStyle = 1;\r\n    this.options = options || {\r\n      timeGap: 100,\r\n      duration: 2000,\r\n      entryLength: 100\r\n    };\r\n    this.ctx = this.editor.ctx;\r\n    this.gl = this.editor.gl;\r\n    this.animationStyle = 0;\r\n    this._t = 0.0;\r\n    this.init();\r\n  }\r\n\r\n  init () {\r\n    this.clearArea = [0, 0, this.editor.ctx.canvas.width, this.editor.ctx.canvas.height];\r\n  }\r\n\r\n  changeOptions (options) {\r\n    Object.keys(options).forEach(function (key) {\r\n      this.options[key] = options[key];\r\n    });\r\n  }\r\n\r\n  changeTextStyle (style) {\r\n    this.textStyle = style;\r\n  }\r\n\r\n  update () {\r\n    this.map = this.editor.map;\r\n    this.style = this.editor.style;\r\n    this.startTime = Date.now();\r\n  }\r\n\r\n  drawStatic () {\r\n\r\n  }\r\n\r\n  drawFrame () {\r\n\r\n  }\r\n\r\n  advance (t) {\r\n    var stop = true;\r\n    if (stop) {\r\n      this.stop();\r\n    }\r\n    return stop;\r\n  }\r\n\r\n  stop () {\r\n    this._t = 0;\r\n    this.animating = false;\r\n  }\r\n\r\n  getAnimationMap () {\r\n    if (!this.animationMap) {\r\n      this.animationMap = [\r\n        {\r\n          label: '无',\r\n          value: 0\r\n        }\r\n      ];\r\n    }\r\n    return this.animationMap;\r\n  }\r\n\r\n  clear (useScissor) {\r\n    if (useScissor) {\r\n      if (!this.clearArea.length) {\r\n        return;\r\n      }\r\n      this.editor.ctx.clearRect(this.clearArea[0], this.clearArea[1], this.clearArea[2], this.clearArea[3]);\r\n    }\r\n    this.editor.ctx.clearRect(0, 0, this.editor.ctx.canvas.width, this.editor.ctx.canvas.height);\r\n  }\r\n}\r\n\nvar util = {\r\n  hexToRgb: function (hex) {\r\n    var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n    return result ? {\r\n      r: parseInt(result[1], 16),\r\n      g: parseInt(result[2], 16),\r\n      b: parseInt(result[3], 16)\r\n    } : null;\r\n  },\r\n\r\n  rgbToHex: function (r, g, b) {\r\n    function componentToHex(c) {\r\n      var hex = c.toString(16);\r\n      return hex.length == 1 ? \"0\" + hex : hex;\r\n    }\r\n\r\n    return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\r\n  },\r\n\r\n  getSpriteEntity: function () {\r\n    var entities = [];\r\n    return function (className, editor) {\r\n      var Klass = eval(className);\r\n      return entities[className] ? entities[className] : entities[className] = new Klass(editor);\r\n    };\r\n  }(),\r\n\r\n  getInitialState: function (name) {\r\n    return config[name + 'Map'][config.state[name + 'Index']].value;\r\n  }\r\n}\nvar config = {\r\n  fontMap: [\r\n    {\r\n      label: '隶书',\r\n      value: '隶书'\r\n    },\r\n    {\r\n      label: '楷体',\r\n      value: '楷体'\r\n    },\r\n    {\r\n      label: '华文新魏',\r\n      value: '华文新魏'\r\n    }\r\n  ],\r\n\r\n  fontSizeMap: [\r\n    {\r\n      label: '小',\r\n      value: 40\r\n    },\r\n    {\r\n      label: '中',\r\n      value: 50\r\n    },\r\n    {\r\n      label: '大',\r\n      value: 60\r\n    }\r\n  ],\r\n\r\n  fontColorMap: [\r\n    {\r\n      label: '黑',\r\n      value: '#000000'\r\n    },\r\n    {\r\n      label: '白',\r\n      value: '#FFFFFF'\r\n    },\r\n    {\r\n      label: '褐',\r\n      value: '#514848'\r\n    }\r\n  ],\r\n\r\n  textStyleMap: [\r\n    {\r\n      Klass: 'GlTextSprite',\r\n      style: 1,\r\n      label: '渲墨',\r\n      value: 0\r\n    },\r\n    {\r\n      Klass: 'GlTextSprite',\r\n      style: 2,\r\n      label: '立体',\r\n      value: 1\r\n    }\r\n  ],\r\n\r\n  textAlignMap: [\r\n    {\r\n      label: '居中',\r\n      value: 'center'\r\n    },\r\n    {\r\n      label: '左对齐',\r\n      value: 'left'\r\n    }\r\n  ],\r\n\r\n  backgroundMap: [\r\n    {\r\n      Klass: 'PureBgSprite',\r\n      label: '纯色',\r\n      value: 0,\r\n      colors: ['rgb(235, 235, 235)', '#FEFEFE', '#3a3a3a']\r\n    },\r\n    {\r\n      Klass: 'TreeBgSprite',\r\n      label: '月下林间',\r\n      value: 1,\r\n      colors: ['rgb(235, 235, 235)', '#b1a69b', '#3a3a3a']\r\n    }\r\n  ],\r\n\r\n  animationMap: [\r\n    {\r\n      label: '无',\r\n      value: 0\r\n    },\r\n    {\r\n      label: '粒子缓入',\r\n      value: 1\r\n    }\r\n  ],\r\n\r\n  state: {\r\n    fontIndex: 0,\r\n    fontSizeIndex: 0,\r\n    fontColorIndex: 0,\r\n    textStyleIndex: 0,\r\n    textAlignIndex: 0,\r\n    backgroundIndex: 0,\r\n    animationIndex: 1,\r\n    bgColorIndex: 0\r\n  }\r\n}\r\n\nvar textCtx = document.createElement(\"canvas\").getContext(\"2d\");\r\n\r\nfunction calTriangleArea (A, B, C) {\r\n  var a = distance(A, B);\r\n  var b = distance(B, C);\r\n  var c = distance(C, A);\r\n\r\n  var p = (a + b + c) / 2;\r\n  return Math.sqrt(p * (p - a) + (p - b) + (p - c));\r\n}\r\n\r\nfunction distance (p1, p2) {\r\n  return Math.sqrt( (p1[0] - p2[0]) * (p1[0] - p2[0]) + (p1[1] - p2[1]) * (p1[1] - p2[1]) + (p1[2] - p2[2]) * (p1[2] - p2[2]));\r\n}\r\n\r\nfunction makeTextData (text, size, options) {\r\n  var pointsArray = [];\r\n  var normalsArray = [];\r\n  var colorsArray = [];\r\n  var compIdxArray = [];\r\n  var e = [];\r\n  var g = [];\r\n  var markMap = [];\r\n  var cnt = 0;\r\n  var width = size;\r\n  var height = size;\r\n  textCtx.canvas.width  = width;\r\n  textCtx.canvas.height = height;\r\n\r\n  var ctx = textCtx;\r\n  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n  ctx.font = size + 'px ' + (options.font || '隶书');\r\n  ctx.fillStyle = 'black';\r\n  ctx.strokeStyle = 'black';\r\n  ctx.lineWidth = 1;\r\n  ctx.textAlign = 'center';\r\n  ctx.textBaseline = 'middle';\r\n  ctx.fillText(text, width / 2, height / 2);\r\n  var imageData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n  var data = imageData.data;\r\n  console.log(data)\r\n  var grid = 1;\r\n\r\n  var triangle = function (a, b, c, index, options) {\r\n    pointsArray.push(a);\r\n    pointsArray.push(b);\r\n    pointsArray.push(c);\r\n\r\n    compIdxArray.push(index);\r\n    compIdxArray.push(index);\r\n    compIdxArray.push(index);\r\n\r\n    var normal = cross(subtract(b, a), subtract(c, a));\r\n    normalsArray.push(vec4(normal[0], normal[1], normal[2], 0.0));\r\n    normalsArray.push(vec4(normal[0], normal[1], normal[2], 0.0));\r\n    normalsArray.push(vec4(normal[0], normal[1], normal[2], 0.0));\r\n\r\n    if (options) {\r\n      switch (options.colorStyle) {\r\n        case 'test':\r\n          var index = options.index;\r\n          var n = options.n;\r\n          var area = calTriangleArea(a, b, c);\r\n\r\n          var color = vec4( 0.0, 0.0, 0.0, area > 100 ? 1.0 : Math.pow(area / 100, 0.5) );\r\n          colorsArray.push(color);\r\n          colorsArray.push(color);\r\n          colorsArray.push(color);\r\n          break;\r\n      }\r\n    }\r\n  };\r\n\r\n  var hasPixel = function (j, i) {\r\n    //第j行，第i列\r\n    if (i < 0 || j < 0) {\r\n      return false;\r\n    }\r\n    return !!data[(j * ctx.canvas.width + i) * 4 + 3];\r\n  };\r\n\r\n  var markPoint = function (j, i) {\r\n    var value = 0;\r\n\r\n    if (i > 0 && hasPixel(j, i - 1)) {\r\n      //与左边连通\r\n      value = g[j][i - 1];\r\n    } else {\r\n      value = ++cnt;\r\n    }\r\n\r\n    if ( j > 0 && hasPixel(j - 1, i) && ( i === 0 || !hasPixel(j - 1, i - 1) ) ) {\r\n      //与上连通 且 与左上不连通 （即首次和上一行连接）\r\n      if (g[j - 1][i] !== value) {\r\n        markMap.push([g[j - 1][i], value]);\r\n      }\r\n    }\r\n\r\n    if ( !hasPixel(j, i - 1) ) {\r\n      //行首\r\n      if ( hasPixel(j - 1, i - 1) && g[j - 1][i - 1] !== value) {\r\n        //与左上连通\r\n        markMap.push([g[j - 1][i - 1], value]);\r\n      }\r\n    }\r\n\r\n    if ( !hasPixel(j, i + 1) ) {\r\n      //行尾\r\n      if ( hasPixel(j - 1, i + 1) && g[j - 1][i + 1] !== value) {\r\n        //与右上连通\r\n        markMap.push([g[j - 1][i + 1], value]);\r\n      }\r\n    }\r\n\r\n    return value;\r\n  };\r\n\r\n  for (var j = 0; j < ctx.canvas.height; j += grid) {\r\n    g.push([]);\r\n    e.push([]);\r\n\r\n    for (var i = 0; i < ctx.canvas.width; i += grid) {\r\n      var value = 0;\r\n      var isEdge = false;\r\n\r\n\r\n      if (hasPixel(j, i)) {\r\n        value = markPoint(j, i);\r\n      }\r\n      e[j][i] = isEdge;\r\n      g[j][i] = value;\r\n    }\r\n  }\r\n\r\n  var finalGraph = seperateGraph(g, e, markMap, cnt);\r\n  var graphs = finalGraph[0];\r\n  var sampledEdge = finalGraph[2];\r\n  var graphMap = [];\r\n  var z = options.thick / 2;\r\n  var z2 = -z;\r\n\r\n  sampledEdge.forEach(function (graph, index) {\r\n    var points = graph[0];\r\n    var holes = graph[1];\r\n    var triangles = earcut(flatten(points), holes);\r\n    var num = points.length;\r\n\r\n    for (var n = 0; n < triangles.length; n += 3) {\r\n      var a = points[triangles[n]];\r\n      var b = points[triangles[n + 1]];\r\n      var c = points[triangles[n + 2]];\r\n\r\n      //=====字体正面数据=====\r\n      triangle(vec3(a[0], a[1], z), vec3(b[0], b[1], z), vec3(c[0], c[1], z), index);\r\n\r\n      //=====字体背面数据=====\r\n      triangle(vec3(a[0], a[1], z2), vec3(b[0], b[1], z2), vec3(c[0], c[1], z2), index);\r\n    }\r\n\r\n    var holesMap = [];\r\n    var last = 0;\r\n\r\n    if (holes.length) {\r\n      for (var holeIndex = 0; holeIndex < holes.length; holeIndex++) {\r\n        holesMap.push([last, holes[holeIndex] - 1]);\r\n        last = holes[holeIndex];\r\n      }\r\n    }\r\n\r\n    holesMap.push([last, points.length - 1]);\r\n\r\n    for (var i = 0; i < holesMap.length; i++) {\r\n      var startAt = holesMap[i][0];\r\n      var endAt = holesMap[i][1];\r\n\r\n      for (var j = startAt; j < endAt; j++) {\r\n        triangle(vec3(points[j][0], points[j][1], z), vec3(points[j][0], points[j][1], z2), vec3(points[j+1][0], points[j+1][1], z), index);\r\n        triangle(vec3(points[j][0], points[j][1], z2), vec3(points[j+1][0], points[j+1][1], z2), vec3(points[j+1][0], points[j+1][1], z), index);\r\n      }\r\n      triangle(vec3(points[startAt][0], points[startAt][1], z), vec3(points[startAt][0], points[startAt][1], z2), vec3(points[endAt][0], points[endAt][1], z), index);\r\n      triangle(vec3(points[startAt][0], points[startAt][1], z2), vec3(points[endAt][0], points[endAt][1], z2), vec3(points[endAt][0], points[endAt][1], z), index);\r\n    }\r\n    graphMap.push(pointsArray.length);\r\n  });\r\n  return [pointsArray, normalsArray, colorsArray, compIdxArray, graphMap];\r\n}\r\n\r\nfunction seperateGraph (g, e, markMap, cnt) {\r\n  var graphs = [];\r\n  var graphsEdge = [];\r\n  var sampledEdge = []; \r\n\r\n  var markArr = [];\r\n  var fathers = [];\r\n  var markCollection = [];\r\n  \r\n  for (var i = 0; i < cnt; i++) {\r\n    markArr[i] = i;\r\n  }\r\n\r\n  var findFather = function (n) {\r\n    if (markArr[n] === n) {\r\n      return n;\r\n    } else {\r\n      markArr[n] = findFather(markArr[n]); \r\n      return markArr[n];\r\n    }\r\n  }\r\n\r\n  for (i = 0; i < markMap.length; i++) {\r\n    var a = markMap[i][0];\r\n    var b = markMap[i][1];\r\n    \r\n    var f1 = findFather(a);\r\n    var f2 = findFather(b);\r\n\r\n    if (f1 !== f2) {\r\n      markArr[f2] = f1;\r\n    }\r\n  }\r\n\r\n  for (i = 1; i < markArr.length; i++) {\r\n    var f = findFather(markArr[i]);\r\n    var index = fathers.indexOf(f);\r\n    if (index !== -1) {\r\n      markCollection[index].push(i)\r\n    } else {\r\n      fathers.push(f);\r\n      markCollection.push([i]);\r\n    }\r\n  }\r\n\r\n  for (i = 0; i < markCollection.length; i++) {\r\n    graphs.push([]);\r\n    graphsEdge.push([]);\r\n  }\r\n\r\n  for (var j = 0; j < g.length; j++) {\r\n    for (i = 0; i < g[j].length; i++) {\r\n      var v = g[j][i];\r\n      for (var n = 0; n < markCollection.length; n++) {\r\n        if (markCollection[n].indexOf(v) !== -1) {\r\n          g[j][i] = n + 1;\r\n          var p = [i, j];\r\n          graphs[n].push(p);\r\n          if (e[j][i]) {\r\n            graphsEdge[n].push(p);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  graphs.forEach(function (shape, index) {\r\n    sampledEdge.push(orderEdge(g, e, index, 0));\r\n  });\r\n  return [graphs, graphsEdge, sampledEdge];\r\n}\r\n\r\nfunction findOuterContourEntry (g, v) {\r\n  var start = [-1, -1];\r\n  for (var j = 0; j < g.length; j++) {\r\n    for (var i = 0; i < g[0].length; i++) {\r\n      if (g[j][i] === v) {\r\n        start = [i, j];\r\n        return start;\r\n      }\r\n    }\r\n  }\r\n  return start;\r\n}\r\n\r\nfunction findInnerContourEntry (g, v, e) {\r\n  var start = false;\r\n  for (var j = 0; j < g.length; j++) {\r\n    for (var i = 0; i < g[0].length; i++) {\r\n      if (g[j][i] === v && (g[j + 1] && g[j + 1][i] === 0)) {\r\n        var isInContours = false;\r\n        if (typeof(e[j][i]) === 'number') {\r\n          isInContours = true;\r\n        }\r\n        if (!isInContours) {\r\n          start = [i, j];\r\n          return start;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return start;\r\n}\r\n\r\nfunction orderEdge (g, e, v, gap) {\r\n  v++;\r\n  var rs = [];\r\n  var entryRecord = [];\r\n  var start = findOuterContourEntry(g, v);\r\n  var next = start;\r\n  var end = false;\r\n  rs.push(start);\r\n  entryRecord.push(6);\r\n  var holes = [];\r\n  var mark;\r\n  var holeMark = 2;\r\n  e[start[1]][start[0]] = holeMark;\r\n\r\n  var process = function (i, j) {\r\n    if (i < 0 || i >= g[0].length || j < 0 || j >= g.length) {\r\n      return false;\r\n    }\r\n\r\n    if (g[j][i] !== v || tmp) {\r\n      return false;\r\n    }\r\n    \r\n    e[j][i] = holeMark;\r\n    tmp = [i, j]\r\n    rs.push(tmp);\r\n    mark = true;\r\n\r\n    return true;\r\n  }\r\n\r\n  var map = [\r\n    (i,j) => {return {'i': i + 1, 'j': j}},\r\n    (i,j) => {return {'i': i + 1, 'j': j + 1}},\r\n    (i,j) => {return {'i': i, 'j': j +1}},\r\n    (i,j) => {return {'i': i - 1, 'j': j + 1}},\r\n    (i,j) => {return {'i': i - 1, 'j': j}},\r\n    (i,j) => {return {'i': i - 1, 'j': j - 1}},\r\n    (i,j) => {return {'i': i, 'j': j - 1}},\r\n    (i,j) => {return {'i': i + 1, 'j': j - 1}},\r\n  ];\r\n\r\n  var convertEntry = function (index) {\r\n    var arr = [4, 5, 6, 7, 0, 1, 2, 3];\r\n    return arr[index];\r\n  }\r\n\r\n  while (!end) {\r\n    var i = next[0];\r\n    var j = next[1];\r\n    var tmp = null;\r\n    var entryIndex = entryRecord[entryRecord.length - 1];\r\n\r\n    for (var c = 0; c < 8; c++) {\r\n      var index = ((entryIndex + 1) + c) % 8;\r\n      var hasNext = process(map[index](i, j).i, map[index](i, j).j);\r\n      if (hasNext) {\r\n        entryIndex = convertEntry(index);\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (tmp) {\r\n      next = tmp;\r\n\r\n      if ((next[0] === start[0]) && (next[1] === start[1])) {\r\n        var innerEntry = findInnerContourEntry(g, v, e);\r\n        if (innerEntry) {\r\n          next = start = innerEntry;\r\n          e[start[1]][start[0]] = holeMark;\r\n          rs.push(next);\r\n          entryRecord.push(entryIndex);\r\n          entryIndex = 2;\r\n          holes.push(rs.length - 1);\r\n          holeMark++;\r\n        } else {\r\n          end = true;\r\n        }\r\n      }\r\n    } else {\r\n      rs.splice(rs.length - 1, 1);\r\n      entryIndex = convertEntry(entryRecord.splice(entryRecord.length - 1, 1)[0]);\r\n      next = rs[rs.length - 1];\r\n    }\r\n\r\n    entryRecord.push(entryIndex);\r\n  }\r\n  return [rs, holes];\r\n}\r\n\r\nfunction convertCanvasToGl (x, y, z, size) {\r\n  return vec3((x - size / 2) / size, (size / 2 - y) / size, z);\r\n}\r\n\r\nfunction convertCanvasToGl2D (x, y, size) {\r\n  return vec2((x - size / 2) / size, (size / 2 - y) / size);\r\n}\r\n\r\nfunction parseArr (data, size) {\r\n  var points = data[0];\r\n  var normals = data[1];\r\n  var colors = data[2];\r\n\r\n  for (var i = 0; i < points.length; i++) {\r\n    points[i] = convertCanvasToGl(points[i][0], points[i][1], points[i][2], size);\r\n  }\r\n  return [points, normals, colors, data[3], data[4]];\r\n}\r\n\r\nfunction hslToRgb(h, s, l){\r\n    var r, g, b;\r\n\r\n    if(s == 0){\r\n        r = g = b = l;\r\n    }else{\r\n        var hue2rgb = function hue2rgb(p, q, t){\r\n            if(t < 0) t += 1;\r\n            if(t > 1) t -= 1;\r\n            if(t < 1/6) return p + (q - p) * 6 * t;\r\n            if(t < 1/2) return q;\r\n            if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;\r\n            return p;\r\n        }\r\n\r\n        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n        var p = 2 * l - q;\r\n        r = hue2rgb(p, q, h + 1/3);\r\n        g = hue2rgb(p, q, h);\r\n        b = hue2rgb(p, q, h - 1/3);\r\n    }\r\n\r\n    return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];\r\n}\r\n\r\nfunction rgbToHsl(r, g, b){\r\n    r /= 255, g /= 255, b /= 255;\r\n    var max = Math.max(r, g, b), min = Math.min(r, g, b);\r\n    var h, s, l = (max + min) / 2;\r\n\r\n    if(max == min){\r\n        h = s = 0;\r\n    }else{\r\n        var d = max - min;\r\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n        switch(max){\r\n            case r: h = (g - b) / d + (g < b ? 6 : 0); break;\r\n            case g: h = (b - r) / d + 2; break;\r\n            case b: h = (r - g) / d + 4; break;\r\n        }\r\n        h /= 6;\r\n    }\r\n\r\n    return [h, s, l];\r\n}\r\n\r\nfunction componentToHex(c) {\r\n  var hex = c.toString(16);\r\n  return hex.length == 1 ? \"0\" + hex : hex;\r\n}\r\n\r\nfunction rgbToHex(r, g, b) {\r\n  return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\r\n}\r\n\r\nfunction hexToRgb(hex) {\r\n  var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n  return result ? {\r\n    r: parseInt(result[1], 16),\r\n    g: parseInt(result[2], 16),\r\n    b: parseInt(result[3], 16)\r\n  } : null;\r\n}\r\n\nclass GlTextSprite extends TextSprite {\r\n  constructor (editor, options) {\r\n    super(editor, options);\r\n  }\r\n\r\n  init () {\r\n    super.init();\r\n    this.canvas = this.editor.glcanvasNode;\r\n    this.dataMap = {};\r\n    this.initGl();\r\n  }\r\n\r\n  update () {\r\n    super.update();\r\n    this._finish = false;\r\n    this.clearArea = [0, 0, this.canvas.width, this.canvas.height];\r\n  }\r\n\r\n  parseData () {\r\n    var map = this.map;\r\n    for (var i = 0; i < map.length; i++) {\r\n      for (var j = 0; j < map[i].length; j++) {\r\n        if (map[i][j].char && map[i][j].char !== ' ') {\r\n          var data = this.getTextData(map[i][j].char);\r\n          map[i][j].data = data;\r\n        }\r\n      }\r\n    }\r\n    $('.render-tip').removeClass('show');\r\n  }\r\n\r\n  getTextData (char) {\r\n    var font = this.style.font;\r\n    var data;\r\n    \r\n    if (!this.dataMap[font]) {\r\n      this.dataMap[font] = {};\r\n    }\r\n\r\n    if (Object.keys(this.dataMap[font]).indexOf(char) === -1) {\r\n      var size = 200;\r\n      data = makeTextData(char, size, {\r\n        thick: 0.1,\r\n        font: font\r\n      });\r\n      data = parseArr(data, size);\r\n      this.dataMap[font][char] = data;\r\n    } else {\r\n      data = this.dataMap[font][char];\r\n    }\r\n    return data;\r\n  }\r\n\r\n  drawStatic () {\r\n    var ctx = this.editor.ctx;\r\n    var map = this.map;\r\n\r\n    this.parseData();\r\n    this.clear();\r\n\r\n    for (var i = 0; i < map.length; i++) {\r\n      for (var j = 0; j < map[i].length; j++) {\r\n        if (map[i][j].char && map[i][j].char !== ' ') {\r\n          var data = map[i][j].data;\r\n          this.renderGlText(data, {\r\n            pos: {\r\n              x: map[i][j].x + this.editor.style.fontSize / 2, \r\n              y: map[i][j].y + this.style.lineHeight() / 2\r\n            }, \r\n            fontSize: this.style.fontSize,\r\n            fontColor: this.style.fontColor,\r\n            textStyle: this.textStyle,\r\n            t: 1.0\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  drawFrame () {\r\n    switch (this.style.animation) {\r\n      case 0:\r\n        var map = this.map;\r\n        var fontSize = this.editor.style.fontSize;\r\n        var gl = this.gl;\r\n        var finish = true;\r\n\r\n        this.clear(true);\r\n\r\n        for (var i = 0; i < map.length; i++) {\r\n          for (var j = 0; j < map[i].length; j++) {\r\n            if (map[i][j].char && map[i][j].char !== ' ') {\r\n              var data = map[i][j].data;\r\n              var period = this.t;\r\n              var t = 0;\r\n\r\n              if (Math.floor(period / 1000) < i) {\r\n                map[i][j].finish = -1;\r\n                finish = false;\r\n              } else if (Math.floor(period / 1000) === i) {\r\n                map[i][j].finish = 0;\r\n                finish = false;\r\n                t = (period % 1000) / 1000;\r\n              } else if (Math.floor(period / 1000) > i) {\r\n                t = 1.0;\r\n                if (map[i][j].finish) {\r\n                  map[i][j].finish += 1;\r\n                  this.clearArea = [0, 0, this.canvas.width, this.canvas.height - (map[i][j].y + this.style.lineHeight())];\r\n                } else {\r\n                  finish = false;\r\n                  map[i][j].finish = 1;\r\n                }\r\n              }\r\n\r\n              if (map[i][j].finish >= 0 && map[i][j].finish <= 2) {\r\n                var pos = {\r\n                  x: map[i][j].x + this.editor.style.fontSize / 2, \r\n                  y: map[i][j].y + this.style.lineHeight() / 2\r\n                };\r\n                this.renderGlText(data, {\r\n                  pos: pos, \r\n                  fontSize: fontSize,\r\n                  fontColor: this.style.fontColor,\r\n                  textStyle: this.textStyle,\r\n                  t: t\r\n                });\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        this._finish = finish;\r\n        break;\r\n      case 1:\r\n        this.drawStatic();\r\n        break;\r\n    }\r\n  }\r\n\r\n  advance (t) {\r\n    var stop = false;\r\n    this.t = t;\r\n\r\n    switch (this.style.animation) {\r\n      case 0:\r\n        stop = this._finish;\r\n        break\r\n      case 1:\r\n        stop = true;\r\n        break;\r\n    }\r\n\r\n    if (stop) {\r\n      this.stop();\r\n    }\r\n\r\n    return stop;\r\n  }\r\n\r\n  stop () {\r\n    this._t = 0;\r\n    this.animating = false;\r\n    this.clearArea = [0, 0, this.canvas.width, this.canvas.height];\r\n  }\r\n\r\n  getAnimationMap () {\r\n    if (!this.animationMap) {\r\n      this.animationMap = [\r\n        {\r\n          label: '纵横捭阖',\r\n          value: 0\r\n        },\r\n        {\r\n          label: '无',\r\n          value: 1\r\n        }\r\n      ];\r\n    }\r\n    return this.animationMap;\r\n  }\r\n\r\n  initGl () {\r\n    var gl = this.gl;\r\n\r\n    this.vertexShader = initGlShader( gl,\r\n      `attribute vec3 vPosition;\r\n      attribute vec4 vNormal;\r\n      attribute float compIdx;\r\n\r\n      varying vec4 fColor;\r\n\r\n      uniform float t;\r\n      uniform float compNum;\r\n      uniform int style;\r\n      uniform vec3 vColor;\r\n\r\n      uniform vec4 ambientProduct, diffuseProduct, specularProduct;\r\n      uniform mat4 modelViewMatrix;\r\n      uniform mat4 projectionMatrix;\r\n      uniform vec4 lightPosition;\r\n      uniform float shininess;\r\n      uniform mat3 normalMatrix;\r\n\r\n      void main() {\r\n        float n = (1.0 - t) * pow((1.0 + compIdx) / compNum, 2.0);\r\n        float xx = vPosition.x - vPosition.x * pow(n, 0.5);\r\n        float yy = vPosition.y - 2.0 * vPosition.y * pow(n, 2.0);\r\n        float zz = vPosition.z - pow(n, 0.5);\r\n        float ww = 1.0;\r\n        \r\n        vec4 aPosition = vec4(xx, yy, zz, ww);\r\n        vec3 pos = (modelViewMatrix * aPosition).xyz;\r\n\r\n        vec3 L;\r\n        \r\n        if(lightPosition.w == 0.0) \r\n          L = normalize(lightPosition.xyz);\r\n        else \r\n          L = normalize( lightPosition.xyz - pos );\r\n\r\n        vec3 E = -normalize( pos );\r\n        vec3 H = normalize( L + E );\r\n        vec3 N = normalize( normalMatrix*vNormal.xyz);\r\n\r\n        vec4 ambient = vec4(vColor, 1.0);\r\n\r\n        float Kd = max( dot(L, N), 0.0 );\r\n        vec4  diffuse = Kd*diffuseProduct;\r\n\r\n        float Ks = pow( max(dot(N, H), 0.0), shininess );\r\n        vec4  specular = Ks * specularProduct;\r\n        \r\n        if( dot(L, N) < 0.0 ) {\r\n          specular = vec4(0.0, 0.0, 0.0, 1.0);\r\n        }\r\n\r\n        gl_PointSize = 1.0;\r\n        gl_Position = projectionMatrix * modelViewMatrix * aPosition;\r\n\r\n        if (style == 1) {\r\n          if (dot(N, L) < 0.0) {\r\n            fColor = vec4(vColor, 1.0);\r\n          } else if (dot(N, L) < 0.8) {\r\n            fColor = vec4(0.0, 0.0, 0.0, 0.0);\r\n          } else {\r\n            fColor = vec4(vColor, 1.0);\r\n          }\r\n        } else if (style == 2) {\r\n          fColor = ambient + diffuse +specular;\r\n        }\r\n      }`, gl.VERTEX_SHADER);\r\n\r\n    this.fragmentShader = initGlShader(gl,\r\n      `precision mediump float;\r\n\r\n      varying vec4 fColor;\r\n\r\n      void main() {\r\n        gl_FragColor = fColor;\r\n      }`, gl.FRAGMENT_SHADER);\r\n    \r\n    this.program = initGlProgram(gl, [this.vertexShader, this.fragmentShader]);\r\n  }\r\n\r\n  renderGlText (data, options) {\r\n    var pos = options.pos;\r\n    var fontSize = options.fontSize;\r\n    var fontColor = hexToRgb(options.fontColor);\r\n    var textStyle = options.textStyle;\r\n    fontColor = vec3(fontColor.r / 255, fontColor.g / 255, fontColor.b / 255);\r\n\r\n    var t = options.t;\r\n\r\n    if (t === 0) {\r\n      return;\r\n    }\r\n\r\n    var gl = this.gl;\r\n    var program = this.program;\r\n\r\n    var pointsArray = [];\r\n    var normalsArray = [];\r\n    var colorArray = [];\r\n    var compIdxArray = [];\r\n\r\n    var near = -10;\r\n    var far = 10;\r\n    var radius = 1.5;\r\n    var theta  = 0.7;\r\n    var phi    = 0.1;\r\n    var dr = 5.0 * Math.PI/180.0;\r\n\r\n    var left = -3.0;\r\n    var right = 3.0;\r\n    var ytop =3.0;\r\n    var bottom = -3.0;\r\n\r\n    var lightPosition = vec4( 1.0, 1.0, 1.0, 0.0 );\r\n    var lightAmbient = vec4( 0.5, 0.5, 0.5, 1.0 );\r\n    var lightDiffuse = vec4( 1.0, 1.0, 1.0, 1.0 );\r\n    var lightSpecular = vec4( 1.0, 1.0, 1.0, 1.0 );\r\n\r\n    var materialAmbient = vec4( 0.5, 0.5, 0.5, 1.0 );\r\n    var materialDiffuse = vec4( 0.7, 0.7, 0.7, 1.0 );\r\n    var materialSpecular = vec4( 1.0, 1.0, 1.0, 1.0 );\r\n    var materialShininess = 20.0;\r\n\r\n    var ambientColor, diffuseColor, specularColor;\r\n\r\n    var modelViewMatrix, projectionMatrix;\r\n    var modelViewMatrixLoc, projectionMatrixLoc;\r\n\r\n    var normalMatrix, normalMatrixLoc;\r\n\r\n    var eye;\r\n    var at = vec3(0.0, 0.0, 0.0);\r\n    var up = vec3(0.0, 1.0, 0.0);\r\n\r\n    gl.useProgram( program );\r\n    gl.enable(gl.DEPTH_TEST);\r\n\r\n    gl.viewport( pos.x - fontSize * 4, (this.canvas.height - pos.y) - fontSize * 4, fontSize * 8, fontSize * 8);\r\n\r\n    var ambientProduct = mult(lightAmbient, materialAmbient);\r\n    var diffuseProduct = mult(lightDiffuse, materialDiffuse);\r\n    var specularProduct = mult(lightSpecular, materialSpecular);\r\n    var data;\r\n\r\n    pointsArray = data[0];\r\n    normalsArray = data[1];\r\n    colorArray = data[2];\r\n    var compIdxArray = data[3];\r\n    var graphMap = data[4];\r\n\r\n    var nBuffer = gl.createBuffer();\r\n    gl.bindBuffer( gl.ARRAY_BUFFER, nBuffer);\r\n    gl.bufferData( gl.ARRAY_BUFFER, flatten(normalsArray), gl.STATIC_DRAW );\r\n\r\n    var vNormal = gl.getAttribLocation( program, \"vNormal\" );\r\n    gl.vertexAttribPointer( vNormal, 4, gl.FLOAT, false, 0, 0 );\r\n    gl.enableVertexAttribArray( vNormal);\r\n\r\n    var vBuffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, flatten(pointsArray), gl.STATIC_DRAW);\r\n\r\n    var vPosition = gl.getAttribLocation( program, \"vPosition\");\r\n    gl.vertexAttribPointer(vPosition, 3, gl.FLOAT, false, 0, 0);\r\n    gl.enableVertexAttribArray(vPosition);\r\n\r\n    var iBuffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, iBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, flatten(compIdxArray), gl.STATIC_DRAW);\r\n\r\n    var compIdx = gl.getAttribLocation( program, \"compIdx\");\r\n    gl.vertexAttribPointer(compIdx, 1, gl.FLOAT, false, 0, 0);\r\n    gl.enableVertexAttribArray(compIdx);\r\n\r\n    modelViewMatrixLoc = gl.getUniformLocation( program, \"modelViewMatrix\" );\r\n    projectionMatrixLoc = gl.getUniformLocation( program, \"projectionMatrix\" );\r\n    normalMatrixLoc = gl.getUniformLocation( program, \"normalMatrix\" );\r\n\r\n    gl.uniform4fv( gl.getUniformLocation(program,\r\n      \"ambientProduct\"), flatten(ambientProduct) );\r\n    gl.uniform4fv( gl.getUniformLocation(program,\r\n      \"diffuseProduct\"), flatten(diffuseProduct) );\r\n    gl.uniform4fv( gl.getUniformLocation(program,\r\n      \"specularProduct\"), flatten(specularProduct) );\r\n    gl.uniform4fv( gl.getUniformLocation(program,\r\n      \"lightPosition\"), flatten(lightPosition) );\r\n    gl.uniform1f( gl.getUniformLocation(program,\r\n      \"shininess\"), materialShininess );\r\n    gl.uniform1f( gl.getUniformLocation(program,\r\n      \"compNum\"), graphMap.length );\r\n    gl.uniform1f( gl.getUniformLocation(program,\r\n      \"t\"), t );\r\n    gl.uniform1i( gl.getUniformLocation(program,\r\n      \"style\"), textStyle );\r\n    gl.uniform3fv( gl.getUniformLocation(program,\r\n      \"vColor\"), flatten(fontColor) );\r\n\r\n    eye = vec3(radius*Math.sin(theta)*Math.cos(phi),\r\n    radius*Math.sin(theta)*Math.sin(phi), radius*Math.cos(theta));\r\n\r\n    modelViewMatrix = lookAt(eye, at , up);\r\n    projectionMatrix = ortho(left, right, bottom, ytop, near, far);\r\n\r\n    normalMatrix = [\r\n      vec3(modelViewMatrix[0][0], modelViewMatrix[0][1], modelViewMatrix[0][2]),\r\n      vec3(modelViewMatrix[1][0], modelViewMatrix[1][1], modelViewMatrix[1][2]),\r\n      vec3(modelViewMatrix[2][0], modelViewMatrix[2][1], modelViewMatrix[2][2])\r\n    ];\r\n    gl.uniformMatrix4fv(modelViewMatrixLoc, false, flatten(modelViewMatrix) );\r\n    gl.uniformMatrix4fv(projectionMatrixLoc, false, flatten(projectionMatrix) );\r\n    gl.uniformMatrix3fv(normalMatrixLoc, false, flatten(normalMatrix) );\r\n    gl.drawArrays( gl.TRIANGLES, 0, pointsArray.length);\r\n  }\r\n\r\n  clear (useScissor) {\r\n    var gl = this.gl;\r\n    if (useScissor) {\r\n      if (!this.clearArea.length) {\r\n        return;\r\n      }\r\n      gl.enable(gl.SCISSOR_TEST);\r\n      gl.scissor(this.clearArea[0], this.clearArea[1], this.clearArea[2], this.clearArea[3]);\r\n      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n      gl.disable(gl.SCISSOR_TEST);\r\n    } else {\r\n      gl.clear( gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n    }\r\n  }\r\n}\r\n\nclass PureBgSprite extends BgSprite {\r\n  constructor (editor) {\r\n    super(editor);\r\n  }\r\n\r\n  drawStatic () {\r\n    this.clear();\r\n    var ctx = this.ctx;\r\n    var color = config.backgroundMap[config.state.backgroundIndex].colors[config.state.bgColorIndex];\r\n    ctx.fillStyle = color;\r\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n  }\r\n\r\n  drawFrame () {\r\n    this.drawStatic();\r\n  }\r\n\r\n  advance (t) {\r\n    var stop = true;\r\n    return stop;\r\n  }\r\n\r\n  clear () {\r\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n    this.gl.clear( this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\r\n  }\r\n}\r\n\nclass TreeBgSprite extends BgSprite {\r\n  constructor (editor) {\r\n    super(editor);\r\n  }\r\n\r\n  init () {\r\n    this.initGl();\r\n  }\r\n\r\n  drawStatic () {\r\n    this.clear();\r\n    var color = config.backgroundMap[config.state.backgroundIndex].colors[config.state.bgColorIndex];\r\n    this.ctx.fillStyle = color;\r\n    this.ctx.fillRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n\r\n    this.renderGlMoon({\r\n      pos: {x: 150, y: 150},\r\n      r: 100,\r\n      t: 1.0,\r\n      numTimesToSubdivide: 5\r\n    });\r\n\r\n    this.renderGlTree({\r\n      pos: {x: this.ctx.canvas.width - 350, y: this.ctx.canvas.height},\r\n      theta: 0.2,\r\n      minH: this.ctx.canvas.width / 80,\r\n      iniH: 30\r\n    });\r\n\r\n    this.renderGlTree({\r\n      pos: {x: this.ctx.canvas.width - 200, y: this.ctx.canvas.height},\r\n      theta: 0.2,\r\n      minH: this.ctx.canvas.width / 65,\r\n      iniH: 50\r\n    });\r\n  }\r\n\r\n  drawFrame () {\r\n    this.clear();\r\n    var color = config.backgroundMap[config.state.backgroundIndex].colors[config.state.bgColorIndex];\r\n    this.ctx.fillStyle = color;\r\n    this.ctx.fillRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n\r\n    this.renderGlMoon({\r\n      pos: {x: 150, y: 150},\r\n      r: 100,\r\n      t: this._t,\r\n      numTimesToSubdivide: 5\r\n    });\r\n\r\n    this.renderGlTree({\r\n      pos: {x: this.ctx.canvas.width - 350, y: this.ctx.canvas.height},\r\n      theta: 0.2 * this._t,\r\n      minH: this.ctx.canvas.width / 80,\r\n      iniH: 30\r\n    });\r\n\r\n    this.renderGlTree({\r\n      pos: {x: this.ctx.canvas.width - 200, y: this.ctx.canvas.height},\r\n      theta: 0.2 * this._t,\r\n      minH: this.ctx.canvas.width / 65,\r\n      iniH: 50\r\n    });\r\n  }\r\n\r\n  advance (t) {\r\n    var stop = true;\r\n    this.t = t;\r\n\r\n    if (this._t < 1) {\r\n      var dt = this.options.duration;\r\n      var progress = t / dt;\r\n      this._t = Math.pow(progress, 1);\r\n      stop = false;\r\n    }\r\n\r\n    if (stop) {\r\n      this.stop();\r\n    }\r\n\r\n    return stop;\r\n  }\r\n\r\n  stop () {\r\n    this.animating = false;\r\n    this._t = 0;\r\n  }\r\n\r\n  initGl () {\r\n    var gl = this.gl;\r\n\r\n    this.vertexMoonShader = initGlShader(gl,\r\n      `attribute vec4 vPosition;\r\n      attribute vec4 vNormal;\r\n      attribute float compIdx;\r\n\r\n      varying vec4 fColor;\r\n\r\n      uniform float t;\r\n      uniform float compNum;\r\n      uniform vec3 vColor;\r\n\r\n      uniform vec4 ambientProduct, diffuseProduct, specularProduct;\r\n      uniform mat4 modelViewMatrix;\r\n      uniform mat4 projectionMatrix;\r\n      uniform vec4 lightPosition;\r\n      uniform float shininess;\r\n      uniform mat3 normalMatrix;\r\n\r\n      void main() {\r\n        vec3 pos = (modelViewMatrix * vPosition).xyz;\r\n\r\n        vec3 L;\r\n        \r\n        if(lightPosition.w == 0.0) L = normalize(lightPosition.xyz);\r\n        else L = normalize( lightPosition.xyz - pos );\r\n         \r\n        vec3 E = -normalize( pos );\r\n        \r\n        vec3 H = normalize( L + E );\r\n        \r\n        vec3 N = normalize( normalMatrix*vNormal.xyz);\r\n\r\n        vec4 ambient = ambientProduct;\r\n\r\n        float Kd = max( dot(L, N), 0.0 );\r\n        vec4  diffuse = Kd*diffuseProduct;\r\n\r\n        float Ks = pow( max(dot(N, H), 0.0), shininess );\r\n        vec4  specular = Ks * specularProduct;\r\n        \r\n        if( dot(L, N) < 0.0 ) {\r\n          specular = vec4(0.0, 0.0, 0.0, 1.0);\r\n        }\r\n\r\n        gl_PointSize = 1.0;\r\n        gl_Position = projectionMatrix * modelViewMatrix * vPosition;\r\n\r\n        fColor = ambient + diffuse +specular;\r\n        fColor.a = 1.0;\r\n\r\n        if (dot(N, L) < 0.0) {\r\n          fColor = vec4(1.0, 1.0, 0.9 - 0.2 * t, 1.0);\r\n        } else if (dot(N, L) < 0.9 + t * 0.09 ) {\r\n          fColor = vec4(1.0, 1.0, 0.9 - 0.1 * t, 1.0);\r\n        } else {\r\n          fColor = vec4(1.0, 1.0, 0.9 + 0.05 * t, 1.0);\r\n        }\r\n      }`, gl.VERTEX_SHADER);\r\n\r\n    this.fragmentMoonShader = initGlShader(gl,\r\n      `precision mediump float;\r\n\r\n      varying vec4 fColor;\r\n\r\n      void main() {\r\n        gl_FragColor = fColor;\r\n      }`, gl.FRAGMENT_SHADER);\r\n    \r\n    this.moonProgram = initGlProgram(gl, [this.vertexMoonShader, this.fragmentMoonShader]);\r\n\r\n\r\n    this.vertexTreeShader = initGlShader(gl,\r\n      `attribute vec2 vPosition;\r\n\r\n      varying vec4 fColor;\r\n\r\n      void main() {\r\n        gl_PointSize = 1.0;\r\n        gl_Position = vec4(vPosition, 0.0, 1.0);\r\n\r\n        //fColor = vec4(1.0, 1.0, 1.0, 0.8);\r\n        fColor = vec4(0.8156862745098039, 0.8470588235294118, 0.8313725490196079, 1.0);\r\n        //fColor = vec4(0.5490196078431373, 0.5882352941176471, 0.5686274509803921, 0.9);\r\n      }`, gl.VERTEX_SHADER);\r\n\r\n    this.fragmentTreeShader = initGlShader(gl,\r\n      `precision mediump float;\r\n\r\n      varying vec4 fColor;\r\n\r\n      void main() {\r\n        gl_FragColor = fColor;\r\n      }`, gl.FRAGMENT_SHADER);\r\n    \r\n    this.treeProgram = initGlProgram(gl, [this.vertexTreeShader, this.fragmentTreeShader]);\r\n  }\r\n\r\n  renderGlTree (options) {\r\n    var pointsArray = [];\r\n    var colorsArray = [];\r\n    var pos = options.pos;\r\n    var theta = options.theta;\r\n    var cnt = 0;\r\n    var minH = options.minH * 2 / this.ctx.canvas.height;\r\n    var gl = this.gl;\r\n\r\n    function branch(root, h, phi, theta) {\r\n      //theta: 分叉角度\r\n      //phi: root枝杈角度\r\n\r\n      var left = {\r\n        x: 0 - h * Math.abs(Math.sin(theta)),\r\n        y: h * Math.abs(Math.cos(theta))\r\n      }\r\n\r\n      var right = {\r\n        x: h * Math.abs(Math.sin(theta)),\r\n        y: h * Math.abs(Math.cos(theta))\r\n      }\r\n\r\n      //rotate\r\n      var x = left.x * Math.cos(-phi) - left.y * Math.sin(-phi);\r\n      var y = left.x * Math.sin(-phi) + left.y * Math.cos(-phi);\r\n\r\n      left.x = x + root.x;\r\n      left.y = y + root.y;\r\n\r\n      //rotate\r\n      x = right.x * Math.cos(-phi) - right.y * Math.sin(-phi);\r\n      y = right.x * Math.sin(-phi) + right.y * Math.cos(-phi);\r\n\r\n      right.x = x + root.x;\r\n      right.y = y + root.y;\r\n\r\n      pointsArray.push(vec2(root.x, root.y));\r\n      pointsArray.push(vec2(left.x, left.y));\r\n      pointsArray.push(vec2(root.x, root.y));\r\n      pointsArray.push(vec2(right.x, right.y));\r\n      cnt++;\r\n\r\n      if (h >= minH) {\r\n        branch(left, h * 5 / 6, phi - theta, theta);\r\n        branch(right, h * 5 / 6, phi + theta, theta);\r\n      }\r\n    }\r\n\r\n    var h = options.iniH * 2 / this.ctx.canvas.height;\r\n    pointsArray.push(vec2(0.0, -1.0));\r\n    pointsArray.push(vec2(0.0, -1.0 + h));\r\n    branch({ x: 0.0, y: -1.0 + h }, h * 5 / 6, 0, theta * 2 / 3);\r\n\r\n    var program = this.treeProgram;\r\n    gl.useProgram( program );\r\n    gl.enable(gl.DEPTH_TEST);\r\n\r\n    gl.viewport( pos.x - this.ctx.canvas.width / 2, 0, this.ctx.canvas.width, this.ctx.canvas.height );\r\n\r\n    var vBuffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, flatten(pointsArray), gl.STATIC_DRAW);\r\n\r\n    var vPosition = gl.getAttribLocation( program, \"vPosition\");\r\n    gl.vertexAttribPointer(vPosition, 2, gl.FLOAT, false, 0, 0);\r\n    gl.enableVertexAttribArray(vPosition);\r\n\r\n    gl.drawArrays( gl.LINES, 0, pointsArray.length);\r\n  }\r\n\r\n  renderGlMoon (options) {\r\n\r\n    function triangle(a, b, c) {\r\n      pointsArray.push(a);\r\n      pointsArray.push(b);\r\n      pointsArray.push(c);\r\n\r\n      normalsArray.push(a[0],a[1], a[2], 0.0);\r\n      normalsArray.push(b[0],b[1], b[2], 0.0);\r\n      normalsArray.push(c[0],c[1], c[2], 0.0);\r\n    }\r\n\r\n    function divideTriangle(a, b, c, count) {\r\n      if ( count > 0 ) {\r\n        var ab = mix( a, b, 0.5);\r\n        var ac = mix( a, c, 0.5);\r\n        var bc = mix( b, c, 0.5);\r\n\r\n        ab = normalize(ab, true);\r\n        ac = normalize(ac, true);\r\n        bc = normalize(bc, true);\r\n\r\n        divideTriangle( a, ab, ac, count - 1 );\r\n        divideTriangle( ab, b, bc, count - 1 );\r\n        divideTriangle( bc, c, ac, count - 1 );\r\n        divideTriangle( ab, bc, ac, count - 1 );\r\n      }\r\n      else {\r\n        triangle( a, b, c );\r\n      }\r\n    }\r\n\r\n    function tetrahedron(a, b, c, d, n) {\r\n      divideTriangle(a, b, c, n);\r\n      divideTriangle(d, c, b, n);\r\n      divideTriangle(a, d, b, n);\r\n      divideTriangle(a, c, d, n);\r\n    }\r\n\r\n    var t = options.t;\r\n    var pos = options.pos;\r\n    var r = options.r;\r\n    var numTimesToSubdivide = options.numTimesToSubdivide || 5;\r\n\r\n    if (t >= 1) {\r\n      t = 1.0;\r\n    }\r\n    var phi = 0.1;\r\n    var theta = 0.2 + t * 0.5;\r\n\r\n    var gl = this.gl;\r\n    var program = this.moonProgram;\r\n\r\n    var pointsArray = [];\r\n    var normalsArray = [];\r\n    var colorArray = [];\r\n    var compIdxArray = [];\r\n\r\n    var near = -10;\r\n    var far = 10;\r\n    var radius = 1.5;\r\n    var dr = 5.0 * Math.PI/180.0;\r\n\r\n    var left = -3.0;\r\n    var right = 3.0;\r\n    var ytop =3.0;\r\n    var bottom = -3.0;\r\n\r\n    var va = vec4(0.0, 0.0, -1.0,1);\r\n    var vb = vec4(0.0, 0.942809, 0.333333, 1);\r\n    var vc = vec4(-0.816497, -0.471405, 0.333333, 1);\r\n    var vd = vec4(0.816497, -0.471405, 0.333333,1);\r\n\r\n    var lightPosition = vec4( 1.0, 1.0, 1.0, 0.0 );\r\n    var lightAmbient = vec4( 1.0, 1.0, 1.0, 1.0 );\r\n    var lightDiffuse = vec4( 1.0, 1.0, 1.0, 1.0 );\r\n    var lightSpecular = vec4( 1.0, 1.0, 1.0, 1.0 );\r\n\r\n    var materialAmbient = vec4( 1.0, 1.0, 0.7, 1.0 );\r\n    var materialDiffuse = vec4( 0.7, 0.7, 0.7, 1.0 );\r\n    var materialSpecular = vec4( 1.0, 1.0, 1.0, 1.0 );\r\n    var materialShininess = 20.0;\r\n\r\n    var ambientColor, diffuseColor, specularColor;\r\n\r\n    var modelViewMatrix, projectionMatrix;\r\n    var modelViewMatrixLoc, projectionMatrixLoc;\r\n\r\n    var normalMatrix, normalMatrixLoc;\r\n\r\n    var eye;\r\n    var at = vec3(0.0, 0.0, 0.0);\r\n    var up = vec3(0.0, 1.0, 0.0);\r\n\r\n    gl.useProgram( program );\r\n    gl.enable(gl.DEPTH_TEST);\r\n\r\n    gl.viewport(pos.x - 2 * r, this.ctx.canvas.height - ( pos.y + 2 * r ), 4 * r, 4 * r);\r\n\r\n    var ambientProduct = mult(lightAmbient, materialAmbient);\r\n    var diffuseProduct = mult(lightDiffuse, materialDiffuse);\r\n    var specularProduct = mult(lightSpecular, materialSpecular);\r\n    var data;\r\n\r\n    tetrahedron(va, vb, vc, vd, numTimesToSubdivide);\r\n\r\n    var nBuffer = gl.createBuffer();\r\n    gl.bindBuffer( gl.ARRAY_BUFFER, nBuffer);\r\n    gl.bufferData( gl.ARRAY_BUFFER, flatten(normalsArray), gl.STATIC_DRAW );\r\n\r\n    var vNormal = gl.getAttribLocation( program, \"vNormal\" );\r\n    gl.vertexAttribPointer( vNormal, 4, gl.FLOAT, false, 0, 0 );\r\n    gl.enableVertexAttribArray( vNormal);\r\n\r\n    var vBuffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, flatten(pointsArray), gl.STATIC_DRAW);\r\n\r\n    var vPosition = gl.getAttribLocation( program, \"vPosition\");\r\n    gl.vertexAttribPointer(vPosition, 4, gl.FLOAT, false, 0, 0);\r\n    gl.enableVertexAttribArray(vPosition);\r\n\r\n    modelViewMatrixLoc = gl.getUniformLocation( program, \"modelViewMatrix\" );\r\n    projectionMatrixLoc = gl.getUniformLocation( program, \"projectionMatrix\" );\r\n    normalMatrixLoc = gl.getUniformLocation( program, \"normalMatrix\" );\r\n\r\n    gl.uniform4fv( gl.getUniformLocation(program,\r\n      \"ambientProduct\"), flatten(ambientProduct) );\r\n    gl.uniform4fv( gl.getUniformLocation(program,\r\n      \"diffuseProduct\"), flatten(diffuseProduct) );\r\n    gl.uniform4fv( gl.getUniformLocation(program,\r\n      \"specularProduct\"), flatten(specularProduct) );\r\n    gl.uniform4fv( gl.getUniformLocation(program,\r\n      \"lightPosition\"), flatten(lightPosition) );\r\n    gl.uniform1f( gl.getUniformLocation(program,\r\n      \"shininess\"), materialShininess );\r\n    gl.uniform1f( gl.getUniformLocation(program,\r\n      \"t\"), t );\r\n\r\n    eye = vec3(radius*Math.sin(theta)*Math.cos(phi),\r\n    radius*Math.sin(theta)*Math.sin(phi), radius*Math.cos(theta));\r\n\r\n    modelViewMatrix = lookAt(eye, at , up);\r\n    projectionMatrix = ortho(left, right, bottom, ytop, near, far);\r\n\r\n    normalMatrix = [\r\n      vec3(modelViewMatrix[0][0], modelViewMatrix[0][1], modelViewMatrix[0][2]),\r\n      vec3(modelViewMatrix[1][0], modelViewMatrix[1][1], modelViewMatrix[1][2]),\r\n      vec3(modelViewMatrix[2][0], modelViewMatrix[2][1], modelViewMatrix[2][2])\r\n    ];\r\n\r\n    gl.uniformMatrix4fv(modelViewMatrixLoc, false, flatten(modelViewMatrix) );\r\n    gl.uniformMatrix4fv(projectionMatrixLoc, false, flatten(projectionMatrix) );\r\n    gl.uniformMatrix3fv(normalMatrixLoc, false, flatten(normalMatrix) );\r\n\r\n    gl.drawArrays( gl.TRIANGLES, 0, pointsArray.length);\r\n  }\r\n\r\n  clear () {\r\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n    this.gl.clear( this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\r\n  }\r\n}\r\n\nclass Data {\r\n  constructor (editor, text) {\r\n    this._content = [];\r\n    this.editor = editor;\r\n    this._lines = [];\r\n    text && this.addContent(0, text);\r\n  }\r\n\r\n  addContent (index, text) {\r\n    window._text = text\r\n    for (var i = 0; i < text.length; i++) {\r\n      this._content.splice(index, 0, text.charAt(i));\r\n      index++;\r\n    }\r\n    this._lines = this._content.join('').split('\\n');\r\n  }\r\n\r\n  deleteContent (index, length) {\r\n    var text = this._content.splice(index - length, length);\r\n    this._lines = this._content.join('').split('\\n');\r\n    return text.join('');\r\n  }\r\n\r\n  getContent (index, length) {\r\n    if (arguments.length === 0) {\r\n      return this._content.join();\r\n    } else {\r\n      return this._content.slice(index, index + length);\r\n    }\r\n  }\r\n\r\n  getLength () {\r\n    return this._content.length;\r\n  }\r\n\r\n  getLines () {\r\n    return this._lines;\r\n  }\r\n\r\n  getLine (index) {\r\n    return this._lines[index];\r\n  }\r\n}\r\n\nclass Editor {\r\n  constructor (options) {\r\n    this.options = {\r\n      paddingLeft: 120,\r\n      paddingRight: 120,\r\n      paddingTop: 65,\r\n      paddingBottom: 65,\r\n      bottomBarHeight: 68\r\n    }\r\n    this.onFocus = false;\r\n    this.isToolBarShown = false;\r\n    this.toolBarWidth = 200;\r\n    this.operations = [];\r\n    this.init();\r\n  }\r\n\r\n  init () {\r\n    this.createStyle();\r\n    this.initData();\r\n    this.selection = new Selection(this);\r\n    this.createElements();\r\n    this.bindEvents();\r\n    this.createMap();\r\n    this.style.initSprites();\r\n  }\r\n\r\n  resize () {\r\n    var windowWidth = $(window).width();\r\n    var windowHeight = $(window).height();\r\n    var $editor = $(this.editorNode);\r\n\r\n    var width = windowWidth > 800 ? windowWidth - this.options.paddingLeft - this.options.paddingRight : windowWidth - 50;\r\n    var height = windowWidth > 800 ? windowHeight - this.options.bottomBarHeight - this.options.paddingTop - this.options.paddingBottom : windowHeight - 135;\r\n    $editor.css('width', width + 'px');\r\n    $editor.css('height', height + 'px');\r\n    $editor.css('top', (windowHeight - height - this.options.bottomBarHeight) / 2 + 'px');\r\n    this.canvasNode.width = width;\r\n    this.canvasNode.height = height;\r\n    if (this.isToolBarShown && windowWidth > 800) {\r\n      this.updateRelativeLocation((windowHeight - height - this.options.bottomBarHeight) / 2, this.toolBarWidth + (windowWidth - this.toolBarWidth - width) / 2);\r\n    } else {\r\n      this.updateRelativeLocation((windowHeight - height - 75) / 2, (windowWidth - width) / 2);\r\n    }\r\n    this.renderText()\r\n  }\r\n\r\n  showToolBar () {\r\n    var windowWidth = $(window).width();\r\n    var windowHeight = $(window).height();\r\n    var width = windowWidth > 800 ? windowWidth - this.options.paddingLeft - this.options.paddingRight : windowWidth - 50;\r\n    var height = windowWidth > 800 ? windowHeight - this.options.bottomBarHeight - this.options.paddingTop - this.options.paddingBottom : windowHeight - 135;\r\n    this.isToolBarShown = true;\r\n    this.updateRelativeLocation((windowHeight - height - this.options.bottomBarHeight) / 2, this.toolBarWidth + (windowWidth - this.toolBarWidth - width) / 2);\r\n  }\r\n\r\n  hideToolBar () {\r\n    var windowWidth = $(window).width();\r\n    var windowHeight = $(window).height();\r\n    var width = windowWidth > 800 ? windowWidth - this.options.paddingLeft - this.options.paddingRight : windowWidth - 50;\r\n    var height = windowWidth > 800 ? windowHeight - this.options.bottomBarHeight - this.options.paddingTop - this.options.paddingBottom : windowHeight - 135;\r\n    this.isToolBarShown = false;\r\n    this.updateRelativeLocation((windowHeight - height - this.options.bottomBarHeight) / 2, (windowWidth - width) / 2);\r\n  }\r\n\r\n  updateRelativeLocation (top, left) {\r\n    this.top = top;\r\n    this.left = left;\r\n  }\r\n\r\n  createStyle () {\r\n    this.style = new Style(this);\r\n  }\r\n\r\n  createElements () {\r\n    var windowWidth = $(window).width();\r\n    var windowHeight = $(window).height();\r\n    var width = windowWidth > 800 ? windowWidth - this.options.paddingLeft - this.options.paddingRight : windowWidth - 50;\r\n    var height = windowWidth > 800 ? windowHeight - this.options.bottomBarHeight - this.options.paddingTop - this.options.paddingBottom : windowHeight - 135;\r\n    \r\n    this.$editor = $('#editor');\r\n    this.editorNode = this.$editor.get(0);\r\n\r\n    this.$editor.css('overflow', 'hidden');\r\n    this.$editor.css('position', 'relative');\r\n    this.$editor.css('box-shadow', '1px 1px 3px 1px #bbb');\r\n    this.$editor.css('margin', 'auto');\r\n    this.$editor.css('width', width + 'px');\r\n    this.$editor.css('height', height + 'px');\r\n    this.$editor.css('top', (windowHeight - height - this.options.bottomBarHeight) / 2 + 'px');\r\n    //this.$editor.css('background-color', 'rgba(217, 218, 214)');\r\n    this.$editor.css('background-color', 'rgb(241, 240, 236)');\r\n\r\n    this.hiddenCanvas = document.createElement('canvas');\r\n    this.hiddenCtx = this.hiddenCanvas.getContext('2d');\r\n    this.hiddenCanvas.width = this.style.lineHeight();\r\n    this.hiddenCanvas.height = this.style.lineHeight();\r\n    \r\n    //for background canvas\r\n    this.$bgCanvas = $('#bg-canvas');\r\n    this.$bgGlcanvas = $('#bg-glcanvas');\r\n    this.bgGlcanvasNode = this.$bgGlcanvas.get(0);\r\n    this.bgCanvasNode = this.$bgCanvas.get(0);\r\n    this.bgCtx = this.bgCanvasNode.getContext('2d');\r\n    this.bgCanvasNode.width = width;\r\n    this.bgCanvasNode.height = height;\r\n    this.bgGlcanvasNode.width = width;\r\n    this.bgGlcanvasNode.height = height;\r\n    this.bgGl = this.bgGlcanvasNode.getContext('webgl', { preserveDrawingBuffer: true });\r\n\r\n    //for text canvas\r\n    this.$canvas = $('#text-canvas');\r\n    this.$glcanvas = $('#text-glcanvas');\r\n    this.glcanvasNode = this.$glcanvas.get(0);\r\n    this.canvasNode = this.$canvas.get(0);\r\n    this.ctx = this.canvasNode.getContext('2d');\r\n    this.canvasNode.width = width;\r\n    this.canvasNode.height = height;\r\n    this.glcanvasNode.width = width;\r\n    this.glcanvasNode.height = height;\r\n    this.gl = this.glcanvasNode.getContext('webgl', { preserveDrawingBuffer: true });\r\n\r\n    this.$input = $('<textarea>');\r\n    this.inputNode = this.$input.get(0);\r\n\r\n    this.$input.css('position', 'absolute');\r\n    this.$input.css('top', '-10px');\r\n    this.$input.css('left', '-10px');\r\n    this.$input.css('width', '1px');\r\n    this.$input.css('height', '1px');\r\n\r\n    this.$editor.append(this.$input);\r\n\r\n    this.$cursor = $('<div class=\"cursor\"></div>');\r\n    this.cursorNode = this.$cursor.get(0);\r\n    this.$cursor.css('width', '1px');\r\n    this.$cursor.css('height', this.style.lineHeight() + 'px');\r\n    this.$cursor.css('position', 'absolute');\r\n    this.$cursor.css('top', this.selection.rowIndex * this.style.lineHeight());\r\n    this.$cursor.css('left', this.selection.colIndex * this.fontSize);\r\n    this.$cursor.css('background-color', 'black');\r\n    this.$editor.append(this.$cursor);\r\n    this.hideCursor();\r\n    \r\n    this.updateRelativeLocation((windowHeight - height - this.options.bottomBarHeight) / 2, (windowWidth - width) / 2);\r\n  }\r\n\r\n  updateCursor () {\r\n    var pos = this.selection.getSelEndPosition();\r\n    this.$cursor.css('height', this.style.lineHeight() + 'px');\r\n    this.$cursor.css('left', this.map[pos.rowIndex][pos.colIndex].cursorX + 'px');\r\n    this.$cursor.css('top', this.map[pos.rowIndex][pos.colIndex].cursorY + 'px');\r\n  }\r\n\r\n  initData () {\r\n    this.data = new Data(this);\r\n  }\r\n\r\n  bindEvents () {\r\n    this.$input.on('change', this.onInputChange.bind(this));\r\n    this.$input.on('focus', this.onInputFocus.bind(this));\r\n    this.$input.on('blur', this.onInputBlur.bind(this));\r\n    this.$input.on('keydown', this.onKeyDown.bind(this));\r\n    this.$input.on('compositionstart', this.onCompStart.bind(this));\r\n    this.$input.on('compositionend', this.onCompEnd.bind(this));\r\n    this.$input.on('input', this.onInputChar.bind(this));\r\n    this.$editor.on('touchstart', this.onTouchStart.bind(this));\r\n    this.$editor.on('touchend', this.onTouchEnd.bind(this));\r\n    this.$editor.on('mousedown', this.onMouseDown.bind(this));\r\n    this.$editor.on('mouseup', this.onMouseUp.bind(this));\r\n    $('body').on('click touchend', this.onGlobalClick.bind(this));\r\n    $(window).on('resize', this.resize.bind(this));\r\n    $(window).on('scroll', this.onScroll.bind(this));\r\n  }\r\n\r\n  findPosfromMap (x, y) {\r\n    if (this.map.length === 0) {\r\n      return {col: 0, row: 0};\r\n    }\r\n\r\n    var map = this.map;\r\n    var startRow = 0;\r\n    var endRow = this.map.length - 1;\r\n    var row, col;\r\n    var charLength = this.style.fontSize;\r\n    var lineHeight = this.style.lineHeight();\r\n    var pos = {row: 0, col: 0};\r\n\r\n    for (row = 0; row < map.length; row++) {\r\n      for (col = 0; col < map[row].length; col++) {\r\n        if ( Math.abs(x - map[row][col].cursorX) < charLength / 2 && ( y > map[row][col].cursorY && y < map[row][col].cursorY + lineHeight ) ) {\r\n          pos = {row: row, col: col};\r\n          return pos;\r\n        }\r\n      }\r\n    }\r\n\r\n    return pos;\r\n  }\r\n\r\n  clearInputNodeValue () {\r\n    this.inputNode.value = '';\r\n  }\r\n\r\n  onKeyDown (e) {\r\n    switch (e.keyCode) {\r\n      case 8:\r\n        if (this.map[0].length <= 1 && this.map.length <= 1) {\r\n          return;\r\n        }\r\n        this.deleteText(this.selection.getSelEndPosition().index, this.selection.getSelLength() || 1);\r\n        this.clearInputNodeValue();\r\n        this.selection.update(this.selection.getSelEndPosition().index - 1);\r\n        this.renderText();\r\n        break;\r\n      case 37:\r\n        this.selection.update(this.selection.getSelEndPosition().index - 1);\r\n        this.updateCursor();\r\n        break;\r\n      case 38:\r\n        \r\n        break;\r\n      case 39:\r\n        this.selection.update(this.selection.getSelEndPosition().index + 1);\r\n        this.updateCursor();\r\n        break;\r\n      case 40:\r\n\r\n        break;\r\n    }\r\n  }\r\n\r\n  insertText (index, text) {\r\n    this.data.addContent(index, text);\r\n    this.selection.update(index + text.length);\r\n    this.operations.push({\r\n      action: index >= this.data.getLength() ? 'add' : 'insert',\r\n      index: index,\r\n      text: text\r\n    });\r\n  }\r\n\r\n  deleteText (index, length) {\r\n    var text = this.data.deleteContent(index, length);\r\n    this.operations.push({\r\n      action: 'delete',\r\n      index: index,\r\n      text: text\r\n    });\r\n  }\r\n\r\n  clearText () {\r\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n    this.gl.clear( this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\r\n  }\r\n\r\n  clearCanvas () {\r\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n    this.bgCtx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n    this.gl.clear( this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\r\n    this.bgGl.clear( this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\r\n  }\r\n\r\n  createMap () {\r\n    this.map = [[{\r\n      char: '',\r\n      x: this.style.padding[3],\r\n      y: this.style.padding[0],\r\n      cursorX: this.style.textAlign === 'center' ? this.canvasNode.width / 2 : this.style.padding[3],\r\n      cursorY: this.style.padding[0]\r\n    }]]\r\n  }\r\n\r\n  _convertWindowPosToCanvas (x, y) {\r\n    var windowWidth = $(window).width();\r\n    var windowHeight = $(window).height();\r\n    var x2 = x - this.left;\r\n    var y2 = y - this.top;\r\n\r\n    if (x2 < 0 || x2 > this.canvasNode.width || y2 < 0 || y2 > this.canvasNode.height) {\r\n      x2 = -1;\r\n      y2 = -1;\r\n    }\r\n\r\n    return {\r\n      x: x2,\r\n      y: y2\r\n    }\r\n  }\r\n\r\n  _convertCanvasPosToWindow (x, y) {\r\n    var windowWidth = $(window).width();\r\n    var windowHeight = $(window).height();\r\n    var x2 = x + this.left;\r\n    var y2 = y + this.top;\r\n\r\n    return {\r\n      x: x2,\r\n      y: y2\r\n    }\r\n  }\r\n\r\n  onGlobalClick (e) {\r\n    var pos = this._convertWindowPosToCanvas(e.clientX, e.clientY);\r\n\r\n    if (pos.x === -1 && pos.y === -1) {\r\n      this.blur();\r\n    }\r\n  }\r\n\r\n  onInputChange (e) {\r\n  }\r\n\r\n  onInputBlur (e) {\r\n    this.inputStatus = 'NULL';\r\n  }\r\n\r\n  onInputFocus (e) {\r\n  }\r\n\r\n  onCompStart (e) {\r\n    this.inputStatus = 'CHINESE_TYPING';\r\n  }\r\n\r\n  onCompEnd (e) {\r\n    var that = this;\r\n    setTimeout(function () {\r\n      that.input();\r\n      that.inputStatus = 'CHINESE_TYPE_END';\r\n    }, 100)\r\n  }\r\n\r\n  onInputChar (e) {\r\n    if (this.inputStatus === 'CHINESE_TYPING') {\r\n      return;\r\n    }\r\n    \r\n    this.inputStatus = 'CHAR_TYPING';\r\n    this.input();\r\n  }\r\n\r\n  onScroll (e) {\r\n    this.touch = {};\r\n    this.click = {};\r\n  }\r\n\r\n  input (e) {\r\n    this.insertText(this.selection.getSelEndPosition().index, this.inputNode.value);\r\n    this.clearInputNodeValue();\r\n    this.renderText();\r\n  }\r\n\r\n  onMouseUp (e) {\r\n    e.preventDefault();\r\n\r\n    var that = this;\r\n\r\n    if (this.click) {\r\n      var pos = this._convertWindowPosToCanvas(e.clientX, e.clientY);\r\n      if (pos.x !== -1 && pos.y !== -1) {\r\n        this.focus(pos.x, pos.y);\r\n      } else {\r\n        this.blur();\r\n      }\r\n    }\r\n    this.click = {}\r\n  }\r\n\r\n  onMouseDown (e) {\r\n    this.click = {\r\n      x: e.clientX, \r\n      y: e.clientY\r\n    }\r\n  }\r\n\r\n  onTouchStart (e) {\r\n    this.touch = e.touches[0]\r\n  }\r\n\r\n  onTouchEnd (e) {\r\n    e.preventDefault();\r\n\r\n    var that = this;\r\n\r\n    if (this.touch) {\r\n      var pos = this._convertWindowPosToCanvas(e.changedTouches[0].clientX, e.changedTouches[0].clientY);\r\n      if (pos.x !== -1 && pos.y !== -1) {\r\n        this.focus(pos.x, pos.y);\r\n      } else {\r\n        this.blur();\r\n      }\r\n    }\r\n    this.touch = {}\r\n  }\r\n\r\n  hideCursor () {\r\n    this.$cursor.css('visibility', 'hidden');\r\n  }\r\n\r\n  blur () {\r\n    this.hideCursor();\r\n    this.inputNode.blur();\r\n    this.onFocus = false;\r\n  }\r\n\r\n  focus (x, y) {\r\n    var pos = this.findPosfromMap(x, y);\r\n    this.selection.update(pos.row, pos.col);\r\n    this.updateCursor();\r\n    this.$input.focus();\r\n    this.$cursor.css('visibility', 'visible');\r\n    this.onFocus = true;\r\n  }\r\n\r\n  updateMap (map) {\r\n    this.map = map;\r\n  }\r\n\r\n  measureStrLength (str) {\r\n    var length = 0;\r\n    var chars = str.split('');\r\n    chars.forEach(function (char) {\r\n      if (char) {\r\n        var code = char.charCodeAt(0);\r\n        if ((code >= 48 && code <= 57) || (code >= 65 && code <= 90) || (code >= 97 && code <= 122)) {\r\n          length += 0.5;\r\n        } else {\r\n          length += 1;\r\n        }\r\n      }\r\n    });\r\n\r\n    return length;\r\n  }\r\n\r\n  renderText () {\r\n    this.bgSprite.drawStatic();\r\n\r\n    var xCursor = this.style.padding[3];\r\n    var yCursor = this.style.padding[0];\r\n    var map = [];\r\n    var lines = this.data.getLines();\r\n\r\n    if (lines.length === 0) {\r\n      lines.push('');\r\n    }\r\n    \r\n    this.ctx.font = this.style.fontSize + \"px serif\";\r\n    this.ctx.textAlign = 'left';\r\n    this.ctx.textBaseline = 'middle';\r\n\r\n    switch (this.style.textAlign) {\r\n      case 'left':\r\n        for (var i = 0; i < lines.length; i++) {\r\n          var lineMap = [];\r\n          var charLength = this.style.fontSize;\r\n          xCursor = this.style.padding[3];\r\n\r\n          var chars = lines[i].split('');\r\n          lineMap.push({\r\n            char: '',\r\n            x: xCursor,\r\n            y: yCursor,\r\n            cursorX: xCursor,\r\n            cursorY: yCursor\r\n          })\r\n          for (var j = 0; j < chars.length; j++) {\r\n            var charGap = charLength;\r\n            xCursor += charLength;\r\n            lineMap.push({\r\n              char: chars[j],\r\n              x: xCursor - charGap,\r\n              y: yCursor,\r\n              cursorX: xCursor,\r\n              cursorY: yCursor\r\n            })\r\n            if ((j + 1 < chars.length) && (xCursor + charGap > this.canvasNode.width - this.style.padding[1] - this.style.padding[3])) {\r\n              yCursor += this.style.lineHeight();\r\n              xCursor = this.style.padding[3];\r\n            }\r\n          }\r\n          map.push(lineMap);\r\n          yCursor += this.style.lineHeight();\r\n          yCursor += this.style.space;\r\n        }\r\n        break;\r\n      case 'center':\r\n        for (var i = 0; i < lines.length; i++) {\r\n          var lineMap = [];\r\n          var chars = lines[i].split('');\r\n          var charLength = this.style.fontSize; //this.ctx.measureText(chars[j]).width;\r\n          var length = charLength * chars.length;//this.measureStrLength(lines[i]);//this.ctx.measureText(lines[i]).width;\r\n          \r\n          if (length > (this.canvasNode.width - this.style.padding[0] - this.style.padding[3])) {\r\n            xCursor = this.style.padding[3];\r\n          } else {\r\n            xCursor = ((this.canvasNode.width - this.style.padding[0] - this.style.padding[3]) - length) / 2 + this.style.padding[3]; \r\n          }\r\n          lineMap.push({\r\n            char: '',\r\n            x: xCursor,\r\n            y: yCursor,\r\n            cursorX: xCursor,\r\n            cursorY: yCursor\r\n          })\r\n\r\n          while (length > (this.canvasNode.width - this.style.padding[0] - this.style.padding[3])) {\r\n            xCursor = this.style.padding[3];\r\n            for (var j = 0; j < chars.length; j++) {\r\n              var charGap = charLength;// * this.measureStrLength(chars[j]);\r\n              xCursor += charGap;\r\n              lineMap.push({\r\n                char: chars[j],\r\n                x: xCursor - charGap,\r\n                y: yCursor,\r\n                cursorX: xCursor,\r\n                cursorY: yCursor\r\n              })\r\n              if ((j + 1 < chars.length) && (xCursor + charGap > this.canvasNode.width - this.style.padding[1])) {\r\n                yCursor += this.style.lineHeight();\r\n                chars.splice(0, j + 1);\r\n                length = charLength * chars.length;//maersureStrLength(chars.join(''));\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          \r\n          if (length) {\r\n            xCursor = ((this.canvasNode.width - this.style.padding[0] - this.style.padding[3]) - length) / 2 + this.style.padding[3];\r\n            for (j = 0; j < chars.length; j++) {\r\n              var charGap = charLength;// * this.measureStrLength(chars[j]);\r\n              xCursor += charGap;\r\n              lineMap.push({\r\n                char: chars[j],\r\n                x: xCursor - charGap,\r\n                y: yCursor,\r\n                cursorX: xCursor,\r\n                cursorY: yCursor\r\n              })\r\n            }\r\n          }\r\n\r\n          map.push(lineMap);\r\n          yCursor += this.style.lineHeight();\r\n          yCursor += this.style.space;\r\n        }\r\n        break;\r\n    }\r\n    this.updateMap(map);\r\n    this.textSprite.update();\r\n    this._fillText();\r\n    this.updateCursor();\r\n  }\r\n\r\n  _fillText () {\r\n    if (this.map.length === 1 && this.map[0].length === 1) {\r\n      this.textSprite.clear();\r\n    } else {\r\n      $('.render-tip').addClass('show');\r\n      setTimeout(this.textSprite.drawStatic.bind(this.textSprite), 10);\r\n    }\r\n  }\r\n\r\n  play () {\r\n    this.animating = true;\r\n    this.animationInfo = {\r\n      textStop: false,\r\n      bgStop: false\r\n    };\r\n    this.startTime = Date.now();\r\n    this.textSprite.update();\r\n    this.bgSprite.update();\r\n\r\n    window.requestAnimationFrame(this.tick.bind(this));\r\n  }\r\n\r\n  tick () {\r\n    if (!this.animating) {\r\n      return;\r\n    }\r\n\r\n    var t = Date.now() - this.startTime;\r\n    !this.animationInfo.textStop && (this.animationInfo.textStop = this.textSprite.advance(t));\r\n    !this.animationInfo.bgStop && (this.animationInfo.bgStop = this.bgSprite.advance(t));\r\n    \r\n    if (this.animationInfo.textStop && this.animationInfo.bgStop) {\r\n      this.stopPlay();\r\n    } else {\r\n      this.animationInfo.bgStop ? this.bgSprite.drawStatic() : this.bgSprite.drawFrame();\r\n      this.animationInfo.textStop ? this.textSprite.drawStatic() : this.textSprite.drawFrame();\r\n      window.requestAnimationFrame(this.tick.bind(this));\r\n    }\r\n  }\r\n\r\n  stopPlay () {\r\n    this.animating = false;\r\n    this.renderText();\r\n    bottomBar.config.$dom.find('.play').removeClass('stop');\r\n  }\r\n\r\n  generateGif () {\r\n    \r\n  }\r\n\r\n  generateJpeg () {\r\n    var canvas = document.createElement('canvas');\r\n    canvas.width = this.canvasNode.width;\r\n    canvas.height = this.canvasNode.height;\r\n    var ctx = canvas.getContext('2d');\r\n    ctx.drawImage(this.bgCanvasNode, 0, 0);\r\n    ctx.drawImage(this.bgGlcanvasNode, 0, 0);\r\n    ctx.drawImage(this.canvasNode, 0, 0);\r\n    ctx.drawImage(this.glcanvasNode, 0, 0);\r\n\r\n    var imgData = canvas.toDataURL(\"image/jpeg\", 1.0);\r\n    return imgData;\r\n  }\r\n\r\n  generatePng () {\r\n    var canvas = document.createElement('canvas');\r\n    canvas.width = this.canvasNode.width;\r\n    canvas.height = this.canvasNode.height;\r\n    var ctx = canvas.getContext('2d');\r\n    ctx.drawImage(this.bgCanvasNode, 0, 0);\r\n    ctx.drawImage(this.bgGlcanvasNode, 0, 0);\r\n    ctx.drawImage(this.canvasNode, 0, 0);\r\n    ctx.drawImage(this.glcanvasNode, 0, 0);\r\n\r\n    var imgData = canvas.toDataURL(\"image/png\");\r\n    return imgData;\r\n  }\r\n}\r\n\nclass Selection {\r\n  constructor (editor) {\r\n    this.editor = editor;\r\n    this.startColIndex = this.endColIndex = 0;\r\n    this.startRowIndex = this.endRowIndex = 0;\r\n  }\r\n\r\n  getSelEndPosition () {\r\n    return {\r\n      colIndex: this.endColIndex,\r\n      rowIndex: this.endRowIndex,\r\n      index: this._convertIndexByMap(this.endRowIndex, this.endColIndex)\r\n    }\r\n  }\r\n\r\n  getSelLength () {\r\n    return 0;\r\n  }\r\n\r\n  update (startRowIndex, startColIndex, endRowIndex, endColIndex) {\r\n    if (arguments.length === 1) {\r\n      var index = arguments[0];\r\n      if (index > this.editor.data.getLength() || index < 0) {\r\n        return;\r\n      }\r\n      this.index = index;\r\n      var pos = this._convertMapByIndex(index);\r\n      this.startColIndex = this.endColIndex = pos.col;\r\n      this.startRowIndex = this.endRowIndex = pos.row;\r\n    } else if (arguments.length === 2) {\r\n      this.startColIndex = this.endColIndex = startColIndex;\r\n      this.startRowIndex = this.endRowIndex = startRowIndex;\r\n    }\r\n  }\r\n\r\n  _convertIndexByMap (row, col) {\r\n    var lines = this.editor.data.getLines();\r\n    var index = 0;\r\n    for (var i = 0; i < lines.length; i++) {\r\n      if (i < row) {\r\n        index += lines[i].length + 1;\r\n      } else if (i === row) {\r\n        index += col;\r\n      }\r\n    }\r\n    return index;\r\n  }\r\n\r\n  _convertMapByIndex (index) {\r\n    var lines = this.editor.data.getLines();\r\n    var row = 0;\r\n    var col = 0;\r\n\r\n    for (var i = 0; i < lines.length; i++) {\r\n      if (index > lines[i].length) {\r\n        index -= (lines[i].length + 1);\r\n        row++;\r\n      } else {\r\n        col = index;\r\n        break;\r\n      }\r\n    }\r\n    return {\r\n      row: row,\r\n      col: col\r\n    };\r\n  }\r\n}\r\n\nclass Style {\r\n  constructor (editor) {\r\n    this.editor = editor;\r\n    this.initDefaultStyle();\r\n  }\r\n\r\n  changeStyle (options) {\r\n    var keys = Object.keys(options);\r\n    for (var i = 0; i < keys.length; i++) {\r\n      this[keys[i]] = options[keys[i]];\r\n\r\n      if (keys[i] === 'textStyle') {\r\n        this.changeTextStyle(options[keys[i]]);\r\n      }\r\n\r\n      if (keys[i] === 'background') {\r\n        this.changeBgStyle(options[keys[i]]);\r\n      }\r\n    }\r\n\r\n    if (this.editor.hiddenCanvas) {\r\n      this.editor.hiddenCanvas.width = this.lineHeight();\r\n      this.editor.hiddenCanvas.height = this.lineHeight();\r\n    }\r\n  }\r\n\r\n  changeTextStyle (index) {\r\n    this.editor.textSprite = util.getSpriteEntity(config.textStyleMap[index].Klass, this.editor);\r\n    this.editor.textSprite.changeTextStyle(config.textStyleMap[index].style);\r\n    config.animationMap = this.editor.textSprite.getAnimationMap();\r\n    this.editor.textSprite.update();\r\n  }\r\n\r\n  changeBgStyle (index) {\r\n    this.editor.bgSprite = util.getSpriteEntity(config.backgroundMap[index].Klass, this.editor);\r\n    this.editor.bgSprite.update();\r\n  }\r\n\r\n  lineHeight () {\r\n    return this.lineHeightRatio * this.fontSize;\r\n  }\r\n\r\n  initDefaultStyle () {\r\n    this.changeStyle({\r\n      textAlign: util.getInitialState('textAlign'),\r\n      fontSize: util.getInitialState('fontSize'),\r\n      lineHeightRatio: 1.2,\r\n      textWeight: 800,\r\n      padding: [80, 50, 50, 80],\r\n      space: 20,\r\n      animation: util.getInitialState('animation'),\r\n      fontColor: util.getInitialState('fontColor')\r\n    });\r\n  }\r\n\r\n  initSprites () {\r\n    this.changeStyle({\r\n      textStyle: util.getInitialState('textStyle'),\r\n      background: util.getInitialState('background')\r\n    })\r\n  }\r\n}\r\n\nvar bottomBar = {\r\n  config: {\r\n    $dom: $('.bottom-bar')\r\n  },\r\n\r\n  init: function () {\r\n    this.bindEvents();\r\n  },\r\n\r\n  bindEvents: function () {\r\n    var that = this;\r\n\r\n    that.config.$dom.find('.export').on('click touchend', function (e) {\r\n      selectModal.show();\r\n    });\r\n\r\n    that.config.$dom.find('.play').on('touchend click', function (e) {\r\n      if ($(this).hasClass('stop')) {\r\n        editor.stopPlay();\r\n        $(this).removeClass('stop');\r\n      } else {\r\n        editor.play();\r\n        $(this).addClass('stop');\r\n      }\r\n    });\r\n\r\n    that.config.$dom.find('.tool').on('touchend click', function (e) {\r\n      if (toolBar.config.isShown) {\r\n        toolBar.hide(editor);\r\n        $(this).find('.label').text('工具栏');\r\n      } else {\r\n        toolBar.show(editor);\r\n        $(this).find('.label').text('隐藏');\r\n      }\r\n    });\r\n  }\r\n}\nvar resultModal = {\r\n  config: {\r\n    $dom: $('.export-result-modal')\r\n  },\r\n\r\n  init: function () {\r\n    this.bindEvents();\r\n  },\r\n\r\n  bindEvents: function () {\r\n    var that = this;\r\n    that.config.$dom.find('.dim-layer').on('click touchend', function (e) {\r\n      that.hide();\r\n    });\r\n  },\r\n\r\n  show: function (imgData) {\r\n    this.config.$dom.find('img').attr('src', imgData);\r\n    this.config.$dom.addClass('show');\r\n  },\r\n\r\n  hide: function () {\r\n    this.config.$dom.removeClass('show');\r\n  }\r\n}\nvar selectModal = {\r\n  config: {\r\n    $dom: $('.export-select-modal'),\r\n    selection: 'jpeg'\r\n  },\r\n\r\n  init: function () {\r\n    this.bindEvents();\r\n  },\r\n\r\n  bindEvents: function () {\r\n    var that = this;\r\n\r\n    that.config.$dom.find('.item').on('click touchend', function (e) {\r\n      that.config.selection = $(this).text().toLowerCase();\r\n      that.config.$dom.find('.item').removeClass('active');\r\n      $(this).addClass('active');\r\n    });\r\n\r\n    that.config.$dom.find('.confirm').on('click touchend', function (e) {\r\n      that.hide();\r\n      that.export(that.config.selection);\r\n    });\r\n\r\n    that.config.$dom.find('.cancel').on('click touchend', function (e) {\r\n      that.hide();\r\n    });\r\n  },\r\n\r\n  show: function () {\r\n    this.config.$dom.addClass('show');\r\n  },\r\n\r\n  hide: function () {\r\n    this.config.$dom.removeClass('show');\r\n  },\r\n\r\n  export: function (option) {\r\n    var imgData;\r\n    switch (option) {\r\n      case 'jpeg':\r\n        imgData = editor.generateJpeg();\r\n        resultModal.show(imgData);\r\n        break;\r\n      case 'png':\r\n        imgData = editor.generatePng();\r\n        resultModal.show(imgData);\r\n        break;\r\n      case 'gif':\r\n        editor.generateGif().then(function (imgData) {\r\n          resultModal.show(imgData);\r\n        });\r\n        break;\r\n    }\r\n  }\r\n}\nvar toolBar = {\r\n  config: {\r\n    isShown: false\r\n  },\r\n\r\n  init: function () {\r\n    this.onChange = false;\r\n    this.config.$dom.find('.tool-bar-item').each(function () {\r\n      var classes = $(this).classes();\r\n      var re = /i-(.*)/i;\r\n      $(this).find('.value').append('<span class=\"spinner-icon\"></span>');\r\n      $(this).find('.spinner-icon').hide();\r\n\r\n      classes.forEach(function (className) {\r\n        if (re.test(className)) {\r\n          var name = RegExp.$1;\r\n          toolBar.update(name);\r\n        }\r\n      })\r\n    });\r\n    this.updateBgColor();\r\n    this.bindEvents();\r\n  },\r\n\r\n  bindEvents: function () {\r\n    var that = this;\r\n\r\n    that.config.$dom.find('.tool-bar-item .value').on('click touchend', function (e) {\r\n      var classes = $(this).parent().classes();\r\n      var $el = $(this);\r\n      var re = /i-(.*)/i;\r\n\r\n      classes.forEach(function (className) {\r\n        if (re.test(className)) {\r\n          var name = RegExp.$1;\r\n          if (!that[name + 'OnChange']) {\r\n            $el.find('.spinner-icon').show();\r\n            toolBar.changeStyle(name);\r\n          }\r\n        }\r\n      })\r\n    });\r\n\r\n    that.config.$dom.find('.close-icon').on('touchend click', function (e) {\r\n      that.hide(editor);\r\n      bottomBar.config.$dom.find('.label').text('工具栏');\r\n    });\r\n\r\n    that.config.$dom.find('.color-switch').on('touchend click', function (e) {\r\n      that.changeBgColor();\r\n    });\r\n  },\r\n\r\n  hide: function (editor) {\r\n    $('.wrapper').removeClass('show-tool-bar');\r\n    $('.wrapper').addClass('hide-tool-bar');\r\n    editor.hideToolBar();\r\n    this.config.isShown = false;\r\n  },\r\n\r\n  show: function (editor) {\r\n    if ($('.wrapper').hasClass('default')) {\r\n      $('.wrapper').removeClass('default')\r\n    } else {\r\n      $('.wrapper').removeClass('hide-tool-bar');\r\n    }\r\n    $('.wrapper').addClass('show-tool-bar');\r\n    editor.showToolBar();\r\n    this.config.isShown = true;\r\n  },\r\n\r\n  nextIndex: function (name) {\r\n    var index = config.state[name + 'Index'];\r\n    var map = config[name + 'Map'];\r\n    if (index < map.length - 1) {\r\n      config.state[name + 'Index'] += 1;\r\n    } else {\r\n      config.state[name + 'Index'] = 0;\r\n    }\r\n    return config.state[name + 'Index'];\r\n  },\r\n\r\n  changeStyle: function (name) {\r\n    var index = this.nextIndex(name);\r\n    this.update(name);\r\n  },\r\n\r\n  update: function (name) {\r\n    this[name + 'OnChange'] = true;\r\n    var index = config.state[name + 'Index'];\r\n    var style = config[name + 'Map'][index];\r\n    var value = style.value;\r\n    var label = style.label;\r\n    var options = {};\r\n    options[name] = value;\r\n    $('.i-' + name + ' .value .text').text(label);\r\n\r\n    var that = this;\r\n    editor.style.changeStyle(options);\r\n\r\n    if (this[name + 'Change'] && typeof(this[name + 'Change']) === 'function') {\r\n      this[name + 'Change'].call(this, style);\r\n    }\r\n\r\n    editor.clearCanvas();\r\n    editor.renderText();\r\n\r\n    setTimeout(function (name, label) {\r\n      that[name + 'OnChange'] = false;\r\n      $('.i-' + name + ' .value .text').text(label);\r\n      $('.i-' + name + ' .value .spinner-icon').hide();\r\n    }, 500, name, label);\r\n  },\r\n\r\n  textStyleChange: function (style) {\r\n    config.state['animationIndex'] = 0;\r\n    this.update('animation');\r\n  },\r\n\r\n  backgroundChange: function (style) {\r\n    var colors = style.colors;\r\n    if (colors.length === 0) {\r\n      $('.color-switch').hide();\r\n      config.state.bgColorIndex = null;\r\n    } else {\r\n      $('.color-switch').css('background-color', colors[0]).show();\r\n      config.state.bgColorIndex = 0;\r\n    }\r\n  },\r\n\r\n  changeBgColor: function () {\r\n    var colors = config.backgroundMap[config.state.backgroundIndex].colors;\r\n    var index = config.state.bgColorIndex;\r\n    index = index + 1 >= colors.length ? 0 : ++index;\r\n    config.state.bgColorIndex = index;\r\n    this.updateBgColor();\r\n  },\r\n\r\n  updateBgColor: function () {\r\n    editor.renderText();\r\n    var colors = config.backgroundMap[config.state.backgroundIndex].colors;\r\n    var index = config.state.bgColorIndex;\r\n    $('.color-switch').css('background-color', colors[index]);\r\n  }\r\n}\r\n\r\ntoolBar.config.$dom = $('.tool-bar-wrap');\r\n\n(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nwindow.earcut = require('earcut');\r\nwindow.editor = new Editor({});\r\n\r\ntoolBar.init();\r\nbottomBar.init();\r\nresultModal.init();\r\nselectModal.init();\n},{\"earcut\":2}],2:[function(require,module,exports){\n'use strict';\n\nmodule.exports = earcut;\n\nfunction earcut(data, holeIndices, dim) {\n\n    dim = dim || 2;\n\n    var hasHoles = holeIndices && holeIndices.length,\n        outerLen = hasHoles ? holeIndices[0] * dim : data.length,\n        outerNode = linkedList(data, 0, outerLen, dim, true),\n        triangles = [];\n\n    if (!outerNode) return triangles;\n\n    var minX, minY, maxX, maxY, x, y, size;\n\n    if (hasHoles) outerNode = eliminateHoles(data, holeIndices, outerNode, dim);\n\n    // if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox\n    if (data.length > 80 * dim) {\n        minX = maxX = data[0];\n        minY = maxY = data[1];\n\n        for (var i = dim; i < outerLen; i += dim) {\n            x = data[i];\n            y = data[i + 1];\n            if (x < minX) minX = x;\n            if (y < minY) minY = y;\n            if (x > maxX) maxX = x;\n            if (y > maxY) maxY = y;\n        }\n\n        // minX, minY and size are later used to transform coords into integers for z-order calculation\n        size = Math.max(maxX - minX, maxY - minY);\n    }\n\n    earcutLinked(outerNode, triangles, dim, minX, minY, size);\n\n    return triangles;\n}\n\n// create a circular doubly linked list from polygon points in the specified winding order\nfunction linkedList(data, start, end, dim, clockwise) {\n    var i, last;\n\n    if (clockwise === (signedArea(data, start, end, dim) > 0)) {\n        for (i = start; i < end; i += dim) last = insertNode(i, data[i], data[i + 1], last);\n    } else {\n        for (i = end - dim; i >= start; i -= dim) last = insertNode(i, data[i], data[i + 1], last);\n    }\n\n    if (last && equals(last, last.next)) {\n        removeNode(last);\n        last = last.next;\n    }\n\n    return last;\n}\n\n// eliminate colinear or duplicate points\nfunction filterPoints(start, end) {\n    if (!start) return start;\n    if (!end) end = start;\n\n    var p = start,\n        again;\n    do {\n        again = false;\n\n        if (!p.steiner && (equals(p, p.next) || area(p.prev, p, p.next) === 0)) {\n            removeNode(p);\n            p = end = p.prev;\n            if (p === p.next) return null;\n            again = true;\n\n        } else {\n            p = p.next;\n        }\n    } while (again || p !== end);\n\n    return end;\n}\n\n// main ear slicing loop which triangulates a polygon (given as a linked list)\nfunction earcutLinked(ear, triangles, dim, minX, minY, size, pass) {\n    if (!ear) return;\n\n    // interlink polygon nodes in z-order\n    if (!pass && size) indexCurve(ear, minX, minY, size);\n\n    var stop = ear,\n        prev, next;\n\n    // iterate through ears, slicing them one by one\n    while (ear.prev !== ear.next) {\n        prev = ear.prev;\n        next = ear.next;\n\n        if (size ? isEarHashed(ear, minX, minY, size) : isEar(ear)) {\n            // cut off the triangle\n            triangles.push(prev.i / dim);\n            triangles.push(ear.i / dim);\n            triangles.push(next.i / dim);\n\n            removeNode(ear);\n\n            // skipping the next vertice leads to less sliver triangles\n            ear = next.next;\n            stop = next.next;\n\n            continue;\n        }\n\n        ear = next;\n\n        // if we looped through the whole remaining polygon and can't find any more ears\n        if (ear === stop) {\n            // try filtering points and slicing again\n            if (!pass) {\n                earcutLinked(filterPoints(ear), triangles, dim, minX, minY, size, 1);\n\n            // if this didn't work, try curing all small self-intersections locally\n            } else if (pass === 1) {\n                ear = cureLocalIntersections(ear, triangles, dim);\n                earcutLinked(ear, triangles, dim, minX, minY, size, 2);\n\n            // as a last resort, try splitting the remaining polygon into two\n            } else if (pass === 2) {\n                splitEarcut(ear, triangles, dim, minX, minY, size);\n            }\n\n            break;\n        }\n    }\n}\n\n// check whether a polygon node forms a valid ear with adjacent nodes\nfunction isEar(ear) {\n    var a = ear.prev,\n        b = ear,\n        c = ear.next;\n\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\n\n    // now make sure we don't have other points inside the potential ear\n    var p = ear.next.next;\n\n    while (p !== ear.prev) {\n        if (pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0) return false;\n        p = p.next;\n    }\n\n    return true;\n}\n\nfunction isEarHashed(ear, minX, minY, size) {\n    var a = ear.prev,\n        b = ear,\n        c = ear.next;\n\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\n\n    // triangle bbox; min & max are calculated like this for speed\n    var minTX = a.x < b.x ? (a.x < c.x ? a.x : c.x) : (b.x < c.x ? b.x : c.x),\n        minTY = a.y < b.y ? (a.y < c.y ? a.y : c.y) : (b.y < c.y ? b.y : c.y),\n        maxTX = a.x > b.x ? (a.x > c.x ? a.x : c.x) : (b.x > c.x ? b.x : c.x),\n        maxTY = a.y > b.y ? (a.y > c.y ? a.y : c.y) : (b.y > c.y ? b.y : c.y);\n\n    // z-order range for the current triangle bbox;\n    var minZ = zOrder(minTX, minTY, minX, minY, size),\n        maxZ = zOrder(maxTX, maxTY, minX, minY, size);\n\n    // first look for points inside the triangle in increasing z-order\n    var p = ear.nextZ;\n\n    while (p && p.z <= maxZ) {\n        if (p !== ear.prev && p !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0) return false;\n        p = p.nextZ;\n    }\n\n    // then look for points in decreasing z-order\n    p = ear.prevZ;\n\n    while (p && p.z >= minZ) {\n        if (p !== ear.prev && p !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0) return false;\n        p = p.prevZ;\n    }\n\n    return true;\n}\n\n// go through all polygon nodes and cure small local self-intersections\nfunction cureLocalIntersections(start, triangles, dim) {\n    var p = start;\n    do {\n        var a = p.prev,\n            b = p.next.next;\n\n        if (!equals(a, b) && intersects(a, p, p.next, b) && locallyInside(a, b) && locallyInside(b, a)) {\n\n            triangles.push(a.i / dim);\n            triangles.push(p.i / dim);\n            triangles.push(b.i / dim);\n\n            // remove two nodes involved\n            removeNode(p);\n            removeNode(p.next);\n\n            p = start = b;\n        }\n        p = p.next;\n    } while (p !== start);\n\n    return p;\n}\n\n// try splitting polygon into two and triangulate them independently\nfunction splitEarcut(start, triangles, dim, minX, minY, size) {\n    // look for a valid diagonal that divides the polygon into two\n    var a = start;\n    do {\n        var b = a.next.next;\n        while (b !== a.prev) {\n            if (a.i !== b.i && isValidDiagonal(a, b)) {\n                // split the polygon in two by the diagonal\n                var c = splitPolygon(a, b);\n\n                // filter colinear points around the cuts\n                a = filterPoints(a, a.next);\n                c = filterPoints(c, c.next);\n\n                // run earcut on each half\n                earcutLinked(a, triangles, dim, minX, minY, size);\n                earcutLinked(c, triangles, dim, minX, minY, size);\n                return;\n            }\n            b = b.next;\n        }\n        a = a.next;\n    } while (a !== start);\n}\n\n// link every hole into the outer loop, producing a single-ring polygon without holes\nfunction eliminateHoles(data, holeIndices, outerNode, dim) {\n    var queue = [],\n        i, len, start, end, list;\n\n    for (i = 0, len = holeIndices.length; i < len; i++) {\n        start = holeIndices[i] * dim;\n        end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\n        list = linkedList(data, start, end, dim, false);\n        if (list === list.next) list.steiner = true;\n        queue.push(getLeftmost(list));\n    }\n\n    queue.sort(compareX);\n\n    // process holes from left to right\n    for (i = 0; i < queue.length; i++) {\n        eliminateHole(queue[i], outerNode);\n        outerNode = filterPoints(outerNode, outerNode.next);\n    }\n\n    return outerNode;\n}\n\nfunction compareX(a, b) {\n    return a.x - b.x;\n}\n\n// find a bridge between vertices that connects hole with an outer ring and and link it\nfunction eliminateHole(hole, outerNode) {\n    outerNode = findHoleBridge(hole, outerNode);\n    if (outerNode) {\n        var b = splitPolygon(outerNode, hole);\n        filterPoints(b, b.next);\n    }\n}\n\n// David Eberly's algorithm for finding a bridge between hole and outer polygon\nfunction findHoleBridge(hole, outerNode) {\n    var p = outerNode,\n        hx = hole.x,\n        hy = hole.y,\n        qx = -Infinity,\n        m;\n\n    // find a segment intersected by a ray from the hole's leftmost point to the left;\n    // segment's endpoint with lesser x will be potential connection point\n    do {\n        if (hy <= p.y && hy >= p.next.y) {\n            var x = p.x + (hy - p.y) * (p.next.x - p.x) / (p.next.y - p.y);\n            if (x <= hx && x > qx) {\n                qx = x;\n                if (x === hx) {\n                    if (hy === p.y) return p;\n                    if (hy === p.next.y) return p.next;\n                }\n                m = p.x < p.next.x ? p : p.next;\n            }\n        }\n        p = p.next;\n    } while (p !== outerNode);\n\n    if (!m) return null;\n\n    if (hx === qx) return m.prev; // hole touches outer segment; pick lower endpoint\n\n    // look for points inside the triangle of hole point, segment intersection and endpoint;\n    // if there are no points found, we have a valid connection;\n    // otherwise choose the point of the minimum angle with the ray as connection point\n\n    var stop = m,\n        mx = m.x,\n        my = m.y,\n        tanMin = Infinity,\n        tan;\n\n    p = m.next;\n\n    while (p !== stop) {\n        if (hx >= p.x && p.x >= mx &&\n                pointInTriangle(hy < my ? hx : qx, hy, mx, my, hy < my ? qx : hx, hy, p.x, p.y)) {\n\n            tan = Math.abs(hy - p.y) / (hx - p.x); // tangential\n\n            if ((tan < tanMin || (tan === tanMin && p.x > m.x)) && locallyInside(p, hole)) {\n                m = p;\n                tanMin = tan;\n            }\n        }\n\n        p = p.next;\n    }\n\n    return m;\n}\n\n// interlink polygon nodes in z-order\nfunction indexCurve(start, minX, minY, size) {\n    var p = start;\n    do {\n        if (p.z === null) p.z = zOrder(p.x, p.y, minX, minY, size);\n        p.prevZ = p.prev;\n        p.nextZ = p.next;\n        p = p.next;\n    } while (p !== start);\n\n    p.prevZ.nextZ = null;\n    p.prevZ = null;\n\n    sortLinked(p);\n}\n\n// Simon Tatham's linked list merge sort algorithm\n// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html\nfunction sortLinked(list) {\n    var i, p, q, e, tail, numMerges, pSize, qSize,\n        inSize = 1;\n\n    do {\n        p = list;\n        list = null;\n        tail = null;\n        numMerges = 0;\n\n        while (p) {\n            numMerges++;\n            q = p;\n            pSize = 0;\n            for (i = 0; i < inSize; i++) {\n                pSize++;\n                q = q.nextZ;\n                if (!q) break;\n            }\n\n            qSize = inSize;\n\n            while (pSize > 0 || (qSize > 0 && q)) {\n\n                if (pSize === 0) {\n                    e = q;\n                    q = q.nextZ;\n                    qSize--;\n                } else if (qSize === 0 || !q) {\n                    e = p;\n                    p = p.nextZ;\n                    pSize--;\n                } else if (p.z <= q.z) {\n                    e = p;\n                    p = p.nextZ;\n                    pSize--;\n                } else {\n                    e = q;\n                    q = q.nextZ;\n                    qSize--;\n                }\n\n                if (tail) tail.nextZ = e;\n                else list = e;\n\n                e.prevZ = tail;\n                tail = e;\n            }\n\n            p = q;\n        }\n\n        tail.nextZ = null;\n        inSize *= 2;\n\n    } while (numMerges > 1);\n\n    return list;\n}\n\n// z-order of a point given coords and size of the data bounding box\nfunction zOrder(x, y, minX, minY, size) {\n    // coords are transformed into non-negative 15-bit integer range\n    x = 32767 * (x - minX) / size;\n    y = 32767 * (y - minY) / size;\n\n    x = (x | (x << 8)) & 0x00FF00FF;\n    x = (x | (x << 4)) & 0x0F0F0F0F;\n    x = (x | (x << 2)) & 0x33333333;\n    x = (x | (x << 1)) & 0x55555555;\n\n    y = (y | (y << 8)) & 0x00FF00FF;\n    y = (y | (y << 4)) & 0x0F0F0F0F;\n    y = (y | (y << 2)) & 0x33333333;\n    y = (y | (y << 1)) & 0x55555555;\n\n    return x | (y << 1);\n}\n\n// find the leftmost node of a polygon ring\nfunction getLeftmost(start) {\n    var p = start,\n        leftmost = start;\n    do {\n        if (p.x < leftmost.x) leftmost = p;\n        p = p.next;\n    } while (p !== start);\n\n    return leftmost;\n}\n\n// check if a point lies within a convex triangle\nfunction pointInTriangle(ax, ay, bx, by, cx, cy, px, py) {\n    return (cx - px) * (ay - py) - (ax - px) * (cy - py) >= 0 &&\n           (ax - px) * (by - py) - (bx - px) * (ay - py) >= 0 &&\n           (bx - px) * (cy - py) - (cx - px) * (by - py) >= 0;\n}\n\n// check if a diagonal between two polygon nodes is valid (lies in polygon interior)\nfunction isValidDiagonal(a, b) {\n    return a.next.i !== b.i && a.prev.i !== b.i && !intersectsPolygon(a, b) &&\n           locallyInside(a, b) && locallyInside(b, a) && middleInside(a, b);\n}\n\n// signed area of a triangle\nfunction area(p, q, r) {\n    return (q.y - p.y) * (r.x - q.x) - (q.x - p.x) * (r.y - q.y);\n}\n\n// check if two points are equal\nfunction equals(p1, p2) {\n    return p1.x === p2.x && p1.y === p2.y;\n}\n\n// check if two segments intersect\nfunction intersects(p1, q1, p2, q2) {\n    if ((equals(p1, q1) && equals(p2, q2)) ||\n        (equals(p1, q2) && equals(p2, q1))) return true;\n    return area(p1, q1, p2) > 0 !== area(p1, q1, q2) > 0 &&\n           area(p2, q2, p1) > 0 !== area(p2, q2, q1) > 0;\n}\n\n// check if a polygon diagonal intersects any polygon segments\nfunction intersectsPolygon(a, b) {\n    var p = a;\n    do {\n        if (p.i !== a.i && p.next.i !== a.i && p.i !== b.i && p.next.i !== b.i &&\n                intersects(p, p.next, a, b)) return true;\n        p = p.next;\n    } while (p !== a);\n\n    return false;\n}\n\n// check if a polygon diagonal is locally inside the polygon\nfunction locallyInside(a, b) {\n    return area(a.prev, a, a.next) < 0 ?\n        area(a, b, a.next) >= 0 && area(a, a.prev, b) >= 0 :\n        area(a, b, a.prev) < 0 || area(a, a.next, b) < 0;\n}\n\n// check if the middle point of a polygon diagonal is inside the polygon\nfunction middleInside(a, b) {\n    var p = a,\n        inside = false,\n        px = (a.x + b.x) / 2,\n        py = (a.y + b.y) / 2;\n    do {\n        if (((p.y > py) !== (p.next.y > py)) && (px < (p.next.x - p.x) * (py - p.y) / (p.next.y - p.y) + p.x))\n            inside = !inside;\n        p = p.next;\n    } while (p !== a);\n\n    return inside;\n}\n\n// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;\n// if one belongs to the outer ring and another to a hole, it merges it into a single ring\nfunction splitPolygon(a, b) {\n    var a2 = new Node(a.i, a.x, a.y),\n        b2 = new Node(b.i, b.x, b.y),\n        an = a.next,\n        bp = b.prev;\n\n    a.next = b;\n    b.prev = a;\n\n    a2.next = an;\n    an.prev = a2;\n\n    b2.next = a2;\n    a2.prev = b2;\n\n    bp.next = b2;\n    b2.prev = bp;\n\n    return b2;\n}\n\n// create a node and optionally link it with previous one (in a circular doubly linked list)\nfunction insertNode(i, x, y, last) {\n    var p = new Node(i, x, y);\n\n    if (!last) {\n        p.prev = p;\n        p.next = p;\n\n    } else {\n        p.next = last.next;\n        p.prev = last;\n        last.next.prev = p;\n        last.next = p;\n    }\n    return p;\n}\n\nfunction removeNode(p) {\n    p.next.prev = p.prev;\n    p.prev.next = p.next;\n\n    if (p.prevZ) p.prevZ.nextZ = p.nextZ;\n    if (p.nextZ) p.nextZ.prevZ = p.prevZ;\n}\n\nfunction Node(i, x, y) {\n    // vertice index in coordinates array\n    this.i = i;\n\n    // vertex coordinates\n    this.x = x;\n    this.y = y;\n\n    // previous and next vertice nodes in a polygon ring\n    this.prev = null;\n    this.next = null;\n\n    // z-order curve value\n    this.z = null;\n\n    // previous and next nodes in z-order\n    this.prevZ = null;\n    this.nextZ = null;\n\n    // indicates whether this is a steiner point\n    this.steiner = false;\n}\n\n// return a percentage difference between the polygon area and its triangulation area;\n// used to verify correctness of triangulation\nearcut.deviation = function (data, holeIndices, dim, triangles) {\n    var hasHoles = holeIndices && holeIndices.length;\n    var outerLen = hasHoles ? holeIndices[0] * dim : data.length;\n\n    var polygonArea = Math.abs(signedArea(data, 0, outerLen, dim));\n    if (hasHoles) {\n        for (var i = 0, len = holeIndices.length; i < len; i++) {\n            var start = holeIndices[i] * dim;\n            var end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\n            polygonArea -= Math.abs(signedArea(data, start, end, dim));\n        }\n    }\n\n    var trianglesArea = 0;\n    for (i = 0; i < triangles.length; i += 3) {\n        var a = triangles[i] * dim;\n        var b = triangles[i + 1] * dim;\n        var c = triangles[i + 2] * dim;\n        trianglesArea += Math.abs(\n            (data[a] - data[c]) * (data[b + 1] - data[a + 1]) -\n            (data[a] - data[b]) * (data[c + 1] - data[a + 1]));\n    }\n\n    return polygonArea === 0 && trianglesArea === 0 ? 0 :\n        Math.abs((trianglesArea - polygonArea) / polygonArea);\n};\n\nfunction signedArea(data, start, end, dim) {\n    var sum = 0;\n    for (var i = start, j = end - dim; i < end; i += dim) {\n        sum += (data[j] - data[i]) * (data[i + 1] + data[j + 1]);\n        j = i;\n    }\n    return sum;\n}\n\n// turn a polygon in a multi-dimensional array form (e.g. as in GeoJSON) into a form Earcut accepts\nearcut.flatten = function (data) {\n    var dim = data[0][0].length,\n        result = {vertices: [], holes: [], dimensions: dim},\n        holeIndex = 0;\n\n    for (var i = 0; i < data.length; i++) {\n        for (var j = 0; j < data[i].length; j++) {\n            for (var d = 0; d < dim; d++) result.vertices.push(data[i][j][d]);\n        }\n        if (i > 0) {\n            holeIndex += data[i - 1].length;\n            result.holes.push(holeIndex);\n        }\n    }\n    return result;\n};\n\n},{}]},{},[1]);\n"]}